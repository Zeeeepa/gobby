{"id": "mm-a1360b29", "content": "Gobby project uses strangler-fig decomposition pattern to refactor large modules. Current targets: actions.py (<400 lines, 49 wrappers remain), tools.py (<100 lines), codex.py (<200 lines), migrations.py (flatten with legacy). Implementation follows /gobby plan skill with Root epic → Phase epics → Feature tasks hierarchy.", "type": "context", "importance": 0.95, "tags": ["gobby", "refactoring", "architecture", "strangler-fig"], "created_at": "2026-01-26T23:05:30.973935+00:00", "updated_at": "2026-01-26T23:05:30.973935+00:00", "source": "session", "source_id": "c939a49c-67ad-433f-bc8f-defdac852772"}
{"id": "mm-fad146df", "content": "Plan files in `.gobby/plans/` must follow expand-ready format: tasks need explicit `(category: code|config|test|docs|refactor|research|planning|manual)` annotations, `(depends: TaskName)` or `(depends: Phase N)` dependency notation, and a Task Mapping table at the bottom for task references. The `/g expand` command uses this format to auto-generate TDD triplets for code/config tasks.", "type": "pattern", "importance": 0.95, "tags": ["gobby", "plan-format", "expand-command", "task-structure"], "created_at": "2026-01-26T22:18:20.049027+00:00", "updated_at": "2026-01-26T22:18:20.049027+00:00", "source": "session", "source_id": "1b365507-fea8-4662-a6c5-62caef8f48ea"}
{"id": "mm-ef920a2b", "content": "Gobby's spawn architecture uses three spawner types (TerminalSpawner, EmbeddedSpawner, HeadlessSpawner) from spawn.py. Agent isolation is handled by WorktreeGitManager and CloneGitManager, with ~350 lines of duplicated spawn logic in spawn_agent_in_worktree and ~300 lines in spawn_agent_in_clone that should be unified.", "type": "fact", "importance": 0.95, "tags": ["architecture", "spawn-system", "git-isolation", "refactoring-target"], "created_at": "2026-01-26T17:11:39.633055+00:00", "updated_at": "2026-01-26T17:11:39.633055+00:00", "source": "session", "source_id": "8d582fd9-8c4b-48bf-949b-3d2f353527c9"}
{"id": "mm-5a96d183", "content": "Gobby project uses a unified installer that copies CLI-specific commands via install_cli_content(). Each CLI has its own directory: Claude uses Markdown in src/gobby/install/claude/commands/ → .claude/commands/, Gemini uses TOML in src/gobby/install/gemini/commands/ → .gemini/commands/, and Codex uses Markdown in src/gobby/install/codex/prompts/ → .codex/prompts/.", "type": "fact", "importance": 0.95, "tags": ["architecture", "installer", "multi-cli", "file-paths"], "created_at": "2026-01-26T15:19:56.014629+00:00", "updated_at": "2026-01-26T15:19:56.014629+00:00", "source": "session", "source_id": "1f0eb083-9ebd-4c61-8ea3-0e9fd78037e2"}
{"id": "mm-1398a1ab", "content": "The gobby project uses a unified spawn_agent API design with these key parameters: prompt (required), agent='generic' (default), isolation='current'|'worktree'|'clone'. Anonymous spawning defaults to 'generic' agent which uses bundled generic-agent.yaml and generic-workflow.yaml templates.", "type": "fact", "importance": 0.95, "tags": ["spawn_agent", "API_design", "gobby", "agent_spawning"], "created_at": "2026-01-26T14:05:26.282092+00:00", "updated_at": "2026-01-26T14:05:26.282092+00:00", "source": "session", "source_id": "dc91e716-6e3a-4958-a18f-599e9bc18341"}
{"id": "mm-a3743a20", "content": "The gobby project uses a multi-CLI installation model with four supported CLIs: Claude, Gemini, Codex, and Antigravity. Workflow files must be maintained in three locations: source shared version (src/gobby/install/shared/workflows/), installed versions for each CLI (.claude/, .gemini/, .codex/, .antigravity/), and project-level versions (.gobby/workflows/).", "type": "fact", "importance": 0.95, "tags": ["architecture", "file-organization", "installation", "multi-cli"], "created_at": "2026-01-26T02:57:07.741841+00:00", "updated_at": "2026-01-26T02:57:07.741841+00:00", "source": "session", "source_id": "1d0c2cb9-eb49-4dc2-8480-b01ade18895e"}
{"id": "mm-052d36a2", "content": "In gobby's logging configuration, setup_file_logging() sets propagate=False on the gobby package logger to prevent duplicate logs. This breaks pytest's caplog fixture because caplog captures via root logger handlers and depends on propagation. Tests need either a fixture enabling propagate=True during test execution, or should avoid using caplog.at_level(logger='gobby.utils.git') in favor of capturing all logs.", "type": "context", "importance": 0.95, "tags": ["logging", "testing", "caplog", "pytest", "gobby-logger-config"], "created_at": "2026-01-25T20:04:09.517652+00:00", "updated_at": "2026-01-25T20:04:09.517652+00:00", "source": "session", "source_id": "4042c9be-18da-4d31-9039-027a93af8c78"}
{"id": "mm-3eb24810", "content": "The gobby project is transitioning workflows from global (~/.gobby/workflows/) to project-only (.gobby/workflows/) storage. This requires removing global_dirs defaults from WorkflowLoader, eliminating --global flags from CLI, and removing is_global parameters from MCP tools across: loader.py, hook_manager.py, cli/workflows.py, mcp_proxy/tools/workflows.py, and cli/installers/codex.py.", "type": "context", "importance": 0.95, "tags": ["workflows", "architecture-change", "refactoring-scope"], "created_at": "2026-01-25T18:46:30.280702+00:00", "updated_at": "2026-01-25T18:46:30.280702+00:00", "source": "session", "source_id": "598eabaa-1caa-40d8-8166-309b8ff8ba9c"}
{"id": "mm-86377881", "content": "gobby-skills is the single source of truth for bundled skills. It contains 24 skills total: 17 original gobby-* skills (gobby-agents, gobby-clones, gobby-diagnostic, gobby-expand, gobby-mcp, gobby-memory, gobby-merge, gobby-metrics, gobby-plan, gobby-sessions, gobby-tasks, gobby-workflows, gobby-worktrees) + 5 helper skills (claiming-tasks, committing-changes, discovering-tools, starting-sessions) + 7 quick task skills (bug, chore, epic, eval, feat, nit, ref). Duplicate skill directories in .claude/skills/gobby-* and .claude/commands/gobby/ should be deleted to maintain single source of truth.", "type": "fact", "importance": 0.95, "tags": ["gobby-skills", "architecture", "skill-organization"], "created_at": "2026-01-25T18:18:01.196567+00:00", "updated_at": "2026-01-25T18:18:01.196567+00:00", "source": "session", "source_id": "8ba09a43-3c3f-442c-9cdf-555cb2f38851"}
{"id": "mm-414c0ecb", "content": "Claude Code doesn't include tool_result in post-tool-use hooks, causing detection_helpers.py to receive empty tool_output dicts. This breaks error detection in detect_task_claim for close_task validation - when close_task fails validation (e.g., 'no_commits_linked'), the empty tool_output passes all error checks and incorrectly clears task_claimed=False.", "type": "fact", "importance": 0.95, "tags": ["claude-code-limitation", "detection_helpers", "close_task", "task_claimed", "bug-root-cause"], "created_at": "2026-01-25T17:14:28.198509+00:00", "updated_at": "2026-01-25T17:14:28.198509+00:00", "source": "session", "source_id": "b08118fe-cfa2-4c04-b92a-d381c05e7eda"}
{"id": "mm-a9c13ab0", "content": "Gobby requires explicit task claiming before file edits are permitted. Use create_task with claim: true parameter or claim_task tool to enable write access. The hook system enforces this via PreToolUse validation.", "type": "pattern", "importance": 0.95, "tags": ["task-management", "workflow", "write-access", "hooks"], "created_at": "2026-01-25T17:02:58.234367+00:00", "updated_at": "2026-01-25T17:02:58.234367+00:00", "source": "session", "source_id": "510d507d-f02a-47d5-8b8c-5c8fc2299ab3"}
{"id": "mm-fc300793", "content": "config/app.py re-exports 31 symbols from 10 extracted modules. 95% of import traffic comes from just 2 symbols (DaemonConfig and load_config), with 10+ symbols having zero importers. DaemonConfig and load_config are genuinely app-level and should stay; unused re-exports can be removed with updates to ~12 files.", "type": "fact", "importance": 0.9, "tags": ["gobby", "config", "refactoring", "import-analysis"], "created_at": "2026-01-27T18:15:43.760777+00:00", "updated_at": "2026-01-27T18:15:43.760777+00:00", "source": "session", "source_id": "a1199286-0860-4cd3-aeb8-366a288db4b4"}
{"id": "mm-639aaad8", "content": "The doctor skill in gobby supports four flag-based modes: --functional (basic checks), --security (Phase 5 Security Audit), --all (both), and --cleanup. The Phase 5 Security Audit includes 8 checks: file permissions, plaintext secrets, HTTP binding, webhooks, debug logging, plugins, MCP URLs, and permissive skills.", "type": "fact", "importance": 0.9, "tags": ["gobby", "doctor-skill", "security-audit", "flags"], "created_at": "2026-01-27T17:49:03.714449+00:00", "updated_at": "2026-01-27T17:49:03.714449+00:00", "source": "session", "source_id": "448cabcd-183a-473e-a6ae-a6050b5c6d96"}
{"id": "mm-ee19eb9d", "content": "The project is undergoing a 'Strangler Fig Decomposition' refactor with 15 subtasks organized in 3 phases: (1) Actions Withering - refactor ActionExecutor, (2) Tools Decomposition - migrate endpoints to modular structure, (3) Codex Decomposition - separate codex implementation into codex_impl/. Tasks have explicit dependencies that should be respected during execution.", "type": "context", "importance": 0.9, "tags": ["refactoring", "architecture", "decomposition", "priorities"], "created_at": "2026-01-27T01:33:16.633941+00:00", "updated_at": "2026-01-27T01:33:16.633941+00:00", "source": "session", "source_id": "e8d257ca-90d9-4276-b8ce-72d71e05b0bb"}
{"id": "mm-ec25a18d", "content": "Gobby project uses a skill-based architecture where skills are defined in SKILL.md files located at src/gobby/install/shared/skills/{skill_name}/SKILL.md. Skills have frontmatter (name, description), phases (1-5), subcommands with flags, and security audit sections.", "type": "fact", "importance": 0.9, "tags": ["architecture", "skills", "file-structure"], "created_at": "2026-01-27T01:28:48.064503+00:00", "updated_at": "2026-01-27T01:28:48.064503+00:00", "source": "session", "source_id": "e0e85afe-8841-425f-ba0d-018b5301fb73"}
{"id": "mm-711da950", "content": "The gobby project uses a task management workflow where agents must CREATE a task, then CLAIM it before making file edits. Attempting to edit files without claiming a task first will trigger hook errors. Tasks can be closed with a reason (e.g., 'already_implemented') when there's no commit to link.", "type": "pattern", "importance": 0.9, "tags": ["workflow", "task-management", "gobby-cli", "hooks"], "created_at": "2026-01-27T00:15:05.232744+00:00", "updated_at": "2026-01-27T00:15:05.232744+00:00", "source": "session", "source_id": "8a8d7adb-fc94-45da-9f98-77fae95a85d6"}
{"id": "mm-5b0e6007", "content": "The gobby project uses a migration system with a flattened V2 baseline (v75) that can be toggled via a `use_flattened_baseline` flag. New databases default to this flattened baseline which applies v75 in a single step instead of 16 sequential migrations (old baseline + 15 incremental). Both paths produce functionally identical schemas.", "type": "fact", "importance": 0.9, "tags": ["migration", "database", "architecture", "baseline"], "created_at": "2026-01-27T00:15:25.210072+00:00", "updated_at": "2026-01-27T00:15:25.210072+00:00", "source": "session", "source_id": "22fdeb42-a38e-44e4-a7f1-ca4c87da2807"}
{"id": "mm-da278bd9", "content": "Gobby uses a task/epic system (via MCP tool gobby-tasks) with hierarchical structure: parent epics contain child phase epics, which contain implementation tasks. Tasks require commits to be closed and cannot be closed while children are open. Status can be set to 'open' to release tasks for future work.", "type": "fact", "importance": 0.9, "tags": ["task-management", "workflow", "gobby-tasks-mcp"], "created_at": "2026-01-27T00:13:51.517820+00:00", "updated_at": "2026-01-27T00:13:51.517820+00:00", "source": "session", "source_id": "bbde861d-1946-4835-8a53-93a1830483ca"}
{"id": "mm-318476ae", "content": "Gobby refactoring execution order: Phase 1 (Actions) → Phase 3 (Tools) → Phase 4 (Codex) → Phase 2 (Migrations). Phase 1 is in-progress with 49 wrapper methods to remove. Phase 2 has detailed sub-plan at migration-flattening.md. Phase 3 requires decomposing tools.py into 4 domain routers.", "type": "pattern", "importance": 0.9, "tags": ["gobby", "refactoring", "task-planning", "phases"], "created_at": "2026-01-26T23:05:30.975245+00:00", "updated_at": "2026-01-26T23:05:30.975245+00:00", "source": "session", "source_id": "c939a49c-67ad-433f-bc8f-defdac852772"}
{"id": "mm-c81b1f62", "content": "The gobby project has a pre-merge-commit hook that blocks automatic merge commits. When merging branches, if the hook fails, manually commit the merge using 'git commit' rather than relying on automatic merge commit creation.", "type": "pattern", "importance": 0.9, "tags": ["git", "merge", "pre-commit-hook", "gobby"], "created_at": "2026-01-26T22:56:14.012537+00:00", "updated_at": "2026-01-26T22:56:14.012537+00:00", "source": "session", "source_id": "b422c481-ba1d-44da-8912-666de487efbf"}
{"id": "mm-dc99d759", "content": "The gobby project uses a 'strangler fig' migration pattern for schema changes: create a new baseline schema variant (e.g., BASELINE_SCHEMA_V2), add a feature flag to DaemonConfig to branch between old and new paths, test both paths thoroughly, then gradually migrate to the new default. This allows safe rollback if issues arise.", "type": "pattern", "importance": 0.9, "tags": ["migration", "schema", "strangler-fig", "feature-flags", "safety"], "created_at": "2026-01-26T22:35:10.785482+00:00", "updated_at": "2026-01-26T22:35:10.785482+00:00", "source": "session", "source_id": "37010a61-6ffb-495f-b12a-e444c0981eff"}
{"id": "mm-98f3931c", "content": "The gobby project uses a hook system that validates file modifications. Before writing files, a task must be created and claimed via mcp__gobby__call_tool. The hook dispatcher runs on file writes and requires tasks to be in progress or closed properly.", "type": "pattern", "importance": 0.9, "tags": ["gobby", "file-operations", "task-management", "hooks"], "created_at": "2026-01-26T21:23:00.440710+00:00", "updated_at": "2026-01-26T21:23:00.440710+00:00", "source": "session", "source_id": "0f3bb4a3-6134-46de-8234-d51d676dfbd8"}
{"id": "mm-2e8319e2", "content": "In gobby's conductor module, pricing.py and token_tracker.py are intentionally placed in conductor/ (not a separate metrics/ module) because they are active control plane components that drive orchestration decisions, not passive observability. SessionTokenTracker.can_spawn_agent() gates agent spawning based on budget, and ConductorLoop uses BudgetChecker to throttle the loop when budget is exceeded.", "type": "fact", "importance": 0.9, "tags": ["architecture", "conductor", "budget-management", "cost-control"], "created_at": "2026-01-26T21:16:57.260247+00:00", "updated_at": "2026-01-26T21:16:57.260247+00:00", "source": "session", "source_id": "9ef8d770-7c10-4f8e-800a-a7c749644689"}
{"id": "mm-76ea9a12", "content": "The gobby project uses a task claiming system where agents must claim a task before modifying files related to that task. Tasks can be force-claimed if already claimed by another session, and must be closed via close_task() before the session stops.", "type": "fact", "importance": 0.9, "tags": ["task-system", "workflow", "gobby-architecture"], "created_at": "2026-01-26T17:18:24.813264+00:00", "updated_at": "2026-01-26T17:18:24.813264+00:00", "source": "session", "source_id": "595ef7e1-c5ec-401b-b6c9-cc68eb89acbc"}
{"id": "mm-ed16e7f0", "content": "When refactoring Gemini/Codex agent spawning, preserve existing preflight capture logic that creates sessions before agent execution. This is critical for model-specific agents and must not be moved or removed during spawn unification work.", "type": "context", "importance": 0.9, "tags": ["gemini", "codex", "preflight-capture", "backward-compatibility"], "created_at": "2026-01-26T17:18:24.812048+00:00", "updated_at": "2026-01-26T17:18:24.812048+00:00", "source": "session", "source_id": "8d582fd9-8c4b-48bf-949b-3d2f353527c9"}
{"id": "mm-258ae2dc", "content": "Gobby plugin loading supports multiple directories via config's `plugin_dirs` with defaults of `['~/.gobby/plugins', '.gobby/plugins']` for global and project-scoped plugins respectively. Currently installation only goes to `~/.gobby/plugins/` but the refactor plan aims to install to `.gobby/plugins/` (project-scoped).", "type": "fact", "importance": 0.9, "tags": ["plugin-system", "configuration", "installation"], "created_at": "2026-01-26T17:17:40.833890+00:00", "updated_at": "2026-01-26T17:17:40.833890+00:00", "source": "session", "source_id": "68fb48cd-e380-4b4d-81c9-932b386a549e"}
