{"id": "mm-fad146df", "content": "Plan files in `.gobby/plans/` must follow expand-ready format: tasks need explicit `(category: code|config|test|docs|refactor|research|planning|manual)` annotations, `(depends: TaskName)` or `(depends: Phase N)` dependency notation, and a Task Mapping table at the bottom for task references. The `/g expand` command uses this format to auto-generate TDD triplets for code/config tasks.", "type": "pattern", "importance": 0.95, "tags": ["gobby", "plan-format", "expand-command", "task-structure"], "created_at": "2026-01-26T22:18:20.049027+00:00", "updated_at": "2026-01-26T22:18:20.049027+00:00", "source": "session", "source_id": "1b365507-fea8-4662-a6c5-62caef8f48ea"}
{"id": "mm-ef920a2b", "content": "Gobby's spawn architecture uses three spawner types (TerminalSpawner, EmbeddedSpawner, HeadlessSpawner) from spawn.py. Agent isolation is handled by WorktreeGitManager and CloneGitManager, with ~350 lines of duplicated spawn logic in spawn_agent_in_worktree and ~300 lines in spawn_agent_in_clone that should be unified.", "type": "fact", "importance": 0.95, "tags": ["architecture", "spawn-system", "git-isolation", "refactoring-target"], "created_at": "2026-01-26T17:11:39.633055+00:00", "updated_at": "2026-01-26T17:11:39.633055+00:00", "source": "session", "source_id": "8d582fd9-8c4b-48bf-949b-3d2f353527c9"}
{"id": "mm-5a96d183", "content": "Gobby project uses a unified installer that copies CLI-specific commands via install_cli_content(). Each CLI has its own directory: Claude uses Markdown in src/gobby/install/claude/commands/ → .claude/commands/, Gemini uses TOML in src/gobby/install/gemini/commands/ → .gemini/commands/, and Codex uses Markdown in src/gobby/install/codex/prompts/ → .codex/prompts/.", "type": "fact", "importance": 0.95, "tags": ["architecture", "installer", "multi-cli", "file-paths"], "created_at": "2026-01-26T15:19:56.014629+00:00", "updated_at": "2026-01-26T15:19:56.014629+00:00", "source": "session", "source_id": "1f0eb083-9ebd-4c61-8ea3-0e9fd78037e2"}
{"id": "mm-1398a1ab", "content": "The gobby project uses a unified spawn_agent API design with these key parameters: prompt (required), agent='generic' (default), isolation='current'|'worktree'|'clone'. Anonymous spawning defaults to 'generic' agent which uses bundled generic-agent.yaml and generic-workflow.yaml templates.", "type": "fact", "importance": 0.95, "tags": ["spawn_agent", "API_design", "gobby", "agent_spawning"], "created_at": "2026-01-26T14:05:26.282092+00:00", "updated_at": "2026-01-26T14:05:26.282092+00:00", "source": "session", "source_id": "dc91e716-6e3a-4958-a18f-599e9bc18341"}
{"id": "mm-a3743a20", "content": "The gobby project uses a multi-CLI installation model with four supported CLIs: Claude, Gemini, Codex, and Antigravity. Workflow files must be maintained in three locations: source shared version (src/gobby/install/shared/workflows/), installed versions for each CLI (.claude/, .gemini/, .codex/, .antigravity/), and project-level versions (.gobby/workflows/).", "type": "fact", "importance": 0.95, "tags": ["architecture", "file-organization", "installation", "multi-cli"], "created_at": "2026-01-26T02:57:07.741841+00:00", "updated_at": "2026-01-26T02:57:07.741841+00:00", "source": "session", "source_id": "1d0c2cb9-eb49-4dc2-8480-b01ade18895e"}
{"id": "mm-052d36a2", "content": "In gobby's logging configuration, setup_file_logging() sets propagate=False on the gobby package logger to prevent duplicate logs. This breaks pytest's caplog fixture because caplog captures via root logger handlers and depends on propagation. Tests need either a fixture enabling propagate=True during test execution, or should avoid using caplog.at_level(logger='gobby.utils.git') in favor of capturing all logs.", "type": "context", "importance": 0.95, "tags": ["logging", "testing", "caplog", "pytest", "gobby-logger-config"], "created_at": "2026-01-25T20:04:09.517652+00:00", "updated_at": "2026-01-25T20:04:09.517652+00:00", "source": "session", "source_id": "4042c9be-18da-4d31-9039-027a93af8c78"}
{"id": "mm-3eb24810", "content": "The gobby project is transitioning workflows from global (~/.gobby/workflows/) to project-only (.gobby/workflows/) storage. This requires removing global_dirs defaults from WorkflowLoader, eliminating --global flags from CLI, and removing is_global parameters from MCP tools across: loader.py, hook_manager.py, cli/workflows.py, mcp_proxy/tools/workflows.py, and cli/installers/codex.py.", "type": "context", "importance": 0.95, "tags": ["workflows", "architecture-change", "refactoring-scope"], "created_at": "2026-01-25T18:46:30.280702+00:00", "updated_at": "2026-01-25T18:46:30.280702+00:00", "source": "session", "source_id": "598eabaa-1caa-40d8-8166-309b8ff8ba9c"}
{"id": "mm-86377881", "content": "gobby-skills is the single source of truth for bundled skills. It contains 24 skills total: 17 original gobby-* skills (gobby-agents, gobby-clones, gobby-diagnostic, gobby-expand, gobby-mcp, gobby-memory, gobby-merge, gobby-metrics, gobby-plan, gobby-sessions, gobby-tasks, gobby-workflows, gobby-worktrees) + 5 helper skills (claiming-tasks, committing-changes, discovering-tools, starting-sessions) + 7 quick task skills (bug, chore, epic, eval, feat, nit, ref). Duplicate skill directories in .claude/skills/gobby-* and .claude/commands/gobby/ should be deleted to maintain single source of truth.", "type": "fact", "importance": 0.95, "tags": ["gobby-skills", "architecture", "skill-organization"], "created_at": "2026-01-25T18:18:01.196567+00:00", "updated_at": "2026-01-25T18:18:01.196567+00:00", "source": "session", "source_id": "8ba09a43-3c3f-442c-9cdf-555cb2f38851"}
{"id": "mm-414c0ecb", "content": "Claude Code doesn't include tool_result in post-tool-use hooks, causing detection_helpers.py to receive empty tool_output dicts. This breaks error detection in detect_task_claim for close_task validation - when close_task fails validation (e.g., 'no_commits_linked'), the empty tool_output passes all error checks and incorrectly clears task_claimed=False.", "type": "fact", "importance": 0.95, "tags": ["claude-code-limitation", "detection_helpers", "close_task", "task_claimed", "bug-root-cause"], "created_at": "2026-01-25T17:14:28.198509+00:00", "updated_at": "2026-01-25T17:14:28.198509+00:00", "source": "session", "source_id": "b08118fe-cfa2-4c04-b92a-d381c05e7eda"}
{"id": "mm-a9c13ab0", "content": "Gobby requires explicit task claiming before file edits are permitted. Use create_task with claim: true parameter or claim_task tool to enable write access. The hook system enforces this via PreToolUse validation.", "type": "pattern", "importance": 0.95, "tags": ["task-management", "workflow", "write-access", "hooks"], "created_at": "2026-01-25T17:02:58.234367+00:00", "updated_at": "2026-01-25T17:02:58.234367+00:00", "source": "session", "source_id": "510d507d-f02a-47d5-8b8c-5c8fc2299ab3"}
{"id": "mm-dc99d759", "content": "The gobby project uses a 'strangler fig' migration pattern for schema changes: create a new baseline schema variant (e.g., BASELINE_SCHEMA_V2), add a feature flag to DaemonConfig to branch between old and new paths, test both paths thoroughly, then gradually migrate to the new default. This allows safe rollback if issues arise.", "type": "pattern", "importance": 0.9, "tags": ["migration", "schema", "strangler-fig", "feature-flags", "safety"], "created_at": "2026-01-26T22:35:10.785482+00:00", "updated_at": "2026-01-26T22:35:10.785482+00:00", "source": "session", "source_id": "37010a61-6ffb-495f-b12a-e444c0981eff"}
{"id": "mm-98f3931c", "content": "The gobby project uses a hook system that validates file modifications. Before writing files, a task must be created and claimed via mcp__gobby__call_tool. The hook dispatcher runs on file writes and requires tasks to be in progress or closed properly.", "type": "pattern", "importance": 0.9, "tags": ["gobby", "file-operations", "task-management", "hooks"], "created_at": "2026-01-26T21:23:00.440710+00:00", "updated_at": "2026-01-26T21:23:00.440710+00:00", "source": "session", "source_id": "0f3bb4a3-6134-46de-8234-d51d676dfbd8"}
{"id": "mm-2e8319e2", "content": "In gobby's conductor module, pricing.py and token_tracker.py are intentionally placed in conductor/ (not a separate metrics/ module) because they are active control plane components that drive orchestration decisions, not passive observability. SessionTokenTracker.can_spawn_agent() gates agent spawning based on budget, and ConductorLoop uses BudgetChecker to throttle the loop when budget is exceeded.", "type": "fact", "importance": 0.9, "tags": ["architecture", "conductor", "budget-management", "cost-control"], "created_at": "2026-01-26T21:16:57.260247+00:00", "updated_at": "2026-01-26T21:16:57.260247+00:00", "source": "session", "source_id": "9ef8d770-7c10-4f8e-800a-a7c749644689"}
{"id": "mm-df794520", "content": "The gobby project uses a task claiming system where agents must claim a task before modifying files related to that task. Tasks can be force-claimed if already claimed by another session, and must be closed via close_task() before the session stops.", "type": "fact", "importance": 0.9, "tags": ["task-system", "workflow", "gobby-architecture"], "created_at": "2026-01-26T17:11:05.004377+00:00", "updated_at": "2026-01-26T17:11:05.004377+00:00", "source": "session", "source_id": "595ef7e1-c5ec-401b-b6c9-cc68eb89acbc"}
{"id": "mm-7710b8a4", "content": "When refactoring Gemini/Codex agent spawning, preserve existing preflight capture logic that creates sessions before agent execution. This is critical for model-specific agents and must not be moved or removed during spawn unification work.", "type": "context", "importance": 0.9, "tags": ["gemini", "codex", "preflight-capture", "backward-compatibility"], "created_at": "2026-01-26T17:11:39.634255+00:00", "updated_at": "2026-01-26T17:11:39.634255+00:00", "source": "session", "source_id": "8d582fd9-8c4b-48bf-949b-3d2f353527c9"}
{"id": "mm-258ae2dc", "content": "Gobby plugin loading supports multiple directories via config's `plugin_dirs` with defaults of `['~/.gobby/plugins', '.gobby/plugins']` for global and project-scoped plugins respectively. Currently installation only goes to `~/.gobby/plugins/` but the refactor plan aims to install to `.gobby/plugins/` (project-scoped).", "type": "fact", "importance": 0.9, "tags": ["plugin-system", "configuration", "installation"], "created_at": "2026-01-26T17:17:40.833890+00:00", "updated_at": "2026-01-26T17:17:40.833890+00:00", "source": "session", "source_id": "68fb48cd-e380-4b4d-81c9-932b386a549e"}
{"id": "mm-0737f731", "content": "Epic #6086 implemented a unified /gobby router skill system. Key changes: created /gobby router and /g alias, renamed 13 gobby-* skills to short names (agents, tasks, sessions, etc.), added category: core to all 26 gobby skills, and added alwaysApply: true to foundational skills. Updated Claude Code and Gemini adapters to install router skills.", "type": "context", "importance": 0.9, "tags": ["gobby", "router-skills", "architecture", "skill-naming"], "created_at": "2026-01-26T16:15:48.271817+00:00", "updated_at": "2026-01-26T16:15:48.271817+00:00", "source": "session", "source_id": "5f62f7a8-1c13-4a38-a8ed-56585340164c"}
{"id": "mm-94fd9bb6", "content": "LocalSkillManager.get_by_name() needs an `include_global` parameter to match list_skills() behavior. When project_id is set and include_global=True (default), it should first check project-scoped skills, then fall back to global skills. This fixes skill lookup failures.", "type": "pattern", "importance": 0.9, "tags": ["gobby", "skill-lookup", "api-consistency"], "created_at": "2026-01-26T16:01:00.586789+00:00", "updated_at": "2026-01-26T16:01:00.586789+00:00", "source": "session", "source_id": "39053109-12aa-41c0-8293-dded645dbe27"}
{"id": "mm-9415b700", "content": "Gobby is a local-first control plane for AI coding tools. The project uses a task-based workflow system with commit tracking; tasks require linked commits before they can be closed.", "type": "context", "importance": 0.9, "tags": ["gobby", "project-definition", "workflow", "commits"], "created_at": "2026-01-26T15:53:04.659863+00:00", "updated_at": "2026-01-26T15:53:04.659863+00:00", "source": "session", "source_id": "a3a6417e-f8fd-4aae-b2ba-548d04020bf0"}
{"id": "mm-1a9b788e", "content": "Gobby project uses task numbering format [#N] in commit messages (e.g., '[#6089] Add Skills display to CLI status output'). This format is required and referenced in task closure workflows.", "type": "pattern", "importance": 0.9, "tags": ["commit-convention", "gobby", "task-tracking"], "created_at": "2026-01-26T15:30:12.064613+00:00", "updated_at": "2026-01-26T15:30:12.064613+00:00", "source": "session", "source_id": "5ba0e7a1-f81a-495c-839e-d2710f7f3c64"}
{"id": "mm-81e2e3af", "content": "Task closure in gobby requires a linked commit before the close operation will succeed - attempting to close without commits returns 'no_commits_linked' error. Workflow: make changes → commit with [#N] format → close task with commit SHA.", "type": "context", "importance": 0.9, "tags": ["workflow", "task-closure", "git-integration"], "created_at": "2026-01-26T15:30:12.066053+00:00", "updated_at": "2026-01-26T15:30:12.066053+00:00", "source": "session", "source_id": "5ba0e7a1-f81a-495c-839e-d2710f7f3c64"}
{"id": "mm-de383393", "content": "HTTPServer in gobby doesn't have direct skill_manager or skills_manager attributes. Skills are accessed via the gobby-skills registry through server._internal_manager, which contains a storage instance (LocalSkillManager) with access to skill listing and metadata.", "type": "fact", "importance": 0.9, "tags": ["gobby", "HTTPServer", "skills", "architecture", "registry-access"], "created_at": "2026-01-26T15:25:05.983406+00:00", "updated_at": "2026-01-26T15:25:05.983406+00:00", "source": "session", "source_id": "abc2700e-a3b7-49e6-8af8-daaf3a0607cb"}
{"id": "mm-23fdda6d", "content": "Gobby skill routing uses a two-part pattern: /gobby routes to Gobby skills via search_skills() → get_skill(), while /gobby mcp <server> routes to MCP servers via list_tools() → call_tool(). /g is a shorthand alias with identical content.", "type": "pattern", "importance": 0.9, "tags": ["routing", "architecture", "slash-commands"], "created_at": "2026-01-26T15:19:56.015427+00:00", "updated_at": "2026-01-26T15:19:56.015427+00:00", "source": "session", "source_id": "1f0eb083-9ebd-4c61-8ea3-0e9fd78037e2"}
{"id": "mm-db636fa0", "content": "SkillChangeNotifier pattern: Wire change listeners to LocalSkillManager to automatically trigger search index updates on any skill mutation (create/update/delete), eliminating the need for manual re-indexing calls in individual MCP tool handlers.", "type": "pattern", "importance": 0.9, "tags": ["architecture", "skill-management", "search-indexing", "observer-pattern"], "created_at": "2026-01-26T15:14:41.965429+00:00", "updated_at": "2026-01-26T15:14:41.965429+00:00", "source": "session", "source_id": "e3289ba4-649b-4c70-bae6-4d4d88f9bb91"}
{"id": "mm-f0afc803", "content": "Gobby has 13 skills with `gobby-` prefix that should be renamed to remove the prefix for consistency. The skills are organized in `/commands/gobby/` directory and need individual renames plus SKILL.md updates.", "type": "fact", "importance": 0.9, "tags": ["gobby", "skills", "refactoring", "naming-convention"], "created_at": "2026-01-26T15:05:14.860933+00:00", "updated_at": "2026-01-26T15:05:14.860933+00:00", "source": "session", "source_id": "7a81fcd4-081e-46e1-816a-7c19660112ae"}
