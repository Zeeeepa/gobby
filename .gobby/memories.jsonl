{"id": "mm-78b3b992", "content": "Step and pipeline workflows do not replace lifecycle workflows: they run concurrently. The primary difference between the workflow types is that you can have multiple lifecycle workflows running in a session but only one step or one pipeline workflow active at a time in a session.", "type": "fact", "importance": 0.9, "tags": ["workflows", "lifecycle", "step", "pipeline", "concurrency"], "created_at": "2026-02-06T16:17:35.575620+00:00", "updated_at": "2026-02-06T16:17:35.575620+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-8f0bc4be", "content": "We don't do workarounds, we log and fix bugs. When encountering a bug, document it and fix it rather than working around it.", "type": "preference", "importance": 1.0, "tags": "development,bugs,workflow", "created_at": "2026-02-05T02:09:03.761109+00:00", "updated_at": "2026-02-05T02:09:03.761109+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-052d36a2", "content": "In gobby's logging configuration, setup_file_logging() sets propagate=False on the gobby package logger to prevent duplicate logs. This breaks pytest's caplog fixture because caplog captures via root logger handlers and depends on propagation. Tests need either a fixture enabling propagate=True during test execution, or should avoid using caplog.at_level(logger='gobby.utils.git') in favor of capturing all logs.", "type": "context", "importance": 0.95, "tags": ["logging", "testing", "caplog", "pytest", "gobby-logger-config"], "created_at": "2026-01-25T20:04:09.517652+00:00", "updated_at": "2026-01-25T20:04:09.517652+00:00", "source": "session", "source_id": "4042c9be-18da-4d31-9039-027a93af8c78"}
{"id": "mm-3860c4e5", "content": "Claude Code doesn't include tool_result in post-tool-use hooks, causing detection_helpers.py to receive empty tool_output dicts. This breaks error detection in detect_task_claim for close_task validation - when close_task fails validation (e.g., 'no_commits_linked'), the empty tool_output passes all error checks and incorrectly clears task_claimed=False.", "type": "fact", "importance": 0.95, "tags": ["claude-code-limitation", "detection_helpers", "close_task", "task_claimed", "bug-root-cause"], "created_at": "2026-01-25T17:15:06.972227+00:00", "updated_at": "2026-01-25T17:15:06.972227+00:00", "source": "session", "source_id": "b08118fe-cfa2-4c04-b92a-d381c05e7eda"}
{"id": "mm-cbd103cd", "content": "When updating gobby's version number, update it in TWO places: pyproject.toml and src/gobby/__init__.py", "type": "pattern", "importance": 0.9, "tags": "release,versioning,development", "created_at": "2026-02-05T00:41:11.939039+00:00", "updated_at": "2026-02-05T00:41:11.939039+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-bf7a7539", "content": "The gobby project has a pre-merge-commit hook that blocks automatic merge commits. When merging branches, if the hook fails, manually commit the merge using 'git commit' rather than relying on automatic merge commit creation.", "type": "pattern", "importance": 0.9, "tags": ["git", "merge", "pre-commit-hook", "gobby"], "created_at": "2026-01-26T22:59:23.544337+00:00", "updated_at": "2026-01-26T22:59:23.544337+00:00", "source": "session", "source_id": "b422c481-ba1d-44da-8912-666de487efbf"}
{"id": "mm-2e8319e2", "content": "In gobby's conductor module, pricing.py and token_tracker.py are intentionally placed in conductor/ (not a separate metrics/ module) because they are active control plane components that drive orchestration decisions, not passive observability. SessionTokenTracker.can_spawn_agent() gates agent spawning based on budget, and ConductorLoop uses BudgetChecker to throttle the loop when budget is exceeded.", "type": "fact", "importance": 0.9, "tags": ["architecture", "conductor", "budget-management", "cost-control"], "created_at": "2026-01-26T21:16:57.260247+00:00", "updated_at": "2026-01-26T21:16:57.260247+00:00", "source": "session", "source_id": "9ef8d770-7c10-4f8e-800a-a7c749644689"}
{"id": "mm-79c16332", "content": "Step workflows in gobby require explicit activation via activate_workflow() call before steps execute. The on_enter hook only runs after activation, not immediately when a child agent is spawned. Parent workflows (like meeseeks-box) must include activation instructions in the spawn prompt.", "type": "pattern", "importance": 0.9, "tags": ["workflows", "meeseeks", "lifecycle", "parent-child"], "created_at": "2026-01-26T14:25:46.470795+00:00", "updated_at": "2026-01-26T14:25:46.470795+00:00", "source": "session", "source_id": "4cb1f535-45d0-476c-92e1-5c11a06e1ef2"}
{"id": "mm-30645c7e", "content": "Gobby uses ~/.gobby/ directory for its database (gobby-hub.db), config (config.yaml), and other runtime files. When running different versions of gobby, they share this directory and database, which can cause schema compatibility issues. Use GOBBY_HOME environment variable to isolate different gobby instances if needed.", "type": "fact", "importance": 0.9, "tags": ["gobby", "database", "configuration", "environment"], "created_at": "2026-01-25T23:52:00.971538+00:00", "updated_at": "2026-01-25T23:52:00.971538+00:00", "source": "session", "source_id": "2ceaa340-cf01-4208-80b8-dcc482c3992c"}
{"id": "mm-2bb6bfa4", "content": "LocalTaskManager.get_task() in src/gobby/storage/tasks/_manager.py accepts multiple task ID formats (UUID, #N, N notation) and resolves them internally, but direct comparisons between task.id (UUID) and claimed_task_id values fail if claimed_task_id stores non-UUID formats.", "type": "fact", "importance": 0.9, "tags": ["gobby", "task-management", "id-formats", "bug-pattern"], "created_at": "2026-01-25T18:32:33.161333+00:00", "updated_at": "2026-01-25T18:32:33.161333+00:00", "source": "session", "source_id": "3fe55f9e-069d-470f-ab2f-03ceaf53a6b0"}
{"id": "mm-1a26cb0a", "content": "Task ID comparison bugs exist at _lifecycle.py:199 (claimed_task_id == resolved_id) and task_enforcement_actions.py:963 (t.id == claimed_task_id). These fail when claimed_task_id contains refs like '#6066' instead of UUIDs. Fix: ensure claimed_task_id always stores resolved UUIDs at storage time.", "type": "context", "importance": 0.9, "tags": ["gobby", "bug-location", "task-ids", "comparison"], "created_at": "2026-01-25T18:19:24.504439+00:00", "updated_at": "2026-01-25T18:19:24.504439+00:00", "source": "session", "source_id": "3fe55f9e-069d-470f-ab2f-03ceaf53a6b0"}
{"id": "mm-9a411c25", "content": "The gobby project uses SQLite with custom datetime adapters. The `_adapt_datetime` function in `database.py` (line 24) uses `isoformat(\" \")` which produces space-separated timestamps like \"2026-01-25 01:43:54\" instead of ISO 8601 standard \"2026-01-25T01:43:54\". This non-standard format can cause timestamp normalization issues in exported JSONL files.", "type": "fact", "importance": 0.9, "tags": ["database", "datetime", "sqlite", "bug-source"], "created_at": "2026-01-25T03:59:31.178992+00:00", "updated_at": "2026-01-25T03:59:31.178992+00:00", "source": "session", "source_id": "8dfb36ae-572d-4a12-a667-0e710b658a2d"}
{"id": "mm-fda429ea", "content": "gobby's spawn_agent tool uses a preflight capture pattern via prepare_gemini_spawn_with_preflight to obtain a Gemini session_id before launching the terminal. The preflight succeeds (capturing session_id in format that becomes run_id like 'gemini-{first8chars}'), but subsequent terminal spawn via 'open -na Ghostty.app' can fail silently—the macOS 'open' utility returns success even if Ghostty fails to execute the command afterward, making shell escaping of long prompts a potential failure point.", "type": "context", "importance": 0.85, "tags": ["gobby", "spawn_agent", "gemini", "terminal_spawn", "preflight", "failure_mode"], "created_at": "2026-01-28T20:27:23.834828+00:00", "updated_at": "2026-01-28T20:27:23.834828+00:00", "source": "session", "source_id": "d347d68e-869d-4a6e-a8d5-8fe855bba25e"}
{"id": "mm-3dcf766c", "content": "Prompt file creation in prompt_manager.py requires: (1) sanitize session_id to prevent path traversal by stripping separators/disallowed chars or using uuid4, (2) use thread-safe lock (_atexit_lock) around _atexit_registered check to prevent race conditions in atexit registration, (3) store safe path in _prompt_files_to_cleanup for cleanup on exit.", "type": "pattern", "importance": 0.85, "tags": ["security", "path-traversal", "thread-safety", "prompt-manager"], "created_at": "2026-01-27T22:52:38.926303+00:00", "updated_at": "2026-01-27T22:52:38.926303+00:00", "source": "session", "source_id": "935114fe-ccaa-4dfc-8f95-99956c976c4f"}
{"id": "mm-d2d969c7", "content": "Task lifecycle tools in _lifecycle.py must return success: False on errors so that _process_tool_proxy_result can correctly identify and handle task failures. Returning success: true with an error is a bug that masks failures.", "type": "fact", "importance": 0.85, "tags": ["architecture", "error-handling", "_lifecycle.py", "_process_tool_proxy_result"], "created_at": "2026-01-26T22:56:14.015774+00:00", "updated_at": "2026-01-26T22:56:14.015774+00:00", "source": "session", "source_id": "b422c481-ba1d-44da-8912-666de487efbf"}
{"id": "mm-874484a3", "content": "Terminal mode spawning (mode='terminal') should not use -p flag to allow multi-turn interaction. The -p flag causes single-turn exit and is only appropriate for headless spawning. This was a critical fix in spawn.py.", "type": "pattern", "importance": 0.85, "tags": ["spawn", "terminal-mode", "claude-integration"], "created_at": "2026-01-26T14:25:01.562910+00:00", "updated_at": "2026-01-26T14:25:01.562910+00:00", "source": "session", "source_id": "4cb1f535-45d0-476c-92e1-5c11a06e1ef2"}
{"id": "mm-099c9ea0", "content": "In gobby's detection_helpers.py, when handling close_task in the AFTER_TOOL hook (lines 67-81), the function should NOT clear task_claimed if tool_output is empty, since it cannot verify whether the close actually succeeded. The MCP proxy's close_task handles clearing task_claimed for genuine successes.", "type": "pattern", "importance": 0.85, "tags": ["detection_helpers", "close_task", "task_claimed", "fix-strategy"], "created_at": "2026-01-25T17:14:28.200002+00:00", "updated_at": "2026-01-25T17:14:28.200002+00:00", "source": "session", "source_id": "b08118fe-cfa2-4c04-b92a-d381c05e7eda"}
{"id": "mm-7b530aea", "content": "The gobby MCP proxy's close_task function has validation checks (validate_commit_requirements) that return errors BEFORE the code that clears task_claimed state (lines 192-207). So the proxy itself doesn't clear task_claimed on validation failures - only on actual successful closes.", "type": "fact", "importance": 0.85, "tags": ["_lifecycle.py", "close_task", "state-management", "validation-flow"], "created_at": "2026-01-25T17:14:28.199456+00:00", "updated_at": "2026-01-25T17:14:28.199456+00:00", "source": "session", "source_id": "b08118fe-cfa2-4c04-b92a-d381c05e7eda"}
{"id": "mm-eed85876", "content": "Migration 77 has a UNIQUE constraint issue on seq_num that requires clearing values to NULL before reassigning to avoid violations. This is a known gotcha when modifying sequence numbers in migrations.", "type": "context", "importance": 0.8, "tags": ["migration", "database", "constraints", "gobby"], "created_at": "2026-01-27T01:29:58.428788+00:00", "updated_at": "2026-01-27T01:29:58.428788+00:00", "source": "session", "source_id": "2bc8895b-b292-4b81-acfc-180c276ca5cd"}
{"id": "mm-04676fa3", "content": "The _LazyBool class in task_enforcement_actions.py lacks __eq__ and __ne__ operators, causing expressions like 'session_has_dirty_files == False' to skip thunk evaluation. Add __eq__(self, other) and __ne__(self, other) methods that coerce self to bool via bool(self) before comparison to ensure lazy evaluation is triggered and comparisons return correct True/False semantics.", "type": "pattern", "importance": 0.8, "tags": ["lazy-evaluation", "task-enforcement", "operator-overloading", "python-semantics"], "created_at": "2026-01-25T16:54:00.257505+00:00", "updated_at": "2026-01-25T16:54:00.257505+00:00", "source": "session", "source_id": "389037ea-8953-4e4f-bcb4-29c5dc468357"}
{"id": "mm-0dc68d2a", "content": "The _normalize_timestamp() function in sync/tasks.py should treat empty string as None (return None if ts == ''), and use regex pattern matching (e.g., r'Z|[+-]\\d{2}:\\d{2}$') to detect RFC3339 timezone suffixes instead of brittle slice checks. Only append 'Z' when the pattern does not match the timestamp suffix.", "type": "pattern", "importance": 0.8, "tags": ["timestamp-handling", "iso8601", "sync", "task-export", "regex-validation"], "created_at": "2026-01-25T04:38:01.653774+00:00", "updated_at": "2026-01-25T04:38:01.653774+00:00", "source": "session", "source_id": "389037ea-8953-4e4f-bcb4-29c5dc468357"}
{"id": "mm-41a61c2a", "content": "Memory ID generation in gobby uses '||' delimiter between content and project_id to prevent collisions (e.g., 'abc'+'def' vs 'abcd'+'ef'). This is implemented in src/gobby/storage/memories.py.", "type": "fact", "importance": 0.8, "tags": ["gobby", "memory-system", "id-generation", "collision-prevention"], "created_at": "2026-01-25T04:17:24.123650+00:00", "updated_at": "2026-01-25T04:17:24.123650+00:00", "source": "session", "source_id": "c9787d92-bd8e-4fcc-a158-05af9147f470"}
{"id": "mm-28d8d578", "content": "Test fixtures in gobby: protect_production_resources fixture patches load_config in already-imported modules (e.g., gobby.runner, gobby.mcp_proxy.stdio) to use safe_load_config with test DB paths. Must be added to test signature to ensure safe DB is used when instantiating GobbyRunner.", "type": "fact", "importance": 0.8, "tags": ["testing", "fixtures", "safety"], "created_at": "2026-01-25T04:04:50.334561+00:00", "updated_at": "2026-01-25T04:04:50.334561+00:00", "source": "session", "source_id": "90eefa0c-bedd-4489-bcd4-df7bf8a3cc6b"}
{"id": "mm-3f91e1c8", "content": "The _is_plan_file() function in task_enforcement_actions.py should explicitly check `if source != \"claude\"` rather than `if source and source != \"claude\"` to enforce that a source value must be present and not 'claude'. This prevents plan files from being processed without explicit source attribution.", "type": "pattern", "importance": 0.8, "tags": ["validation", "task-enforcement", "source-attribution"], "created_at": "2026-01-25T04:02:56.263283+00:00", "updated_at": "2026-01-25T04:02:56.263283+00:00", "source": "session", "source_id": "1a867b59-ad3d-4075-9020-6293616fbeb2"}
{"id": "mm-a028f56e", "content": "Gobby has migrated to database schema v75 as baseline minimum. Legacy migrations (versions 0-75) are from migrations_legacy.py, while new migrations v76+ go in MIGRATIONS list. run_migrations rejects versions below v75, and docstrings should reference v75+ not v60+.", "type": "fact", "importance": 0.78, "tags": ["database", "migrations", "schema-version"], "created_at": "2026-01-28T03:41:22.372041+00:00", "updated_at": "2026-01-28T03:41:22.372041+00:00", "source": "session", "source_id": "740c4be1-cfcc-4aa0-ab30-7a088d85d22d"}
{"id": "mm-2e8d0b10", "content": "Workflow activation on a session is persistent and requires explicit deactivation/ending via hook_dispatcher.py before the session can cleanly stop - accidental workflow activation can block session exit.", "type": "pattern", "importance": 0.75, "tags": ["workflow-lifecycle", "session-management", "debugging"], "created_at": "2026-01-28T20:38:12.091482+00:00", "updated_at": "2026-01-28T20:38:12.091482+00:00", "source": "session", "source_id": "8cc46e99-2e03-41f8-ba7e-7ad372450e56"}
{"id": "mm-f3c42990", "content": "When debugging gobby agent spawns, check: (1) session transcripts via gobby-sessions tools—empty transcript means agent never ran, (2) agent run records via agent runs queries, (3) gobby.log for 'Invalid JSON at line 0' warnings in transcript parsing. Silent failures can occur where spawn claims success but no Ghostty launches and no agent registers.", "type": "pattern", "importance": 0.75, "tags": ["gobby", "debugging", "troubleshooting", "spawn_agent", "validation"], "created_at": "2026-01-28T20:27:23.836631+00:00", "updated_at": "2026-01-28T20:27:23.836631+00:00", "source": "session", "source_id": "d347d68e-869d-4a6e-a8d5-8fe855bba25e"}
{"id": "mm-f4d2816d", "content": "Memory exports in gobby should sanitize user home paths by replacing absolute paths with '~' using _sanitize_content() method (src/gobby/sync/memories.py) to avoid exposing user-specific paths.", "type": "pattern", "importance": 0.75, "tags": ["gobby", "memory-export", "path-sanitization", "privacy"], "created_at": "2026-01-25T04:17:24.127397+00:00", "updated_at": "2026-01-25T04:17:24.127397+00:00", "source": "session", "source_id": "c9787d92-bd8e-4fcc-a158-05af9147f470"}
{"id": "mm-d79a184f", "content": "The gobby project uses a standard workflow: edit files → run tf8c78", "type": "fact", "importance": 0.5, "tags": [], "created_at": "2026-02-01T01:42:53.816206+00:00", "updated_at": "2026-02-01T01:42:53.816206+00:00", "source": "import", "source_id": null}
