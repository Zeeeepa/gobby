{"id": "mm-641447ad", "content": "Gobby has two session ID concepts that must be distinguished: (1) Gobby's internal session ID (_platform_session_id/session.id = database primary key UUID), and (2) External ID (event.session_id = Claude Code's session UUID). These are mapped via session_manager.get_session_id(external_id, source) and must be explicitly documented in code to prevent confusion.", "type": "fact", "importance": 0.95, "tags": ["session-management", "architecture", "critical-distinction"], "created_at": "2026-01-25T02:45:26.133236+00:00", "updated_at": "2026-01-25T02:45:26.133236+00:00", "source": "session", "source_id": "0ebb2c00-0f58-4c39-9370-eba1833dec33"}
{"id": "mm-fde88c25", "content": "Gobby has two session ID concepts that must be distinguished: (1) Gobby's internal session ID (_platform_session_id/session.id = database primary key UUID), and (2) External ID (event.session_id = Claude Code's session UUID). These are mapped via session_manager.get_session_id(external_id, source) and must be explicitly documented in code to prevent confusion.", "type": "fact", "importance": 0.95, "tags": ["session-management", "architecture", "critical-distinction"], "created_at": "2026-01-25T02:44:51.718449+00:00", "updated_at": "2026-01-25T02:44:51.718449+00:00", "source": "session", "source_id": "0ebb2c00-0f58-4c39-9370-eba1833dec33"}
{"id": "mm-27f96147", "content": "The gobby project has a memory deduplication bug: IDs are generated from content + project_id, but inconsistent project_id values (sometimes None) cause identical content to receive different IDs, bypassing deduplication. This results in ~50% of memories being duplicates with different hashes.", "type": "context", "importance": 0.95, "tags": ["bug", "memory-system", "deduplication", "critical"], "created_at": "2026-01-25T01:36:42.879682+00:00", "updated_at": "2026-01-25T01:36:42.879682+00:00", "source": "session", "source_id": "ff9fe45c-40e4-4d1e-b275-0ffcc43113c4"}
{"id": "mm-c26da176", "content": "The gobby project has a memory deduplication bug: IDs are generated from content + project_id, but inconsistent project_id values (sometimes None) cause identical content to receive different IDs, bypassing deduplication. This results in ~50% of memories being duplicates with different hashes.", "type": "context", "importance": 0.95, "tags": ["bug", "memory-system", "deduplication", "critical"], "created_at": "2026-01-25T00:07:01.247597+00:00", "updated_at": "2026-01-25T00:07:01.247597+00:00", "source": "session", "source_id": "ff9fe45c-40e4-4d1e-b275-0ffcc43113c4"}
{"id": "mm-d26eacfd", "content": "The gobby project has a memory deduplication bug: IDs are generated from content + project_id, but inconsistent project_id values (sometimes None) cause identical content to receive different IDs, bypassing deduplication. This results in ~50% of memories being duplicates with different hashes.", "type": "context", "importance": 0.95, "tags": ["bug", "memory-system", "deduplication", "critical"], "created_at": "2026-01-24T23:52:43.922346+00:00", "updated_at": "2026-01-24T23:52:43.922346+00:00", "source": "session", "source_id": "ff9fe45c-40e4-4d1e-b275-0ffcc43113c4"}
{"id": "mm-e6da01ce", "content": "Claude Code's hookEventName schema only accepts three valid values: 'PreToolUse', 'UserPromptSubmit', and 'PostToolUse'. The gobby adapter was sending invalid values like 'Stop' and 'SessionStart' which caused validation errors. The fix is to conditionally include hookSpecificOutput only for these three valid hook types.", "type": "fact", "importance": 0.9, "tags": ["gobby", "hook-validation", "claude-code-integration", "bug-fix"], "created_at": "2026-01-25T02:57:36.587846+00:00", "updated_at": "2026-01-25T02:57:36.587846+00:00", "source": "session", "source_id": "7096d287-3841-41b5-9c67-d6302cd4e560"}
{"id": "mm-1089f006", "content": "Claude Code's hookEventName schema only accepts three valid values: 'PreToolUse', 'UserPromptSubmit', and 'PostToolUse'. The gobby adapter was sending invalid values like 'Stop' and 'SessionStart' which caused validation errors. The fix is to conditionally include hookSpecificOutput only for these three valid hook types.", "type": "fact", "importance": 0.9, "tags": ["gobby", "hook-validation", "claude-code-integration", "bug-fix"], "created_at": "2026-01-25T02:56:09.653566+00:00", "updated_at": "2026-01-25T02:56:09.653566+00:00", "source": "session", "source_id": "7096d287-3841-41b5-9c67-d6302cd4e560"}
{"id": "mm-fe01c67d", "content": "The gobby project uses a blocking rule for file edits that requires eithbefore calling the embedding backend to prevent state inconsistency errors.", "type": "pattern", "importance": 0.9, "tags": ["search", "backend", "state-management", "embedding"], "created_at": "2026-01-25T02:52:14.701233+00:00", "updated_at": "2026-01-25T02:52:14.701233+00:00", "source": "session", "source_id": "3307065d-1ca3-4e38-8bd0-eb10052f94df"}
{"id": "mm-7e1bfccb", "content": "The gobby task enforcement workflow has an edge case where agents can revert edits manually (without committing), causing sesfollowed by re-export to jsonl.", "type": "fact", "importance": 0.9, "tags": ["gobby", "database", "tasks", "data-integrity"], "created_at": "2026-01-25T02:52:14.699504+00:00", "updated_at": "2026-01-25T02:52:14.699504+00:00", "source": "session", "source_id": "060fc15a-855d-4a8d-b290-0b6c5e628125"}
{"id": "mm-c5a64a11", "content": "Session ID mapping in Gobby: `external_id`/`event.session_id` = CLI's internal session UUID; `_platform_session_id` = Gobby's internal session.id (database PK). Both IDs are injected into agent context via system_message and additionalContext for MCP tool calls.", "type": "fact", "importance": 0.9, "tags": ["session-management", "agent-context", "architecture"], "created_at": "2026-01-25T02:52:14.698224+00:00", "updated_at": "2026-01-25T02:52:14.698224+00:00", "source": "session", "source_id": "461426bb-ab8f-4bda-ae12-7873e916f83a"}
{"id": "mm-b397c6c0", "content": "Port 8765 is registered with IANA for 'ultraseek-http' and conflicts with GUN relay peers and RSMP. Port 60334 (dynamic/private range 49152-65535) is unregistered and safe for custom services. WebSocket port should follow 'HTTP + 1' convention (8766→60335).", "type": "fact", "importance": 0.9, "tags": ["gobby", "ports", "configuration", "networking"], "created_at": "2026-01-25T02:52:14.696475+00:00", "updated_at": "2026-01-25T02:52:14.696475+00:00", "source": "session", "source_id": "b38d18dc-f2cc-4bbd-97ff-56ae187f0c4a"}
{"id": "mm-0cc18ead", "content": "Port 8765 is registered with IANA for 'ultraseek-http' and conflicts with GUN relay peers and RSMP. Port 60334 (dynamic/private range 49152-65535) is unregistered and safe for custom services. WebSocket port should follow 'HTTP + 1' convention (8766→60335).", "type": "fact", "importance": 0.9, "tags": ["gobby", "ports", "configuration", "networking"], "created_at": "2026-01-25T02:51:39.171537+00:00", "updated_at": "2026-01-25T02:51:39.171537+00:00", "source": "session", "source_id": "b38d18dc-f2cc-4bbd-97ff-56ae187f0c4a"}
{"id": "mm-5e0e9109", "content": "Session ID mapping in Gobby: `external_id`/`event.session_id` = CLI's internal session UUID; `_platform_session_id` = Gobby's internal session.id (database PK). Both IDs are injected into agent context via system_message and additionalContext for MCP tool calls.", "type": "fact", "importance": 0.9, "tags": ["session-management", "agent-context", "architecture"], "created_at": "2026-01-25T02:50:06.200109+00:00", "updated_at": "2026-01-25T02:50:06.200109+00:00", "source": "session", "source_id": "461426bb-ab8f-4bda-ae12-7873e916f83a"}
{"id": "mm-733ab012", "content": "Gobby uses workflow state detection to track task lifecycle. The `task_claimed` variable is set when tasks are claimedsystem where tasks must be claimed before modifying plan files. Attempting to write to plan files without a claimed task triggers hook errors. Always call the task claim tool before writing plan updates.", "type": "pattern", "importance": 0.9, "tags": ["gobby", "workflow", "task-system", "plan-files"], "created_at": "2026-01-25T02:45:26.136326+00:00", "updated_at": "2026-01-25T02:45:26.136326+00:00", "source": "session", "source_id": "5b9e2bd6-2c41-493a-b9c0-229eb1058ede"}
{"id": "mm-4d5c12b0", "content": "Event metadata should include both session IDs explicitly: _platform_session_id (Gobby's internal session.id) and external_id (CLI's session UUID). Both should also be included in systemMessage and additionalContext right after 'Session enhanced by gobby.' message to ensure clarity across request context.", "type": "pattern", "importance": 0.9, "tags": ["event-handlers", "metadata", "system-message"], "created_at": "2026-01-25T02:45:26.135156+00:00", "updated_at": "2026-01-25T02:45:26.135156+00:00", "source": "session", "source_id": "0ebb2c00-0f58-4c39-9370-eba1833dec33"}
{"id": "mm-0b9f7ecb", "content": "Event metadata should include both session IDs explicitly: _platform_session_id (Gobby's internal session.id) and external_id (CLI's session UUID). Both should also be included in systemMessage and additionalContext right after 'Session enhanced by gobby.' message to ensure clarity across request context.", "type": "pattern", "importance": 0.9, "tags": ["event-handlers", "metadata", "system-message"], "created_at": "2026-01-25T02:44:51.720710+00:00", "updated_at": "2026-01-25T02:44:51.720710+00:00", "source": "session", "source_id": "0ebb2c00-0f58-4c39-9370-eba1833dec33"}
{"id": "mm-8d5d71fa", "content": "The gobby project uses a task database stored in `.gobby/tasks.jsonl` with a SQL backend. Data integrity issues include closed tasks missing override_reason fields and orphan tasks with non-existent parent_ids. These can be cleaned via direct SQL updates followed by re-export to jsonl.", "type": "fact", "importance": 0.9, "tags": ["gobby", "database", "tasks", "data-integrity"], "created_at": "2026-01-25T02:10:33.176322+00:00", "updated_at": "2026-01-25T02:10:33.176322+00:00", "source": "session", "source_id": "060fc15a-855d-4a8d-b290-0b6c5e628125"}
{"id": "mm-d462843b", "content": "The gobby project uses a task database stored in `.gobby/tasks.jsonl` with a SQL backend. Data integrity issues include closed tasks missing override_reason fields and orphan tasks with non-existent parent_ids. These can be cleaned via direct SQL updates followed by re-export to jsonl.", "type": "fact", "importance": 0.9, "tags": ["gobby", "database", "tasks", "data-integrity"], "created_at": "2026-01-25T02:03:03.760441+00:00", "updated_at": "2026-01-25T02:03:03.760441+00:00", "source": "session", "source_id": "060fc15a-855d-4a8d-b290-0b6c5e628125"}
{"id": "mm-121fa6d2", "content": "The gobby task enforcement workflow has an edge case where agents can revert edits manually (without committing), causing session_has_dirty_files to return to 0, allowing them to close tasks with skip reasons without accounting for the work. This requires tracking a 'dirty file high water mark' or edit history that persists even after manual reverts.", "type": "context", "importance": 0.9, "tags": ["task-enforcement", "workflow-gap", "edge-case", "bug-discovery"], "created_at": "2026-01-25T02:02:30.445604+00:00", "updated_at": "2026-01-25T02:02:30.445604+00:00", "source": "session", "source_id": "b9765c3b-831d-4fa6-af6c-9a8161e72006"}
{"id": "mm-51a231a8", "content": "The gobby task enforcement workflow has an edge case where agents can revert edits manually (without committing), causing session_has_dirty_files to return to 0, allowing them to close tasks with skip reasons without accounting for the work. This requires tracking a 'dirty file high water mark' or edit history that persists even after manual reverts.", "type": "context", "importance": 0.9, "tags": ["task-enforcement", "workflow-gap", "edge-case", "bug-discovery"], "created_at": "2026-01-25T01:55:03.553356+00:00", "updated_at": "2026-01-25T01:55:03.553356+00:00", "source": "session", "source_id": "b9765c3b-831d-4fa6-af6c-9a8161e72006"}
{"id": "mm-110d0251", "content": "The gobby project uses workflow variables in `session-lifecycle.yaml` to configure task lifecycle policies, including `require_commit_before_close`, `block_no_commit_with_dirty`, and `clear_task_on_close`. The `_lifecycle.py` module enforces these policies.", "type": "fact", "importance": 0.9, "tags": ["architecture", "lifecycle", "configuration"], "created_at": "2026-01-25T01:36:42.906417+00:00", "updated_at": "2026-01-25T01:36:42.906417+00:00", "source": "session", "source_id": "77772daa-920c-4261-85e5-0fea2725d03a"}
{"id": "mm-0afc9c9b", "content": "To fix the deduplication bug: (1) normalize content before hashing (strip whitespace, lowercase), (2) add content_exists() check before storing new memories, (3) investigate why project_id is sometimes None vs populated, (4) cleanup existing duplicates by grouping normalized content and keeping oldest entries.", "type": "pattern", "importance": 0.9, "tags": ["bug-fix", "memory-system", "deduplication"], "created_at": "2026-01-25T01:36:42.904365+00:00", "updated_at": "2026-01-25T01:36:42.904365+00:00", "source": "session", "source_id": "ff9fe45c-40e4-4d1e-b275-0ffcc43113c4"}
{"id": "mm-2fef9b9c", "content": "The gobby project uses a task management system where tasks must be claimed before modifying plan files. Attempting to write to plan files without a claimed task triggers hook errors. Always call the task claim tool before writing plan updates.", "type": "pattern", "importance": 0.9, "tags": ["gobby", "workflow", "task-system", "plan-files"], "created_at": "2026-01-25T01:36:42.903227+00:00", "updated_at": "2026-01-25T01:36:42.903227+00:00", "source": "session", "source_id": "5b9e2bd6-2c41-493a-b9c0-229eb1058ede"}
{"id": "mm-dfd876eb", "content": "Plan mode detection in Gobby must handle two entry paths: (1) programmatic `EnterPlanMode` tool calls tracked via `detect_task_claim()`, and (2) UI-based entry detected via system reminders in the prompt (tracked via `detect_plan_mode_from_context()` in BEFORE_AGENT hooks). Both update the `plan_mode` variable in workflow state.", "type": "pattern", "importance": 0.9, "tags": ["plan-mode", "detection-helpers", "lifecycle-evaluator", "workflow-state"], "created_at": "2026-01-25T01:36:42.902154+00:00", "updated_at": "2026-01-25T01:36:42.902154+00:00", "source": "session", "source_id": "9ee2d23a-69d2-47e4-bd7b-002c848da563"}
{"id": "mm-d48af3d5", "content": "Gobby uses workflow state detection to track task lifecycle. The `task_claimed` variable is set when tasks are claimed and must be preserved if `close_task()` fails. State clearing happens in the MCP proxy's `close_task` function (in `_lifecycle.py`), not in detection helpers, because Claude Code doesn't include `tool_result` in post-tool-use hooks for MCP calls.", "type": "fact", "importance": 0.9, "tags": ["workflow-state", "task-lifecycle", "mcp-proxy", "claude-code-limitations"], "created_at": "2026-01-25T01:36:42.900603+00:00", "updated_at": "2026-01-25T01:36:42.900603+00:00", "source": "session", "source_id": "9ee2d23a-69d2-47e4-bd7b-002c848da563"}
{"id": "mm-c54a7860", "content": "The gobby project uses tool name normalization across adapters, with Claude Code (CC) names as canonical: Read, Write, Edit. Gemini adapter already implements this normalization; Codex adapter needs it added. Block rules should check against these normalized canonical names to remain CLI-agnostic.", "type": "fact", "importance": 0.9, "tags": ["architecture", "tool-normalization", "adapters", "block-rules"], "created_at": "2026-01-25T01:36:42.897199+00:00", "updated_at": "2026-01-25T01:36:42.897199+00:00", "source": "session", "source_id": "3d7faf43-6ef1-48a3-91f4-c04c55be51b8"}
{"id": "mm-60d0b019", "content": "The gobby project uses an MCP tool calling system with result processing logic. A `_process_tool_proxy_result` helper function consolidates duplicate result-processing logic used by both `call_mcp_tool` (line 508) and `mcp_proxy` (line 1101) endpoints. The helper handles metrics collection, error handling (raising HTTPException(404) for missing servers), debug logging, and returns a wrapped result dict with success/result/response_time_ms fields.", "type": "fact", "importance": 0.9, "tags": ["architecture", "tool-normalization", "adapters", "block-rules"], "created_at": "2026-01-25T01:36:42.894600+00:00", "updated_at": "2026-01-25T01:36:42.894600+00:00", "source": "session", "source_id": "3d7faf43-6ef1-48a3-91f4-c04c55be51b8"}
{"id": "mm-d14e98e1", "content": "The gobby project uses a `close_task` lifecycle tool with a `reason` parameter that accepts SKIP_REASONS: {\"duplicate\", \"already_implemented\", \"wont_fix\", \"obsolete\"}. This parameter is the intended escape hatch for edge cases instead of using a `no_commit_needed` flag, which the team is removing to enforce proper commit-based workflows.", "type": "fact", "importance": 0.9, "tags": ["gobby", "close_task", "lifecycle", "architecture"], "created_at": "2026-01-25T01:36:42.891824+00:00", "updated_at": "2026-01-25T01:36:42.891824+00:00", "source": "session", "source_id": "034f0f0a-f7d3-4a3b-b86d-1741a32b7516"}
{"id": "mm-15f073ef", "content": "The gobby project uses a unified search backend system with mode tracking. When fit_async() is called, the system must track which mode was used (_fitted_mode). During search_async(), a mode mismatch should trigger safe TF-IDF fallback and needs_refit() checks before calling the embedding backend to prevent state inconsistency errors.", "type": "pattern", "importance": 0.9, "tags": ["search", "backend", "state-management", "embedding"], "created_at": "2026-01-25T01:36:42.883748+00:00", "updated_at": "2026-01-25T01:36:42.883748+00:00", "source": "session", "source_id": "3307065d-1ca3-4e38-8bd0-eb10052f94df"}
{"id": "mm-97c0a223", "content": "The gobby project uses a unified search backend system with mode tracking. When fit_async() is called, the system must track which mode was used (_fitted_mode). During search_async(), a mode mismatch should trigger safe TF-IDF fallback and needs_refit() checks before calling the embedding backend to prevent state inconsistency errors.", "type": "pattern", "importance": 0.9, "tags": ["search", "backend", "state-management", "embedding"], "created_at": "2026-01-25T01:23:07.209580+00:00", "updated_at": "2026-01-25T01:23:07.209580+00:00", "source": "session", "source_id": "3307065d-1ca3-4e38-8bd0-eb10052f94df"}
{"id": "mm-d156957f", "content": "The gobby project uses a blocking rule for file edits that requires either a claimed task or plan mode to be active. The pattern checks for `~/.claude/plans/` files as an exemption, using substring matching `'/.claude/plans/' in normalized_path` to work cross-platform (Unix and Windows after normalization).", "type": "fact", "importance": 0.9, "tags": ["gobby", "file-editing", "plan-mode", "cross-platform"], "created_at": "2026-01-25T01:10:32.374828+00:00", "updated_at": "2026-01-25T01:10:32.374828+00:00", "source": "session", "source_id": "935097c4-cb68-449b-86bb-1bc40e791a7e"}
{"id": "mm-cb1a0558", "content": "The gobby project uses a blocking rule for file edits that requires either a claimed task or plan mode to be active. The pattern checks for `~/.claude/plans/` files as an exemption, using substring matching `'/.claude/plans/' in normalized_path` to work cross-platform (Unix and Windows after normalization).", "type": "fact", "importance": 0.9, "tags": ["gobby", "file-editing", "plan-mode", "cross-platform"], "created_at": "2026-01-25T01:09:54.919621+00:00", "updated_at": "2026-01-25T01:09:54.919621+00:00", "source": "session", "source_id": "935097c4-cb68-449b-86bb-1bc40e791a7e"}
{"id": "mm-5e40e17d", "content": "The gobby project has a hook system (hook_dispatcher.py) that enforces pre-tool validation. When writing files, the PreToolUse hook must complete successfully before file operations are allowed. Tasks must be created via mcp__gobby__call_tool before writing to protected files like plans.", "type": "pattern", "importance": 0.9, "tags": ["gobby", "hooks", "task-management", "file-operations"], "created_at": "2026-01-25T00:53:10.697107+00:00", "updated_at": "2026-01-25T00:53:10.697107+00:00", "source": "session", "source_id": "940ab854-c09e-4cee-bfbc-b18b55c5e6d6"}
{"id": "mm-ac12eb07", "content": "The gobby project has a hook system (hook_dispatcher.py) that enforces pre-tool validation. When writing files, the PreToolUse hook must complete successfully before file operations are allowed. Tasks must be created via mcp__gobby__call_tool before writing to protected files like plans.", "type": "pattern", "importance": 0.9, "tags": ["gobby", "hooks", "task-management", "file-operations"], "created_at": "2026-01-25T00:52:31.873661+00:00", "updated_at": "2026-01-25T00:52:31.873661+00:00", "source": "session", "source_id": "940ab854-c09e-4cee-bfbc-b18b55c5e6d6"}
{"id": "mm-87f251cf", "content": "Memory deduplication in gobby uses normalized content (stripped whitespace) to generate IDs via generate_prefixed_id('mm', normalized_content + project_str), but content_exists() in storage/memories.py compares against raw stored content. This mismatch causes duplicate detection to fail when content has extra whitespace. Fix: normalize inputs in content_exists() with strip() before DB comparison to match ID generation behavior.", "type": "pattern", "importance": 0.9, "tags": ["memory-system", "deduplication", "bug-fix", "content-hashing"], "created_at": "2026-01-25T00:35:51.541413+00:00", "updated_at": "2026-01-25T00:35:51.541413+00:00", "source": "session", "source_id": "2d818bad-d27e-477a-a7c3-6614521c559c"}
{"id": "mm-e08da539", "content": "The session-lifecycle.yaml workflow blocks close_task when require_commit_before_close=true, task_has_commits=false, and commit_sha is missing. However, documented edge-case reasons ('already_implemented', 'obsolete', 'duplicate', 'wont_fix') should bypass this requirement. The when condition must also check that tool_input.get('reason') is NOT in the allowed values to properly implement the edge-case flow.", "type": "pattern", "importance": 0.9, "tags": ["workflow", "task-lifecycle", "condition-logic", "edge-cases"], "created_at": "2026-01-25T00:35:51.539301+00:00", "updated_at": "2026-01-25T00:35:51.539301+00:00", "source": "session", "source_id": "2d818bad-d27e-477a-a7c3-6614521c559c"}
{"id": "mm-e742c90b", "content": "The session-lifecycle.yaml workflow blocks close_task when require_commit_before_close=true, task_has_commits=false, and commit_sha is missing. However, documented edge-case reasons ('already_implemented', 'obsolete', 'duplicate', 'wont_fix') should bypass this requirement. The when condition must also check that tool_input.get('reason') is NOT in the allowed values to properly implement the edge-case flow.", "type": "pattern", "importance": 0.9, "tags": ["workflow", "task-lifecycle", "condition-logic", "edge-cases"], "created_at": "2026-01-25T00:35:11.302238+00:00", "updated_at": "2026-01-25T00:35:11.302238+00:00", "source": "session", "source_id": "2d818bad-d27e-477a-a7c3-6614521c559c"}
{"id": "mm-c8231f38", "content": "Memory deduplication in gobby uses normalized content (stripped whitespace) to generate IDs via generate_prefixed_id('mm', normalized_content + project_str), but content_exists() in storage/memories.py compares against raw stored content. This mismatch causes duplicate detection to fail when content has extra whitespace. Fix: normalize inputs in content_exists() with strip() before DB comparison to match ID generation behavior.", "type": "pattern", "importance": 0.9, "tags": ["memory-system", "deduplication", "bug-fix", "content-hashing"], "created_at": "2026-01-25T00:35:11.300828+00:00", "updated_at": "2026-01-25T00:35:11.300828+00:00", "source": "session", "source_id": "2d818bad-d27e-477a-a7c3-6614521c559c"}
{"id": "mm-a051a9bc", "content": "To fix the deduplication bug: (1) normalize content before hashing (strip whitespace, low_close`, `block_no_commit_with_dirty`, and `clear_task_on_close`. The `_lifecycle.py` module enforces these policies.", "type": "fact", "importance": 0.9, "tags": ["architecture", "lifecycle", "configuration"], "created_at": "2026-01-25T00:27:49.313871+00:00", "updated_at": "2026-01-25T00:27:49.313871+00:00", "source": "session", "source_id": "77772daa-920c-4261-85e5-0fea2725d03a"}
{"id": "mm-fde51f14", "content": "The gobby project uses skip reasons (like reason=\"obsolete\") in close_task() instead of escape hatches like no_commit_needed. This is the preferred pattern for closing tasks without requiring commits.", "type": "pattern", "importance": 0.9, "tags": ["task-lifecycle", "close_task", "API-pattern"], "created_at": "2026-01-25T00:27:49.311643+00:00", "updated_at": "2026-01-25T00:27:49.311643+00:00", "source": "session", "source_id": "fc7aa685-5c27-40b2-9994-17597388cb8a"}
{"id": "mm-04c06f62", "content": "The gobby project uses skip reasons (like reason=\"obsolete\") in close_task() instead of escape hatches like no_commit_needed. This is the preferred pattern for closing tasks without requiring commits.", "type": "pattern", "importance": 0.9, "tags": ["task-lifecycle", "close_task", "API-pattern"], "created_at": "2026-01-25T00:26:55.541046+00:00", "updated_at": "2026-01-25T00:26:55.541046+00:00", "source": "session", "source_id": "fc7aa685-5c27-40b2-9994-17597388cb8a"}
{"id": "mm-1c34a692", "content": "The gobby project uses a `close_task` lifecycle tool with a `reason` parameter that accepts SKIP_REASONS: {\"duplicate\", \"already_implemented\", \"wont_fix\", \"obsolete\"}. This parameter is the intended escape hatch for edge cases instead of using a `no_commit_needed` flag, which the team is removing to enforce proper commit-based workflows.", "type": "fact", "importance": 0.9, "tags": ["gobby", "close_task", "lifecycle", "architecture"], "created_at": "2026-01-25T00:09:28.351842+00:00", "updated_at": "2026-01-25T00:09:28.351842+00:00", "source": "session", "source_id": "034f0f0a-f7d3-4a3b-b86d-1741a32b7516"}
{"id": "mm-64a4ac15", "content": "The gobby project uses a `close_task` lifecycle tool with a `reason` parameter that accepts SKIP_REASONS: {\"duplicate\", \"already_implemented\", \"wont_fix\", \"obsolete\"}. This parameter is the intended escape hatch for edge cases instead of using a `no_commit_needed` flag, which the team is removing to enforce proper commit-based workflows.", "type": "fact", "importance": 0.9, "tags": ["gobby", "close_task", "lifecycle", "architecture"], "created_at": "2026-01-25T00:09:01.848937+00:00", "updated_at": "2026-01-25T00:09:01.848937+00:00", "source": "session", "source_id": "034f0f0a-f7d3-4a3b-b86d-1741a32b7516"}
{"id": "mm-7da9f3e2", "content": "The gobby project uses an MCP tool calling system with result processing logic. A `_process_tool_proxy_result` helper function consolidates duplicate result-processing logic used by both `call_mcp_tool` (line 508) and `mcp_proxy` (line 1101) endpoints. The helper handles metrics collection, error handling (raising HTTPException(404) for missing servers), debug logging, and returns a wrapped result dict with success/result/response_time_ms fields.", "type": "fact", "importance": 0.9, "tags": ["architecture", "tool-normalization", "adapters", "block-rules"], "created_at": "2026-01-25T00:07:01.257871+00:00", "updated_at": "2026-01-25T00:07:01.257871+00:00", "source": "session", "source_id": "3d7faf43-6ef1-48a3-91f4-c04c55be51b8"}
{"id": "mm-dac38ef1", "content": "The gobby project uses tool name normalization across adapters, with Claude Code (CC) names as canonical: Read, Write, Edit. Gemini adapter already implements this normalization; Codex adapter needs it added. Block rules should check against these normalized canonical names to remain CLI-agnostic.", "type": "fact", "importance": 0.9, "tags": ["architecture", "tool-normalization", "adapters", "block-rules"], "created_at": "2026-01-25T00:07:01.253482+00:00", "updated_at": "2026-01-25T00:07:01.253482+00:00", "source": "session", "source_id": "3d7faf43-6ef1-48a3-91f4-c04c55be51b8"}
{"id": "mm-b6618b4e", "content": "Gobby uses workflow state detection to track task lifecycle. The `task_claimed` variable is set when tasks are claimed and must be preserved if `close_task()` fails. State clearing happens in the MCP proxy's `close_task` function (in `_lifecycle.py`), not in detection helpers, because Claude Code doesn't include `tool_result` in post-tool-use hooks for MCP calls.", "type": "fact", "importance": 0.9, "tags": ["workflow-state", "task-lifecycle", "mcp-proxy", "claude-code-limitations"], "created_at": "2026-01-25T00:07:01.252718+00:00", "updated_at": "2026-01-25T00:07:01.252718+00:00", "source": "session", "source_id": "9ee2d23a-69d2-47e4-bd7b-002c848da563"}
{"id": "mm-e058504c", "content": "Plan mode detection in Gobby must handle two entry paths: (1) programmatic `EnterPlanMode` tool calls tracked via `detect_task_claim()`, and (2) UI-based entry detected via system reminders in the prompt (tracked via `detect_plan_mode_from_context()` in BEFORE_AGENT hooks). Both update the `plan_mode` variable in workflow state.", "type": "pattern", "importance": 0.9, "tags": ["plan-mode", "detection-helpers", "lifecycle-evaluator", "workflow-state"], "created_at": "2026-01-25T00:07:01.251913+00:00", "updated_at": "2026-01-25T00:07:01.251913+00:00", "source": "session", "source_id": "9ee2d23a-69d2-47e4-bd7b-002c848da563"}
{"id": "mm-47b54d46", "content": "The gobby project uses a task management system where tasks must be claimed before modifying plan files. Attempting to write to plan files without a claimed task triggers hook errors. Always call the task claim tool before writing plan updates.", "type": "pattern", "importance": 0.9, "tags": ["gobby", "workflow", "task-system", "plan-files"], "created_at": "2026-01-25T00:07:01.251182+00:00", "updated_at": "2026-01-25T00:07:01.251182+00:00", "source": "session", "source_id": "5b9e2bd6-2c41-493a-b9c0-229eb1058ede"}
{"id": "mm-ee060ff2", "content": "To fix the deduplication bug: (1) normalize content before hashing (strip whitespace, lowercase), (2) add content_exists() check before storing new memories, (3) investigate why project_id is sometimes None vs populated, (4) cleanup existing duplicates by grouping normalized content and keeping oldest entries.", "type": "pattern", "importance": 0.9, "tags": ["bug-fix", "memory-system", "deduplication"], "created_at": "2026-01-25T00:07:01.250422+00:00", "updated_at": "2026-01-25T00:07:01.250422+00:00", "source": "session", "source_id": "ff9fe45c-40e4-4d1e-b275-0ffcc43113c4"}
{"id": "mm-b67a21a3", "content": "The gobby project uses workflow variables in `session-lifecycle.yaml` to configure task lifecycle policies, including `require_commit_before_close`, `block_no_commit_with_dirty`, and `clear_task_on_close`. The `_lifecycle.py` module enforces these policies.", "type": "fact", "importance": 0.9, "tags": ["architecture", "lifecycle", "configuration"], "created_at": "2026-01-25T00:07:01.249489+00:00", "updated_at": "2026-01-25T00:07:01.249489+00:00", "source": "session", "source_id": "77772daa-920c-4261-85e5-0fea2725d03a"}
