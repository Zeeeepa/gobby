{"id": "mm-e0776f19", "content": "When syncing bundled DB records that have a UNIQUE index (e.g., agent_definitions with idx_agent_defs_name_scope_project), do NOT use import-then-delete to achieve atomicity — the import will fail with UNIQUE constraint violation because the old record still exists. Instead, use manager.update() for in-place atomic updates, which issues a single UPDATE SQL statement that can't leave the DB in an inconsistent state. The delete-then-import pattern is also risky because if import fails after delete, the old record is permanently lost. The manager.update() approach solves both problems.", "type": "insight", "tags": ["database", "sqlite", "unique-constraint", "sync", "atomicity"], "created_at": "2026-02-16T16:44:13.979278+00:00", "updated_at": "2026-02-16T16:44:13.979278+00:00", "source": "mcp_tool", "source_id": "14c2a62f-851f-487f-b70c-a880538b86f6"}
{"id": "mm-1023c372", "content": "AgentDefinitionManager methods (delete, create, update) each manage their own database transactions using `self.db.transaction()` context manager. The `import_from_definition` method in sync.py calls `delete()` then `create()`, resulting in two separate transactions rather than a single atomic operation.", "type": "fact", "tags": ["gobby", "database", "transactions", "AgentDefinitionManager"], "created_at": "2026-02-16T16:41:11.836890+00:00", "updated_at": "2026-02-16T16:41:11.836890+00:00", "source": "session", "source_id": "14c2a62f-851f-487f-b70c-a880538b86f6"}
{"id": "mm-4a205820", "content": "When running tests asynchronously via the Task tool in gobby, test results are stored in agent output files at /tmp/agent_outputs/<agent-id>.jsonl. The TaskOutput tool can retrieve these results while the task is still running, allowing parallel work while waiting for test completion.", "type": "pattern", "tags": ["testing", "async", "task-tool", "workflow"], "created_at": "2026-02-16T16:37:44.921340+00:00", "updated_at": "2026-02-16T16:37:44.921340+00:00", "source": "session", "source_id": "14c2a62f-851f-487f-b70c-a880538b86f6"}
{"id": "mm-cd67dbdf", "content": "The gobby project uses a memories.jsonl file at .gobby/memories.jsonl to store project knowledge. This file can become corrupted (e.g., truncated JSON entries) and requires manual editing to fix. The file format is one JSON object per line with fields like 'id', 'content', 'memory_type', and 'tags'.", "type": "fact", "tags": ["gobby", "memories", "file-format", "corruption"], "created_at": "2026-02-16T16:37:44.735176+00:00", "updated_at": "2026-02-16T16:37:44.735176+00:00", "source": "session", "source_id": "14c2a62f-851f-487f-b70c-a880538b86f6"}
{"id": "mm-939fa4cb", "content": "The gobby project had a bug where WorkflowLoader instances were created without passing the session-lifetime state_manager parameter in multiple places (factory.py's _get_loader fallback and tool_filter.py). This caused workflow state to not persist across tool invocations. The fix requires passing state_manager to WorkflowLoader() constructor in all instantiation points.", "type": "fact", "tags": ["gobby", "workflow", "state-management", "bug", "WorkflowLoader"], "created_at": "2026-02-16T16:25:14.690684+00:00", "updated_at": "2026-02-16T16:25:14.690684+00:00", "source": "session", "source_id": "c7831efb-7001-444a-94c2-64ed3f4686be"}
{"id": "mm-a4730c02", "content": "In gobby test files, sequential integration tests require using `WorkflowLoader.from_yaml_path()` with `session.db_manager` (not `SimpleWorkflowLoader`) to properly persist workflow state. The test file is at `tests/mcp_proxy/tools/orchestration/test_sequential_integration.py` and previously failed because it used `SimpleWorkflowLoader` which doesn't persist to the database.", "type": "fact", "tags": ["gobby", "testing", "WorkflowLoader", "integration-tests", "database"], "created_at": "2026-02-16T16:25:07.426447+00:00", "updated_at": "2026-02-16T16:25:07.426447+00:00", "source": "session", "source_id": "e10c5d2b-0639-4ce1-bdd6-5e73ff29ebca"}
{"id": "mm-ba789b7b", "content": "The DB-first workflow migration (commit b6952be7) moved `_BUNDLED_WORKFLOWS_DIR` from `gobby.workflows.loader` to `gobby.storage.migrations`. Tests importing it from the old location will get ImportError. The same migration broke 4 tests in test_sequential_integration.py due to workflow state transitions no longer working with the legacy WorkflowLoader path (engine falls back to 'find_work' instead of loading the meeseeks-box workflow).", "type": "insight", "tags": ["workflows", "migrations", "db-first", "test-breakage"], "created_at": "2026-02-16T15:26:13.768301+00:00", "updated_at": "2026-02-16T15:26:13.768301+00:00", "source": "mcp_tool", "source_id": "e10c5d2b-0639-4ce1-bdd6-5e73ff29ebca"}
{"id": "mm-a7cd662d", "content": "In gobby's memory system, `memory_recall_relevant()` function in `memory.py` is async (line 131), but source code callers in `claude_code.py` invoke it without await, preventing memory retrieval from working during agent context injection workflows.", "type": "pattern", "tags": ["gobby", "memory-system", "async-pattern", "root-cause"], "created_at": "2026-02-16T05:05:13.247388+00:00", "updated_at": "2026-02-16T05:05:13.247388+00:00", "source": "session", "source_id": "a830f291-0641-4440-bf35-59ccd58c490d"}
{"id": "mm-7b22d6c2", "content": "Critical async bug in gobby: `handle_inject_context()` in `claude_code.py` calls `memory_recall_relevant()` (an async function) WITHOUT await, causing coroutine to never execute. The `/api/memories/update/{memory_id}` route also has similar missing await calls. This means memory recall silently fails during context injection.", "type": "fact", "tags": ["gobby", "bug", "async", "memory", "context-injection"], "created_at": "2026-02-16T05:05:13.210803+00:00", "updated_at": "2026-02-16T05:05:13.210803+00:00", "source": "session", "source_id": "a830f291-0641-4440-bf35-59ccd58c490d"}
{"id": "mm-66be7db3", "content": "run_migrations() calls _import_bundled_workflows() which imports ~12 YAML files from src/gobby/install/shared/workflows/ into workflow_definitions with source='bundled'. Tests that assert exact discovery counts will fail unless bundled entries are cleared first. Use autouse fixture: db.execute(\"DELETE FROM workflow_definitions WHERE source = 'bundled'\") to start tests with a clean table.", "type": "insight", "tags": ["testing", "migrations", "workflow-definitions", "bundled-workflows"], "created_at": "2026-02-16T01:40:27.614502+00:00", "updated_at": "2026-02-16T01:40:27.614502+00:00", "source": "mcp_tool", "source_id": "98155ff0-fe12-4d8d-aa29-2c176350bcef"}
{"id": "mm-a519f6c5", "content": "workflow_definitions table has FK constraint: project_id TEXT REFERENCES projects(id). SQLite FK enforcement is ON (database.py line 171). Tests using project-scoped workflows must create a real project via LocalProjectManager.create() first, then use project.id as project_id. Raw path strings like '/my/project' will cause IntegrityError.", "type": "insight", "tags": ["testing", "database", "fk-constraint", "workflow-definitions"], "created_at": "2026-02-16T01:40:23.744700+00:00", "updated_at": "2026-02-16T01:40:23.744700+00:00", "source": "mcp_tool", "source_id": "98155ff0-fe12-4d8d-aa29-2c176350bcef"}
{"id": "mm-d863c9c2", "content": "The gobby project recently refactored workflow/agent loading from a monolithic loader.py into a modular system split across loader.py (orchestration), loader_discovery.py (file discovery), and loader_cache.py (caching logic). The CLI installer in shared.py was updated to use get_all_workflows() instead of direct workflow/agent references.", "type": "context", "tags": ["gobby", "refactoring", "architecture", "workflow-loading"], "created_at": "2026-02-16T01:19:21.483949+00:00", "updated_at": "2026-02-16T01:19:21.483949+00:00", "source": "session", "source_id": "98155ff0-fe12-4d8d-aa29-2c176350bcef"}
{"id": "mm-dd557a0b", "content": "As of commit 03de1de2, mem0 references in tests have been reduced to a single file: `tests/storage/test_migration_104.py`. This is the only remaining test file containing mem0 references after the cleanup effort.", "type": "fact", "tags": ["mem0", "testing", "migration", "cleanup-status"], "created_at": "2026-02-16T01:14:51.736923+00:00", "updated_at": "2026-02-16T01:14:51.736923+00:00", "source": "session", "source_id": "d9fe49b1-21ab-4a83-b026-892070cccd96"}
{"id": "mm-954e9748", "content": "The gobby test suite previously had mem0 attribution tests in `tests/unit/test_prompt.py` that were removed as part of cleaning up mem0 references. After removal, all 28 tests still pass, confirming these tests were not critical to core functionality.", "type": "fact", "tags": ["testing", "mem0", "test_prompt.py"], "created_at": "2026-02-16T01:14:51.698448+00:00", "updated_at": "2026-02-16T01:14:51.698448+00:00", "source": "session", "source_id": "d9fe49b1-21ab-4a83-b026-892070cccd96"}
{"id": "mm-e8746920", "content": "CLI session transcripts stored in DB don't have an `id` field in their JSON structure, but the frontend code at useSessionMessages.ts:495-500 expects messages to have an `id` property when rendering. This mismatch causes the 'message.id is undefined' bug when displaying historical CLI sl -> Frontend rendering, and IDs are lost between storage and retrieval.", "type": "pattern", "tags": ["gobby", "cli-sessions", "message-processing", "architecture"], "created_at": "2026-02-16T01:14:37.561724+00:00", "updated_at": "2026-02-16T01:14:37.561724+00:00", "source": "session", "source_id": "697ac470-1937-4567-89eb-e92bacd1b39a"}
{"id": "mm-0317ce13", "content": "When gobby migrations encounter table conflicts between sequential migrations, the solution is to add DROP TABLE IF EXISTS <table_name>; at the start of the later migration rather than modifying the earlier one, since the migration runner executes statements in order ations.py and required updating test expectations for database-backed storage mechanisms (task #8353).", "type": "context", "tags": ["architecture", "database", "prompts", "migration"], "created_at": "2026-02-16T01:14:37.529971+00:00", "updated_at": "2026-02-16T01:14:37.529971+00:00", "source": "session", "source_id": "05ae25bb-e262-4222-a4c8-21456c161394"}
{"id": "mm-c483fb01", "content": "The MemoryManager class in src/gobby/memory/manager.py was missing a `reindex_embeddings` method that was being called from maintenance.py. The method was added to retrieve all memories (optionally filtered by project_id) and re-embed them using the existing `_embed_and_upsert` private method, processing them with asyncio.gather for concurrent embedding.", "type": "fact", "tags": ["gobby", "memory-manager", "embeddings", "reindexing", "bug-fix"], "created_at": "2026-02-16T01:14:37.494009+00:00", "updated_at": "2026-02-16T01:14:37.494009+00:00", "source": "session", "source_id": "640fc419-ef75-444e-8842-51511db3b10f"}
{"id": "mm-c8fa2475", "content": "The maintenance service in src/gobby/memory/services/maintenance.py calls `manager.reindex_embeddings()` but this method didn't exist in the MemoryManager class, requiring implementation to complete the reindexing workflow.", "type": "fact", "tags": ["gobby", "maintenance", "memory-manager", "missing-method"], "created_at": "2026-02-16T01:14:37.463386+00:00", "updated_at": "2026-02-16T01:14:37.463386+00:00", "source": "session", "source_id": "640fc419-ef75-444e-8842-51511db3b10f"}
{"id": "mm-e6bd0969", "content": "When adding scope columns to a DB table for the DB-first pattern (bundled/global/project), the create() method must auto-infer scope='project' when project_id is provided and scope is the default 'global'. Without this, existing callers that pass project_id without explicit scope will create records with scope='global', breaking the SQL scope precedence query (ORDER BY CASE scope WHEN 'project' THEN 1...).", "type": "insight", "tags": ["agent-definitions", "db-first-pattern", "scope-inference", "gotcha"], "created_at": "2026-02-16T01:12:05.162722+00:00", "updated_at": "2026-02-16T01:12:05.162722+00:00", "source": "mcp_tool", "source_id": "34d2864f-c825-4166-9757-856b2544f122"}
{"id": "mm-58277065", "content": "As of commit 03de1de2, mem0 attribution has been removed from the prompt test fixtures. Only one test file still references mem0: tests/storage/test_migration_104.py, which likely contains legacy migration tests for the old mem0 storage system.", "type": "fact", "tags": ["mem0", "testing", "migration", "cleanup-status"], "created_at": "2026-02-16T01:09:50.605570+00:00", "updated_at": "2026-02-16T01:09:50.605570+00:00", "source": "session", "source_id": "d9fe49b1-21ab-4a83-b026-892070cccd96"}
{"id": "mm-3a11d9fa", "content": "The maintenance service in src/gobby/memory/services/maintenance.py calls `manager.reindex_embeddings()` but this method didn't exist in the MemoryManager class, requiring implementation to complete the reindexing workflow.", "type": "fact", "tags": ["gobby", "maintenance", "memory-manager", "missing-method"], "created_at": "2026-02-16T01:04:43.968587+00:00", "updated_at": "2026-02-16T01:04:43.968587+00:00", "source": "session", "source_id": "640fc419-ef75-444e-8842-51511db3b10f"}
{"id": "mm-8b63978d", "content": "The MemoryManager class in src/gobby/memory/manager.py was missing a `reindex_embeddings` method that was being called from maintenance.py. The method was added to retrieve all memories (optionally filtered by project_id) and re-embed them using the existing `_embed_and_upsert` private method, processing them with asyncio.gather for concurrent embedding.", "type": "fact", "tags": ["gobby", "memory-manager", "embeddings", "reindexing", "bug-fix"], "created_at": "2026-02-16T01:04:43.907758+00:00", "updated_at": "2026-02-16T01:04:43.907758+00:00", "source": "session", "source_id": "640fc419-ef75-444e-8842-51511db3b10f"}
{"id": "mm-95b3d714", "content": "Pre-existing NameError in src/gobby/storage/migrations.py: the MIGRATIONS tuple list references `_migrate_agent_definitions_add_scope` but the function is not defined. This breaks tests that import through gobby.storage (via gobby.app_context -> gobby.storage.__init__ -> gobby.storage.migrations). Direct test imports via temp_db fixture still work. The servers/conftest.py triggers this import chain.", "type": "debugging", "tags": ["migrations", "pre-existing-bug", "testing"], "created_at": "2026-02-16T00:58:11.948899+00:00", "updated_at": "2026-02-16T00:58:11.948899+00:00", "source": "mcp_tool", "source_id": "4cb8075c-74af-4e0a-9a78-63a45748bf4b"}
{"id": "mm-c5c8c14b", "content": "The root cause of web chat UI losing conversation context was identified in `headless-lifecycle.yaml` line 5: it only specified `sources: [claude_sdk]` but web chat requires the `web_chat` source to be included in the sources list to maintain context between turns.", "type": "fact", "tags": ["gobby", "bug", "web_chat", "context_loss", "root_cause"], "created_at": "2026-02-16T00:54:30.295829+00:00", "updated_at": "2026-02-16T00:54:30.295829+00:00", "source": "session", "source_id": "718a964b-ab67-4502-b6c0-c15ff8bf271b"}
{"id": "mm-a896a218", "content": "In gobby's `summary_actions.py` (line 630), the `synthesize_title` function already handles dual field names for prompts: `context.event.get('prompt') or context.event.get('prompt_text')`. This pattern exists because different lifecycle sources may use different field names for the same data.", "type": "pattern", "tags": ["gobby", "summary_actions", "field_naming", "lifecycle"], "created_at": "2026-02-16T00:54:30.254694+00:00", "updated_at": "2026-02-16T00:54:30.254694+00:00", "source": "session", "source_id": "718a964b-ab67-4502-b6c0-c15ff8bf271b"}
{"id": "mm-26e1797e", "content": "The gobby project has dual lifecycle configurations: `headless-lifecycle.yaml` (line 5: `sources: [claude_sdk]`) for SDK/headless clients and a separate config for web chat UI. Web chat context loss bugs require checking which lifecycle config is active and whether it includes the `web_chat` source in addition to `claude_sdk`.", "type": "fact", "tags": ["gobby", "lifecycle", "configuration", "web_chat", "debugging"], "created_at": "2026-02-16T00:54:30.209110+00:00", "updated_at": "2026-02-16T00:54:30.209110+00:00", "source": "session", "source_id": "718a964b-ab67-4502-b6c0-c15ff8bf271b"}
{"id": "mm-58a35d92", "content": "In gobby's agent spawning flow, AgentRegistry imports WorkflowLoader lazily (inside spawn_agent method at src/gobby/servers/routes/agents.py:95) to avoid circular imports. WorkflowLoader is constructed with db parameter but doesn't store it as an instance variable - it only passes db to its parent WorkflowLoaderSyncMixin via super().__init__()", "type": "fact", "tags": ["gobby", "AgentRegistry", "WorkflowLoader", "circular-imports", "architecture"], "created_at": "2026-02-16T00:52:18.196784+00:00", "updated_at": "2026-02-16T00:52:18.196784+00:00", "source": "session", "source_id": "0e1ceabe-e379-41e1-b765-44ec994a55bd"}
{"id": "mm-ca53c10e", "content": "In `src/gobby/workflows/summary_actions.py` line 630, the `synthesize_title` function already handles both `event.prompt` and `event.user_message` field names for compatibility. This dual-field handling pattern is the correct approach for accessing user input across different event sources.", "type": "pattern", "tags": ["summary_actions", "event-handling", "field-compatibility", "synthesize_title"], "created_at": "2026-02-16T00:51:09.616883+00:00", "updated_at": "2026-02-16T00:51:09.616883+00:00", "source": "session", "source_id": "718a964b-ab67-4502-b6c0-c15ff8bf271b"}
{"id": "mm-3c4686ca", "content": "The headless lifecycle configuration at `.claude/lifecycles/headless-lifecycle.yml` line 5 has `sources: [claude_sdk]` which prevents web chat conversations from accessing memory/context. Web chat uses a different source identifier, so this field must be modified to include web chat sources for full context access.", "type": "fact", "tags": ["headless-lifecycle", "web-chat", "configuration", "context-access", "bug"], "created_at": "2026-02-16T00:51:09.613947+00:00", "updated_at": "2026-02-16T00:51:09.613947+00:00", "source": "session", "source_id": "718a964b-ab67-4502-b6c0-c15ff8bf271b"}
{"id": "mm-053ea54b", "content": "The project migrated from in-memory to database-backed prompt storage (commit b3d4deac, task #8352). This architectural change affected test files in src/gobby/workflows/state_actions.py and required updating test expectations for database-backed storage mechanisms (task #8353).", "type": "context", "tags": ["architecture", "database", "prompts", "migration"], "created_at": "2026-02-16T00:35:23.809962+00:00", "updated_at": "2026-02-16T00:35:23.809962+00:00", "source": "session", "source_id": "05ae25bb-e262-4222-a4c8-21456c161394"}
{"id": "mm-f4b4946a", "content": "The gobby project uses a branch naming convention with ticket IDs: format is `gobby-#<ticket_number>` (e.g., `gobby-#8352`, `gobby-#8353`). Commit messages follow the format `[gobby-#<ticket>] <type>: <description>` where type is feat/fix/etc.", "type": "pattern", "tags": ["git", "conventions", "workflow"], "created_at": "2026-02-16T00:35:23.805915+00:00", "updated_at": "2026-02-16T00:35:23.805915+00:00", "source": "session", "source_id": "05ae25bb-e262-4222-a4c8-21456c161394"}
{"id": "mm-57076e74", "content": "When gobby migrations encounter table conflicts between sequential migrations, the solution is to add DROP TABLE IF EXISTS <table_name>; at the start of the later migration rather than modifying the earlier one, since the migration runner executes statements in order and users may have already run earlier migrations.", "type": "pattern", "tags": ["migrations", "database", "best-practices"], "created_at": "2026-02-16T00:30:31.777942+00:00", "updated_at": "2026-02-16T00:30:31.777942+00:00", "source": "session", "source_id": "54e2afb6-1573-4945-9493-3ee8cbb50cb1"}
{"id": "mm-9916ead9", "content": "The gobby migration system (migrations.py) runs migrations sequentially by splitting SQL on `;` and executing each statement. Migration 106 failed because it tried to CREATE TABLE prompts, but an older prompts table already existed from migration 105 with a different schema (included tier, source_type, source_id, message_preview columns). The fix required adding DROP TABLE IF EXISTS prompts; before the CREATE TABLE statement in migration 106.", "type": "fact", "tags": ["migrations", "database", "schema-conflict", "debugging"], "created_at": "2026-02-16T00:30:31.774354+00:00", "updated_at": "2026-02-16T00:30:31.774354+00:00", "source": "session", "source_id": "54e2afb6-1573-4945-9493-3ee8cbb50cb1"}
{"id": "mm-71ca78ee", "content": "When mocking PromptLoader for tests that use validation or other template-rendering code, the render mock must pass through context variables (not return a static string). Use `side_effect=lambda path, ctx: '\\n'.join(str(v) for v in ctx.values() if v)` so tests that assert specific content appears in the rendered prompt still pass. A static mock like `render.return_value='fixed string'` will break tests that check for file_context, criteria_text, etc.", "type": "pattern", "tags": ["testing", "PromptLoader", "mocking", "validation"], "created_at": "2026-02-16T00:04:53.509327+00:00", "updated_at": "2026-02-16T00:04:53.509327+00:00", "source": "mcp_tool", "source_id": "05ae25bb-e262-4222-a4c8-21456c161394"}
{"id": "mm-70536b7c", "content": "gobby's useSessions hook (src/hooks/useSessions.ts) provides deleteSession(sessionId) function that: 1) calls window.electron?.deleteSession(sessionId) for IPC deletion, 2) immediately updates local React state by filtering out the deleted session, 3) returns both the deleteSession function and sessions array. The sessions are typed as GobbySession[] and filtered by projectType in App.tsx before being passed to UI components.", "type": "fact", "tags": ["gobby", "useSessions", "deleteSession", "electron-ipc"], "created_at": "2026-02-16T00:04:18.180888+00:00", "updated_at": "2026-02-16T00:04:18.180888+00:00", "source": "session", "source_id": "a9b4d56d-83e7-49a4-8d55-4c13f53f3a00"}
{"id": "mm-89b3fe92", "content": "In gobby's web chat UI, the conversation deletion flow requires: 1) ConversationPicker displays sessions and has onSelectSession callback, 2) ChatPage wires up ConversationState callbacks (onNewChat, onSelectSession, onDeleteSession) passed from App.tsx, 3) App.tsx provides startNewChat/handleSelectSession/handleDeleteSession implementations, 4) useSessions hook exposes deleteSession(id) which calls window.electron?.deleteSession and updates local state. The webChatSessions array in App.tsx filters sessions by projectType === 'web-chat' before passing to ConversationPicker.", "type": "pattern", "tags": ["gobby", "conversation-deletion", "architecture", "react-flow"], "created_at": "2026-02-16T00:04:18.152470+00:00", "updated_at": "2026-02-16T00:04:18.152470+00:00", "source": "session", "source_id": "a9b4d56d-83e7-49a4-8d55-4c13f53f3a00"}
{"id": "mm-b590183a", "content": "DaemonClient class in src/gobby/utils/daemon_client.py provides a check_health() method for CLI health checks. The daemon runs on a configurable port (default 8765) using httpx for HTTP communication between CLI and daemon processes.", "type": "fact", "tags": ["gobby", "DaemonClient", "daemon", "API"], "created_at": "2026-02-16T00:04:07.350283+00:00", "updated_at": "2026-02-16T00:04:07.350283+00:00", "source": "session", "source_id": "aa0223dc-8931-4cdf-8855-9a4532f74550"}
{"id": "mm-328b6580", "content": "PipelineExecutor is instantiated in 3 different places in the gobby codebase: daemon.py (via _create_workflow_engine helper), run.py, and rerun.py. This fragmentation is the root cause of the daemon health check bug - the CLI's gobby status command uses DaemonClient.check_health() which doesn't properly verify the daemon's PipelineExecutor state.", "type": "fact", "tags": ["gobby", "PipelineExecutor", "daemon", "bug-root-cause", "architecture"], "created_at": "2026-02-16T00:04:07.322570+00:00", "updated_at": "2026-02-16T00:04:07.322570+00:00", "source": "session", "source_id": "aa0223dc-8931-4cdf-8855-9a4532f74550"}
{"id": "mm-d59747bc", "content": "The discover_lifecycle_workflows method in gobby's HooksManager has a signature issue causing 30+ PytestWarnings. The method is called throughout tests without the project_path parameter, but grep shows it's defined with `project_path: Path | str | None = None` at line 625-626 in the implementation. This suggests a parameter mismatch between the method signature and how tests are calling it.", "type": "fact", "tags": ["hooks", "api-mismatch", "lifecycle-workflows", "root-cause"], "created_at": "2026-02-15T23:52:05.845253+00:00", "updated_at": "2026-02-15T23:52:05.845253+00:00", "source": "session", "source_id": "93cea4df-be3e-4986-b0b6-cb54c06d1d50"}
{"id": "mm-09d482f3", "content": "In the gobby project, pytest warnings about 'cannot collect test class' occur when test classes inherit from fixtures (e.g., TestDiscoveryWorkflows inheriting from BaseDiscoveryHookTest). The warnings appear as PytestCollectionWarning and can be suppressed by adding `pytestmark = pytest.mark.filterwarnings('ignore::pytest.PytestCollectionWarning')` to the test file. Without individual warning details, use `grep -n 'class.*Test.*(' <file>` to find test classes that inherit from fixtures.", "type": "fact", "tags": ["pytest", "warnings", "test-infrastructure", "debugging"], "created_at": "2026-02-15T23:52:05.842263+00:00", "updated_at": "2026-02-15T23:52:05.842263+00:00", "source": "session", "source_id": "93cea4df-be3e-4986-b0b6-cb54c06d1d50"}
{"id": "mm-20c39797", "content": "The SessionMessageProcessor in gobby handles CLI session messages by storing them to DB via `store_assistant_message()`, but this storage path doesn't preserve or generate message IDs. The message flow is: CLI input -> SessionMessageProcessor -> DB storage -> API retrieval -> Frontend rendering, and IDs are lost between storage and retrieval.", "type": "pattern", "tags": ["gobby", "cli-sessions", "message-processing", "architecture"], "created_at": "2026-02-15T23:08:41.895742+00:00", "updated_at": "2026-02-15T23:08:41.895742+00:00", "source": "session", "source_id": "697ac470-1937-4567-89eb-e92bacd1b39a"}
{"id": "mm-0d9bc240", "content": "CLI session transcripts stored in DB don't have an `id` field in their JSON structure, but the frontend code at useSessionMessages.ts:495-500 expects messages to have an `id` property when rendering. This mismatch causes the 'message.id is undefined' bug when displaying historical CLI sessions. The API returns messages without IDs, but the frontend assumes all messages have them.", "type": "fact", "tags": ["gobby", "bug", "cli-sessions", "message-format", "frontend-backend-mismatch"], "created_at": "2026-02-15T23:08:41.860537+00:00", "updated_at": "2026-02-15T23:08:41.860537+00:00", "source": "session", "source_id": "697ac470-1937-4567-89eb-e92bacd1b39a"}
{"id": "mm-7ff9750e", "content": "Task closure in gobby requires passing the commit SHA to close_task. The commit message format is '[version commit_sha] [gobby-#task_id] type: description'. Example from session: '[0.2.17 b3d4deac] [gobby-#8352] feat: database-backed prompt storage' where b3d4deac is the SHA passed to close_task.", "type": "fact", "tags": ["gobby", "task-management", "commit-format"], "created_at": "2026-02-15T20:25:06.190222+00:00", "updated_at": "2026-02-15T20:25:06.190222+00:00", "source": "session", "source_id": "54e2afb6-1573-4945-9493-3ee8cbb50cb1"}
{"id": "mm-b35575c8", "content": "The gobby project uses a pre-tool-use hook that validates task state before allowing close_task to execute. If attempting to close a task without committing changes first, the hook will error with 'Task #XXXX is still in_progress. Close it with close_task after committing.' The workflow requires: 1) commit changes, 2) then call close_task with commit_sha parameter.", "type": "pattern", "tags": ["gobby", "task-management", "hooks", "workflow"], "created_at": "2026-02-15T20:25:06.188490+00:00", "updated_at": "2026-02-15T20:25:06.188490+00:00", "source": "session", "source_id": "54e2afb6-1573-4945-9493-3ee8cbb50cb1"}
{"id": "mm-5776848c", "content": "When migrating a module from filesystem to database backing (like PromptLoader), making the `db` parameter optional with a lazy `LocalDatabase()` fallback in `_get_db()` enables gradual migration. Callers with easy db access pass it explicitly; others (CLI, deep call chains) work via the lazy fallback. This avoids a big-bang migration of all callers.", "type": "pattern", "tags": ["architecture", "migration", "database", "lazy-init"], "created_at": "2026-02-15T20:23:53.591976+00:00", "updated_at": "2026-02-15T20:23:53.591976+00:00", "source": "mcp_tool", "source_id": "54e2afb6-1573-4945-9493-3ee8cbb50cb1"}
{"id": "mm-5b0e53d0", "content": "Circular import pitfall when re-exporting from __init__.py: In gobby, `prompts/__init__.py` re-exporting `sync_bundled_prompts` from `prompts/sync.py` caused a circular import because `sync.py` imports from `storage/prompts.py`, which imports from `prompts/models.py` (triggering `prompts/__init__.py`). Fix: don't re-export from __init__.py; callers import directly from `prompts.sync`. General rule: avoid re-exporting from __init__.py when the submodule has cross-package dependencies.", "type": "pattern", "tags": ["architecture", "imports", "circular-import", "python"], "created_at": "2026-02-15T20:23:50.151559+00:00", "updated_at": "2026-02-15T20:23:50.151559+00:00", "source": "mcp_tool", "source_id": "54e2afb6-1573-4945-9493-3ee8cbb50cb1"}
{"id": "mm-c8f7274e", "content": "Edit tool requires reading a file before writing to it - attempting to Edit without a prior Read results in 'File has not been read yet' error. This is a strict ordering requirement in the tool usage protocol.", "type": "pattern", "tags": ["tools", "Edit", "Read", "error-handling", "workflow"], "created_at": "2026-02-15T19:56:53.764507+00:00", "updated_at": "2026-02-15T19:56:53.764507+00:00", "source": "session", "source_id": "54e2afb6-1573-4945-9493-3ee8cbb50cb1"}
{"id": "mm-addca8b0", "content": "ActionContext (workflows/actions.py) requires a `db` parameter for database access. When registering handoff tools via register_handoff_tools(), the function signature requires both session_manager and db parameters. Consumers like memory/manager.py must pass db explicitly when creating ActionContext instances.", "type": "fact", "tags": ["workflows", "ActionContext", "database", "handoff", "architecture"], "created_at": "2026-02-15T19:56:53.760714+00:00", "updated_at": "2026-02-15T19:56:53.760714+00:00", "source": "session", "source_id": "54e2afb6-1573-4945-9493-3ee8cbb50cb1"}
{"id": "mm-d54387fc", "content": "In gobby's tool summarization system (`src/gobby/summarizer/tool_summarizer.py`), the summarizer is instantiated via `container.get_summarizer()` rather than direct imports. The codebase follows a pattern where services are accessed through the container rather than direct instantiation.", "type": "pattern", "tags": ["gobby", "service-container", "tool-summarizer", "instantiation-pattern"], "created_at": "2026-02-15T19:48:06.278261+00:00", "updated_at": "2026-02-15T19:48:06.278261+00:00", "source": "session", "source_id": "61bd11ae-24dc-4712-8cfe-a337f4520f8f"}
{"id": "mm-b588b676", "content": "The gobby project has a service container pattern in `src/gobby/daemon/container.py` that provides dependency injection. The module exports both a `ServiceContainer` class and convenience functions (`get_llm_client()`, `get_memory_service()`, `get_tools()`) that wrap container access. These convenience functions are only used within the container module itself, not by external callers.", "type": "fact", "tags": ["gobby", "architecture", "dependency-injection", "service-container"], "created_at": "2026-02-15T19:48:06.275902+00:00", "updated_at": "2026-02-15T19:48:06.275902+00:00", "source": "session", "source_id": "61bd11ae-24dc-4712-8cfe-a337f4520f8f"}
{"id": "mm-86f302dd", "content": "Bash tool invocations with `cd` commands change the working directory for subsequent commands in the same session. This caused `ruff format` to fail when run after `cd ui && npm run build` because it couldn't find Python files. Need to use absolute paths or reset directory after cd operations.", "type": "pattern", "tags": ["gobby", "bash-tool", "working-directory", "gotcha"], "created_at": "2026-02-15T18:45:11.554851+00:00", "updated_at": "2026-02-15T18:45:11.554851+00:00", "source": "session", "source_id": "e7963aeb-624d-41ac-84da-62fdc7f2c4c9"}
{"id": "mm-f16ee139", "content": "In gobby's agent event handlers, the chain to access workflow state is `self._workflow_handler.engine.state_manager` (WorkflowHookHandler has `self.engine`, which has `state_manager`). This specific object path is needed to access workflow state from within hook handlers.", "type": "fact", "tags": ["gobby", "architecture", "hooks", "workflow", "state-manager"], "created_at": "2026-02-15T18:45:11.551872+00:00", "updated_at": "2026-02-15T18:45:11.551872+00:00", "source": "session", "source_id": "e7963aeb-624d-41ac-84da-62fdc7f2c4c9"}
{"id": "mm-52fd07c0", "content": "The gobby project's LICENSE.md file contains Apache-2.0 license text, but pyproject.toml initially had 'license = \"MIT\"' on line 6. This mismatch was corrected to Apache-2.0 in commit 00e25048 (gobby-#8346).", "type": "fact", "tags": ["gobby", "license", "pyproject.toml", "configuration"], "created_at": "2026-02-15T18:23:22.875069+00:00", "updated_at": "2026-02-15T18:23:22.875069+00:00", "source": "session", "source_id": "50acd347-04ba-4448-9f00-8277e213e77d"}
{"id": "mm-183c328b", "content": "CodeRabbit suggestions about wrapping SQLite calls in asyncio.to_thread() (in dedup.py, loader.py, loader_discovery.py, routes/workflows.py) are over-engineered for this project. SQLite reads are sub-millisecond on local storage and the event loop isn't meaningfully blocked. Same for suggestions about paginating list_memories(limit=10000) or reindex_embeddings(limit=100000) - these limits are generous for a local-first tool.", "type": "fact", "tags": ["architecture", "async", "sqlite", "code-review"], "created_at": "2026-02-15T18:05:10.591355+00:00", "updated_at": "2026-02-15T18:05:10.591355+00:00", "source": "mcp_tool", "source_id": "3362a857-3d11-49ad-a867-1aa6cb5954ce"}
{"id": "mm-df6c41e0", "content": "neo4j_client.py has Cypher injection vulnerabilities: merge_node interpolates labels directly into Cypher strings (line ~321), merge_relationship interpolates rel_type (line ~348), and set_node_vector interpolates property_name (line ~374). All need identifier validation (regex ^[A-Za-z_][A-Za-z0-9_]*$) before string interpolation. Also set_node_vector has an unused index_name parameter that's dead code.", "type": "fact", "tags": ["security", "neo4j", "cypher-injection"], "created_at": "2026-02-15T18:05:06.060900+00:00", "updated_at": "2026-02-15T18:05:06.060900+00:00", "source": "mcp_tool", "source_id": "3362a857-3d11-49ad-a867-1aa6cb5954ce"}
{"id": "mm-97b84883", "content": "react-force-graph-3d exposes D3 force engine via fgRef.current.d3Force(forceName). To fix node clumping with large graphs (300+ nodes), configure: charge strength -120 (default -30), link distance 60 (default 30), center strength 0.05 (default 1). Must be called in a useEffect after graph mounts. zoomToFit(ms) animates camera to frame all nodes.", "type": "technical", "tags": ["react-force-graph-3d", "d3-force", "knowledge-graph", "frontend"], "created_at": "2026-02-15T17:52:09.931819+00:00", "updated_at": "2026-02-15T17:52:09.931819+00:00", "source": "mcp_tool", "source_id": "baa80692-3993-4d75-a69b-c99517fdfc6d"}
{"id": "mm-7f389b30", "content": "The KnowledgeGraph.tsx component uses react-force-graph-3d but the ForceGraph3D element has zero dimensions (0x0 pixels) causing it not to render. The root cause is missing width/height props or parent container sizing - the graph requires explicit dimensions to render properly.", "type": "fact", "tags": ["gobby", "neo4j", "react-force-graph-3d", "rendering-bug", "KnowledgeGraph"], "created_at": "2026-02-15T17:49:07.579962+00:00", "updated_at": "2026-02-15T17:49:07.579962+00:00", "source": "session", "source_id": "933e203a-01de-4bad-96ac-2e318cf2cd22"}
{"id": "mm-f6bb71cb", "content": "The MemoryManager._kg_service is only initialized when llm_service, vector_store, AND embed_fn are all provided. In runner.py, MemoryManager is created without these, so _kg_service is always None in the daemon. The graph read path (get_entity_graph, get_entity_neighbors) doesn't need LLM or embeddings — it only queries Neo4j. Fixed by falling back to _neo4j_client directly for read operations when _kg_service is unavailable.", "type": "pattern", "tags": ["neo4j", "memory-manager", "architecture"], "created_at": "2026-02-15T17:38:36.133005+00:00", "updated_at": "2026-02-15T17:38:36.133005+00:00", "source": "mcp_tool", "source_id": "933e203a-01de-4bad-96ac-2e318cf2cd22"}
{"id": "mm-650a03b3", "content": "The gobby project has bundled prompts that should be read-only in production but editable in dev mode. Dev mode detection is inconsistent across the codebase - some components check for dev mode differently. Found via grep: `allow_origins=[\"*\"]` is configured for dev mode in src/gobby/servers/http.py:513.", "type": "fact", "tags": ["dev-mode", "bundled-prompts", "configuration", "gobby"], "created_at": "2026-02-15T17:11:47.005841+00:00", "updated_at": "2026-02-15T17:11:47.005841+00:00", "source": "session", "source_id": "50acd347-04ba-4448-9f00-8277e213e77d"}
{"id": "mm-4d31ad29", "content": "In the gobby project, mem0 integration cleanup involves removing: useMem0Status hook from web/src/hooks/useMemory.ts, .mem0-badge CSS from web/src/styles/index.css, and the /verify endpoint tests from server/tests/test_memory.py and server/tests/test_routes.py. These components were verified as dead code through grep searches showing only 2 references (both in the files being modified).", "type": "fact", "tags": ["gobby", "mem0", "cleanup", "dead-code"], "created_at": "2026-02-15T16:43:13.431290+00:00", "updated_at": "2026-02-15T16:43:13.431290+00:00", "source": "session", "source_id": "e3821b21-475f-46d5-96dd-bda762feb5f6"}
{"id": "mm-f7c4bd49", "content": "Gobby daemon runs with PID file at ~/.gobby/gobby.pid and logs at ~/.gobby/logs. Pipeline executions return execution_id format 'pe-<uuid>' and can complete successfully with status='completed'.", "type": "fact", "tags": ["gobby", "daemon", "file-locations", "pipeline-execution"], "created_at": "2026-02-15T16:27:11.860759+00:00", "updated_at": "2026-02-15T16:27:11.860759+00:00", "source": "session", "source_id": "28483842-c657-4abd-a733-4c415aede528"}
{"id": "mm-d12262c7", "content": "The gobby MCP server requires manual tool rediscovery after restarts using mcp__gobby_list_mcp_tools. Tools like list_pipelines and run_pipeline won't be available until explicitly discovered through this call - they don't auto-register on server startup.", "type": "fact", "tags": ["gobby", "mcp", "tool-discovery", "server-restart"], "created_at": "2026-02-15T16:27:11.838475+00:00", "updated_at": "2026-02-15T16:27:11.838475+00:00", "source": "session", "source_id": "28483842-c657-4abd-a733-4c415aede528"}
{"id": "mm-d29a5f9f", "content": "Both `session-lifecycle.yaml` and `headless-lifecycle.yaml` contain the `synthesize_title` action and need to be updated together when modifying title synthesis behavior. The action appears after `detect_plan_mode_from_context` in the workflow sequence.", "type": "pattern", "tags": ["gobby", "session-lifecycle", "headless-lifecycle", "workflows"], "created_at": "2026-02-15T16:24:59.951347+00:00", "updated_at": "2026-02-15T16:24:59.951347+00:00", "source": "session", "source_id": "2adf6890-147e-4f88-85c6-b176394f322c"}
{"id": "mm-ae354fdc", "content": "The `synthesize_title` action in session-lifecycle.yaml uses two prompts: `prompt` (first prompt) and `continuation_prompt` (for 'continue' input). The handler always extracts `title_prompt` from context (defaults to `continuation_prompt`), making it impossible to use the first-prompt behavior when a plan is resumed with 'continue'. This causes 'continue' to become the literal title instead of generating a contextual one.", "type": "fact", "tags": ["gobby", "session-lifecycle", "synthesize_title", "bug"], "created_at": "2026-02-15T16:24:59.949033+00:00", "updated_at": "2026-02-15T16:24:59.949033+00:00", "source": "session", "source_id": "2adf6890-147e-4f88-85c6-b176394f322c"}
{"id": "mm-d06e1fd9", "content": "When rebuilding the Neo4j knowledge graph in gobby, memories must be processed in batches to avoid memory issues. The script uses `batch_size=100` and processes memories with `graph.add_memory(memory)` followed by `graph.commit()` after each batch. Without batching, the rebuild process fails with memory errors.", "type": "pattern", "tags": ["gobby", "neo4j", "knowledge-graph", "batch-processing", "rebuild"], "created_at": "2026-02-15T16:14:54.374393+00:00", "updated_at": "2026-02-15T16:14:54.374393+00:00", "source": "session", "source_id": "933e203a-01de-4bad-96ac-2e318cf2cd22"}
{"id": "mm-825f522f", "content": "The gobby memory system uses `LocalMemoryManager` class from `gobby.storage.memories` module (not `MemoryManager`). To access all memories, use `LocalMemoryManager().list_memories()` method. The rebuild_kg.py script requires `from gobby.storage.memories import LocalMemoryManager` to function correctly.", "type": "fact", "tags": ["gobby", "memory-system", "api", "LocalMemoryManager"], "created_at": "2026-02-15T16:14:54.372482+00:00", "updated_at": "2026-02-15T16:14:54.372482+00:00", "source": "session", "source_id": "933e203a-01de-4bad-96ac-2e318cf2cd22"}
{"id": "mm-d69d19d5", "content": "tmux set-titles-string gotcha: When enabling `set-titles on` globally, tmux uses the default `set-titles-string` which is `#S:#I:#W - \"#T\" #{session_alerts}`. This prepends session name and window index to the title (e.g. `8:1:My Title`). Must explicitly set `set-titles-string \"#W\"` to get just the window name. The _rename_tmux_window function in summary_actions.py had this bug for user sessions (agent_depth 0) while TmuxSessionManager.rename_window already had the correct behavior for spawned agents.", "type": "debugging", "tags": ["tmux", "set-titles", "gotcha", "summary_actions"], "created_at": "2026-02-15T16:03:58.509818+00:00", "updated_at": "2026-02-15T16:03:58.509818+00:00", "source": "mcp_tool", "source_id": "d12744dd-1aa8-45f2-9366-863d534a7232"}
{"id": "mm-c0e7398a", "content": "ExitPlanMode tool was rejected by user during this session, indicating the user interrupted the workflow before completing the planned task execution.", "type": "pattern", "tags": ["gobby", "user-behavior", "workflow-interruption"], "created_at": "2026-02-15T15:38:48.861640+00:00", "updated_at": "2026-02-15T15:38:48.861640+00:00", "source": "session", "source_id": "7746aa93-2dc9-4266-a95e-8082ccbf1294"}
{"id": "mm-bca9089a", "content": "The gobby project has workflow serialization utilities in web/src/components/workflowSerialization.ts that convert between workflow/pipeline representations and React Flow node/edge formats. The StepNode component (web/src/components/StepNode.tsx) is the custom React Flow node used for workflow steps and pipeline stages.", "type": "context", "tags": ["gobby", "workflow", "react-flow", "architecture"], "created_at": "2026-02-15T15:38:48.828416+00:00", "updated_at": "2026-02-15T15:38:48.828416+00:00", "source": "session", "source_id": "7746aa93-2dc9-4266-a95e-8082ccbf1294"}
{"id": "mm-3f0261d6", "content": "The gobby test suite does NOT support the --timeout flag for pytest. Do not pass --timeout=N when running tests. The asyncio mode is set to auto in pyproject.toml, so @pytest.mark.asyncio is not needed on individual async tests — but class-level pytestmark=[pytest.mark.asyncio] causes warnings on non-async test methods within those classes.", "type": "fact", "tags": ["testing", "pytest", "gotcha"], "created_at": "2026-02-15T05:30:00.283439+00:00", "updated_at": "2026-02-15T05:30:00.283439+00:00", "source": "mcp_tool", "source_id": "933e203a-01de-4bad-96ac-2e318cf2cd22"}
{"id": "mm-c9f81bb1", "content": "When using MagicMock(spec=SomeClass) where SomeClass has async methods, Python 3.8+ auto-creates AsyncMock for those attributes. But MagicMock() without spec creates regular MagicMock children. So if source code does `await obj.method()`, tests using MagicMock(spec=RealClass) work automatically, but tests using bare MagicMock() need explicit `mock.method = AsyncMock(return_value=...)`. This was the root cause of the last failing test in the memory manager async migration.", "type": "fact", "tags": ["python", "testing", "asyncmock", "gotcha"], "created_at": "2026-02-15T05:29:56.907703+00:00", "updated_at": "2026-02-15T05:29:56.907703+00:00", "source": "mcp_tool", "source_id": "933e203a-01de-4bad-96ac-2e318cf2cd22"}
{"id": "mm-a76c7520", "content": "When closing a task in gobby, if there are uncommitted changes, the close_task tool will fail with a hook error requiring commit_sha. The workflow is: 1) commit changes with task number in branch/message, 2) pass the commit SHA to close_task. The git command flag order matters: `git show <sha> --stat` works, but `git show --stat <sha>` fails with 'fatal: option must come before non-option arguments'.", "type": "pattern", "tags": ["gobby", "close_task", "workflow", "git"], "created_at": "2026-02-15T04:38:36.931334+00:00", "updated_at": "2026-02-15T04:38:36.931334+00:00", "source": "session", "source_id": "aed7f902-df4f-4674-9a9d-d17da750666b"}
{"id": "mm-61952f5f", "content": "The `update_memory()` route in `gobby/memory/routes.py` (line 235) returns the updated Memory object directly, while `memory_recall_relevant()` wraps its return value with `memory.to_dict()` (line 90). This inconsistency in API response formats exists across memory-related endpoints.", "type": "pattern", "tags": ["api", "memory", "routes", "response-format", "inconsistency"], "created_at": "2026-02-15T04:37:03.834504+00:00", "updated_at": "2026-02-15T04:37:03.834504+00:00", "source": "session", "source_id": "a830f291-0641-4440-bf35-59ccd58c490d"}
{"id": "mm-18d1262a", "content": "Critical bug: `handle_inject_context()` in `gobby/agent/action_handlers.py` calls `inject_context()` WITHOUT awaiting it (line 721), despite `inject_context()` being an async function. This causes the async operation to be silently dropped. Similarly, callers in the codebase don't await `memory_recall_relevant()` in `gobby/memory/routes.py` (line 131).", "type": "fact", "tags": ["bug", "async", "inject_context", "memory_recall_relevant", "action_handlers"], "created_at": "2026-02-15T04:37:03.830236+00:00", "updated_at": "2026-02-15T04:37:03.830236+00:00", "source": "session", "source_id": "a830f291-0641-4440-bf35-59ccd58c490d"}
{"id": "mm-a33b2401", "content": "Claude Code doesn't return tool_result in post-tool-use hooks - attempting to access it causes a KeyError. The pre-tool-use hook works correctly and can access tool parameters. This is a platform limitation that affects hook debugging and logging workflows.", "type": "fact", "tags": ["hooks", "claude-code", "debugging", "tool-result", "platform-limitation"], "created_at": "2026-02-15T03:38:30.783534+00:00", "updated_at": "2026-02-15T03:38:30.783534+00:00", "source": "session", "source_id": "7d07dcc1-b830-490a-83f0-73b9110383e5"}
{"id": "mm-69ef183d", "content": "Git command flag ordering matters: 'git show --stat <commit>' works, but 'git show <commit> --stat' fails with 'fatal: option '--stat' must come before non-option arguments'. Flags must come before positional arguments.", "type": "fact", "tags": ["git", "cli", "debugging"], "created_at": "2026-02-15T00:30:27.205401+00:00", "updated_at": "2026-02-15T00:30:27.205401+00:00", "source": "session", "source_id": "aed7f902-df4f-4674-9a9d-d17da750666b"}
{"id": "mm-776fe63c", "content": "When closing a task with close_task, the pre-tool-use hook validates that a commit exists. If attempting to close without committing first, the hook will error with 'PreToolUse:mcp__gobby__call_tool hook error'. The workflow requires: 1) commit changes with git, 2) then call close_task with commit_sha parameter.", "type": "pattern", "tags": ["gobby", "task-management", "hooks", "workflow"], "created_at": "2026-02-15T00:30:27.204198+00:00", "updated_at": "2026-02-15T00:30:27.204198+00:00", "source": "session", "source_id": "aed7f902-df4f-4674-9a9d-d17da750666b"}
{"id": "mm-2a0b6517", "content": "After MCP tool discovery/re-connection, the agent successfully executed a pipeline end-to-end with real functionality and completed four fixes that were verified. The pipeline execution workflow involves: discovering tools -> getting tool info -> running pipeline -> receiving completed status with execution ID.", "type": "pattern", "tags": ["mcp", "workflow", "pipeline", "debugging"], "created_at": "2026-02-15T00:30:20.721243+00:00", "updated_at": "2026-02-15T00:30:20.721243+00:00", "source": "session", "source_id": "28483842-c657-4abd-a733-4c415aede528"}
{"id": "mm-165d8f25", "content": "The gobby MCP server provides pipeline execution tools accessible via mcp__gobby_ prefix. Key tools include: list_pipelines (lists available pipeline definitions), get_tool_info (retrieves tool schemas), and run_pipeline (executes pipelines by name with parameters). The run_pipeline tool returns execution results with status 'completed' and an execution_id in format 'pe-<hash>'.", "type": "fact", "tags": ["mcp", "gobby", "pipeline", "api"], "created_at": "2026-02-15T00:30:20.720057+00:00", "updated_at": "2026-02-15T00:30:20.720057+00:00", "source": "session", "source_id": "28483842-c657-4abd-a733-4c415aede528"}
{"id": "mm-018e4902", "content": "The maintenance.py service module was created to extract memory maintenance functions (stats, export, and now reindexing) from the main MemoryManager class. When adding new maintenance operations like `reindex_embeddings`, they should be implemented in maintenance.py and called from MemoryManager rather than adding bulk to the manager class itself.", "type": "pattern", "tags": ["gobby", "architecture", "memory-manager", "maintenance"], "created_at": "2026-02-15T00:30:19.876462+00:00", "updated_at": "2026-02-15T00:30:19.876462+00:00", "source": "session", "source_id": "640fc419-ef75-444e-8842-51511db3b10f"}
{"id": "mm-8e96ea16", "content": "The MemoryManager class has a `_embed_and_upsert()` method (line 152 in manager.py) that handles embedding and upserting individual memories. When implementing `reindex_embeddings()`, this method can be reused to batch-process existing memories by fetching them via `list_memories()` and re-embedding each one.", "type": "pattern", "tags": ["gobby", "memory-manager", "embeddings", "reindexing"], "created_at": "2026-02-15T00:30:19.870363+00:00", "updated_at": "2026-02-15T00:30:19.870363+00:00", "source": "session", "source_id": "640fc419-ef75-444e-8842-51511db3b10f"}
{"id": "mm-76690554", "content": "Web chat title synthesis bug: ChatSession._prompt_hook (chat_session.py:288) sends {\"prompt_text\": ...} but handle_synthesize_title (summary_actions.py:625) only reads event_data.get(\"prompt\"). Fix: use `get(\"prompt\") or get(\"prompt_text\")` to handle both CLI (\"prompt\") and web chat (\"prompt_text\") keys.", "type": "debugging", "tags": ["web-chat", "title-synthesis", "key-mismatch", "gotcha"], "created_at": "2026-02-14T23:57:19.765729+00:00", "updated_at": "2026-02-14T23:57:19.765729+00:00", "source": "mcp_tool", "source_id": "aed7f902-df4f-4674-9a9d-d17da750666b"}
{"id": "mm-2601d821", "content": "The gobby project has at least 6 files related to 'mem0' functionality (found via grep): src/gobby/storage/migrations.py, src/gobby/install/shared/prompts/memory_guide.md, src/gobby/install/shared/prompts/onboard.md, mem0-integration.md, docs/extending/mem0-integration.md, and docs/memory-guide.md. This indicates mem0 integration documentation exists in multiple locations and there's a vendored/custom implementation rather than direct dependency.", "type": "fact", "tags": ["gobby", "mem0", "documentation", "file-structure"], "created_at": "2026-02-14T23:48:41.754234+00:00", "updated_at": "2026-02-14T23:48:41.754234+00:00", "source": "session", "source_id": "92855b1c-ec1a-496d-b00a-5fe7d3714784"}
{"id": "mm-8332357a", "content": "Gobby has a migration system for its database schema. Migration `_migrate_drop_mem0_id` (in src/gobby/storage/migrations.py around line 1132) was specifically created to remove mem0_id columns, indicating a past migration away from mem0's native ID system. This suggests Gobby previously used mem0's internal IDs but migrated to its own ID scheme.", "type": "context", "tags": ["gobby", "memory-system", "mem0", "database-migrations", "architecture"], "created_at": "2026-02-14T23:48:41.733039+00:00", "updated_at": "2026-02-14T23:48:41.733039+00:00", "source": "session", "source_id": "92855b1c-ec1a-496d-b00a-5fe7d3714784"}
{"id": "mm-1d9dfa4f", "content": "User preference: Questions whether LLM-assigned 'importance' fields are reliable for memory filtering, suggesting uncertainty about using AI-generated metadata as filtering criteria. User interrupted the session when asked about this implementation detail.", "type": "preference", "tags": ["gobby", "memory-system", "llm-metadata", "user-preference"], "created_at": "2026-02-14T23:48:30.953478+00:00", "updated_at": "2026-02-14T23:48:30.953478+00:00", "source": "session", "source_id": "b5ef8706-6256-43d5-a9be-124873bf6880"}
{"id": "mm-668e3eb2", "content": "Session lifecycle workflow structure: `on_session_end` hook in session-lifecycle.yaml is designed to always run session summary generation on session end. The workflow execution happens in lifecycle_stage.py which assembles context parts and executes lifecycle workflows. Event handlers in src/gobby/hooks/event_handlers.py process hook events and coordinate with LocalSessionMessageManager.", "type": "fact", "tags": ["gobby", "session-lifecycle", "workflow-architecture", "hooks"], "created_at": "2026-02-14T23:48:30.915690+00:00", "updated_at": "2026-02-14T23:48:30.915690+00:00", "source": "session", "source_id": "b5ef8706-6256-43d5-a9be-124873bf6880"}
{"id": "mm-1ceee4e6", "content": "In gobby Playwright automation testing: after interrupting a long-running tool call, subsequent send_keys and submit actions work correctly to interact with the UI. This confirms the interrupt mechanism doesn't break the ability to continue UI automation afterward.", "type": "pattern", "tags": ["gobby", "playwright", "interruption", "ui-automation", "testing"], "created_at": "2026-02-14T23:48:17.103678+00:00", "updated_at": "2026-02-14T23:48:17.103678+00:00", "source": "session", "source_id": "93d0affd-322f-48db-a130-f3bc337b2bb3"}
{"id": "mm-5841275d", "content": "When testing Bash tool interruption in gobby: running `sleep 120` in background (with &) causes it to complete immediately rather than allowing interrupt testing. The sleep command must run in foreground (without &) to properly test interrupt behavior during long-running operations.", "type": "fact", "tags": ["gobby", "testing", "bash-tool", "interruption", "debugging"], "created_at": "2026-02-14T23:48:17.074047+00:00", "updated_at": "2026-02-14T23:48:17.074047+00:00", "source": "session", "source_id": "93d0affd-322f-48db-a130-f3bc337b2bb3"}
{"id": "mm-966caab8", "content": "KnowledgeGraph component in gobby/web crashes when loaded over HTTP (not HTTPS) due to d3-force-3d dependency trying to use WebGL. The fix is to lazy-load it with React.lazy() and wrap in Suspense boundary to prevent black screen on initial page load in MemoryPage.tsx.", "type": "fact", "tags": ["gobby", "react", "knowledgegraph", "d3-force-3d", "lazy-loading", "http-crash"], "created_at": "2026-02-14T23:48:09.136299+00:00", "updated_at": "2026-02-14T23:48:09.136299+00:00", "source": "session", "source_id": "3ef282c6-b74c-41bc-8a22-cbd6b147a758"}
{"id": "mm-417040d6", "content": "The gobby project has a session-lifecycle workflow system with hooks (on_session_start, on_session_end, on_user_message, on_assistant_message, on_tool_use, post_tool_use) defined in src/gobby/install/shared/workflows/session-lifecycle.yaml. The lifecycle workflow execution is triggered in SessionController via LocalSessionManager.execute_lifecycle_workflow(), and hook events are processed through src/gobby/server/hooks/event_handlers.py which broadcasts to WebSocket connections.", "type": "context", "tags": ["gobby", "architecture", "session-lifecycle", "hooks", "workflows"], "created_at": "2026-02-14T23:47:52.447418+00:00", "updated_at": "2026-02-14T23:47:52.447418+00:00", "source": "session", "source_id": "b5ef8706-6256-43d5-a9be-124873bf6880"}
{"id": "mm-9396a7df", "content": "DaemonClient API (in src/gobby/utils/daemon_client.py) provides check_health() method and execute_pipeline() for CLI-to-daemon communication. The client uses httpx to communicate with the daemon server.", "type": "fact", "tags": ["gobby", "DaemonClient", "API", "daemon"], "created_at": "2026-02-14T23:41:15.059848+00:00", "updated_at": "2026-02-14T23:41:15.059848+00:00", "source": "session", "source_id": "aa0223dc-8931-4cdf-8855-9a4532f74550"}
{"id": "mm-115036ef", "content": "PipelineExecutor is instantiated in 3 locations in gobby: main.py (daemon mode), daemon_client.py (CLI mode), and _create_workflow_engine in main.py. This creates separate executor instances that don't share state, which is the root cause of daemon/CLI inconsistency issues.", "type": "fact", "tags": ["architecture", "gobby", "PipelineExecutor", "daemon", "root-cause"], "created_at": "2026-02-14T23:41:15.054678+00:00", "updated_at": "2026-02-14T23:41:15.054678+00:00", "source": "session", "source_id": "aa0223dc-8931-4cdf-8855-9a4532f74550"}
{"id": "mm-788ae5a4", "content": "The gobby project uses a branch naming convention `0.2.16` (version-based). When pushing a new branch for the first time, it requires setting upstream with `git push --set-upstream origin <branch>` - the branch has no upstream by default.", "type": "fact", "tags": ["git", "workflow", "branching"], "created_at": "2026-02-14T22:44:39.594867+00:00", "updated_at": "2026-02-14T22:44:39.594867+00:00", "source": "session", "source_id": "9f56308d-a65e-4bc4-940f-36979ac787bc"}
{"id": "mm-c59c644e", "content": "Frontend message loading in `loadSessionMessages()` (around line 494-500) expects all messages to have an `agent` field and will fail to display messages properly when it's missing. This is the root cause of CLI session display issues - the DB->API->Frontend pipeline doesn't preserve agent information.", "type": "fact", "tags": ["gobby", "bug", "frontend", "api", "cli-sessions"], "created_at": "2026-02-14T22:43:45.926736+00:00", "updated_at": "2026-02-14T22:43:45.926736+00:00", "source": "session", "source_id": "697ac470-1937-4567-89eb-e92bacd1b39a"}
{"id": "mm-d90f2085", "content": "CLI session transcript DB rows lack an `agent` field, causing frontend message reconstruction to fail. The `get_messages` API endpoint returns messages without `agent` populated because the DB schema doesn't store it, even though the session message processor has infrastructure for agent tracking via `default_agent` and agent message blocks.", "type": "fact", "tags": ["gobby", "bug", "cli-sessions", "database-schema", "message-reconstruction"], "created_at": "2026-02-14T22:43:45.924358+00:00", "updated_at": "2026-02-14T22:43:45.924358+00:00", "source": "session", "source_id": "697ac470-1937-4567-89eb-e92bacd1b39a"}
{"id": "mm-2445b4fa", "content": "When removing a field across the full Gobby stack, the layers to check are: storage/migrations.py (baseline schema + migration), storage/memories.py (dataclass + CRUD), memory/protocol.py (MemoryRecord + MemoryQuery + MemoryBackendProtocol), memory/backends/ (storage_adapter + null), memory/manager.py, memory/components/ + memory/ingestion/, memory/services/, mcp_proxy/tools/, cli/, servers/routes/, workflows/*_actions.py, sync/, utils/status.py, install/shared/workflows/*.yaml, install/shared/prompts/, install/shared/skills/, storage/schema_dump.sql, and ~29 test files. Using parallel Task agents (4 groups) to edit test files is effective.", "type": "pattern", "tags": ["architecture", "refactoring", "field-removal"], "created_at": "2026-02-14T22:18:24.407263+00:00", "updated_at": "2026-02-14T22:18:24.407263+00:00", "source": "mcp_tool", "source_id": "e234104d-82a8-4894-aaea-b104a9d47bcb"}
{"id": "mm-3f390c11", "content": "Pre-existing test failures exist in tests/workflows/test_memory_actions.py, test_workflow_actions.py, test_context_actions.py, test_memory_routes.py, and test_memory_cli.py because tests still reference old method names (remember instead of create_memory, recall instead of search_memories). These method renames happened during memory-v5 but test mocks were not updated. Also tests/mcp_proxy/tools/test_memory_tools.py still has TestExportMemoryGraph tests and test_all_tools_registered expects export_memory_graph which was removed in commit a0fb4b6.", "type": "pattern", "tags": ["testing", "memory-v5", "pre-existing-failures"], "created_at": "2026-02-14T22:18:20.099724+00:00", "updated_at": "2026-02-14T22:18:20.099724+00:00", "source": "mcp_tool", "source_id": "e234104d-82a8-4894-aaea-b104a9d47bcb"}
{"id": "mm-b8abd9d3", "content": "When close_task fails validation, tasks can be routed to review status as an alternative to closing. The close_task endpoint accepts this routing when validation would otherwise fail, returning {\"routed_to_review\": true} in the response.", "type": "pattern", "tags": ["gobby", "task-system", "close_task", "review-workflow"], "created_at": "2026-02-14T21:49:27.897564+00:00", "updated_at": "2026-02-14T21:49:27.897564+00:00", "source": "session", "source_id": "27f67e88-877e-464e-af4f-e18aa7ae39e9"}
{"id": "mm-6213c140", "content": "The gobby task system's close_task validation requires commits when edits were made during the session, even if those edits were later reverted. Error code: 'missing_commits_for_edits'. Workaround: Pass commit_sha='none' to explicitly close without commits when edits were cleanly reverted.", "type": "fact", "tags": ["gobby", "task-system", "close_task", "validation", "error-handling"], "created_at": "2026-02-14T21:49:27.872741+00:00", "updated_at": "2026-02-14T21:49:27.872741+00:00", "source": "session", "source_id": "27f67e88-877e-464e-af4f-e18aa7ae39e9"}
{"id": "mm-5442f391", "content": "GitHub repository GobbyAI/gobby has branch protection rules that are bypassed during pushes. Push notifications show '2 of 2 required status checks are expected' for both dev and main branches, indicating CI/CD requirements exist but are overridden in current workflow.", "type": "context", "tags": ["github", "branch-protection", "ci-cd"], "created_at": "2026-02-14T21:49:20.471541+00:00", "updated_at": "2026-02-14T21:49:20.471541+00:00", "source": "session", "source_id": "4311fa28-1d3f-4f3a-a016-4855e97890fd"}
{"id": "mm-5b5bdff1", "content": "When merging branches (e.g., 0.2.15 → dev → main), local changes to .gobby/memories.jsonl and .gobby/tasks/*.output files must be stashed before switching branches, as git checkout will fail with 'Your local changes would be overwritten by checkout' error. After merging, restore the stash on the working branch.", "type": "pattern", "tags": ["git", "workflow", "gobby-metadata", "branch-merging"], "created_at": "2026-02-14T21:49:20.446337+00:00", "updated_at": "2026-02-14T21:49:20.446337+00:00", "source": "session", "source_id": "4311fa28-1d3f-4f3a-a016-4855e97890fd"}
{"id": "mm-97720c2f", "content": "gobby's search backend selection is determined by `config.search_backend` value, which controls whether embeddings or basic search is used. The Memory model includes cross-references via MemoryCrossRef class linking related memories with similarity scores.", "type": "context", "tags": ["gobby", "search-backend", "memory-model", "architecture"], "created_at": "2026-02-14T21:49:11.217680+00:00", "updated_at": "2026-02-14T21:49:11.217680+00:00", "source": "session", "source_id": "34f3a1d3-d475-49de-997f-d45212512ba6"}
{"id": "mm-9b2d22bf", "content": "gobby project has a type inconsistency: `ClaudeProvider.__init__()` expects `auth_mode: str` parameter, but `LLMProviderConfig.auth_mode` returns `AuthMode` (a Literal type alias defined as `Literal['subscription', 'api_key']`). This causes type checker errors when instantiating ClaudeProvider with config.auth_mode.", "type": "fact", "tags": ["gobby", "type-error", "claude-provider", "auth-mode", "bug"], "created_at": "2026-02-14T21:49:11.190688+00:00", "updated_at": "2026-02-14T21:49:11.190688+00:00", "source": "session", "source_id": "34f3a1d3-d475-49de-997f-d45212512ba6"}
{"id": "mm-63f3c1d5", "content": "The gobbon _migrate_add_mem0_id() but later dropped in _migrate_drop_mem0_id() (around line 1132 in src/gobby/storage/migrations.py). The system previously experimented with mem0 integration but removed it, keeping only the custom memory implementation.", "type": "fact", "tags": ["memory-system", "migrations", "mem0", "database-schema"], "created_at": "2026-02-14T21:46:22.088552+00:00", "updated_at": "2026-02-14T21:46:22.088552+00:00", "source": "session", "source_id": "92855b1c-ec1a-496d-b00a-5fe7d3714784"}
{"id": "mm-f7d00d23", "content": "The gobby project decided NOT to create a gobby-prompts MCP server despite having 13 internal callers of PromptLoader. Rationa. This was discovered when attempting to access tool results in a post-tool-use hook context and finding the data unavailable.", "type": "fact", "tags": ["claude-code", "mcp", "hooks", "tool-result", "debugging"], "created_at": "2026-02-14T21:46:22.065643+00:00", "updated_at": "2026-02-14T21:46:22.065643+00:00", "source": "session", "source_id": "32fd77c0-1a22-4f53-b7c8-9286a3ac5046"}
{"id": "mm-6b04c4be", "content": "The baseline schema at version 103 still contains the `importance` field in the `memory_cross_ref` table definition, confirming it has not been removed and is still part of the current schema desie hook_dispatcher.py script has issues handling these specific tool types.", "type": "fact", "tags": ["hooks", "gobby", "errors", "debugging"], "created_at": "2026-02-14T21:46:22.040389+00:00", "updated_at": "2026-02-14T21:46:22.040389+00:00", "source": "session", "source_id": "a1983f73-1f22-4854-9cac-4c5dd44ddc26"}
{"id": "mm-a0892fca", "content": "The `handle_inject_context` function in `src/gobby/workflows/context_actions.py` had a `min_importance` parameter that was removed during refactoring. This parameter was likely used to filter context items by importance level before injection.", "type": "fact", "tags": ["gobby", "context_actions", "refactoring", "handle_inject_context"], "created_at": "2026-02-14T21:46:22.014632+00:00", "updated_at": "2026-02-14T21:46:22.014632+00:00", "source": "session", "source_id": "e234104d-82a8-4894-aaea-b104a9d47bcb"}
{"id": "mm-b9b16b08", "content": "The `handle_inject_context` function in `src/gobby/workflows/context_actions.py` had a `min_importance` parameter that was removed during refactoring. This parameter was likely used to filter context items by importance level before injection.", "type": "fact", "tags": ["gobby", "context_actions", "refactoring", "handle_inject_context"], "created_at": "2026-02-14T21:43:59.767609+00:00", "updated_at": "2026-02-14T21:43:59.767609+00:00", "source": "session", "source_id": "e234104d-82a8-4894-aaea-b104a9d47bcb"}
{"id": "mm-7d02a278", "content": "When pushing a new branch in the gobby project, the branch has no upstream by default and requires `git push --set-upstream origin <branch-name>` to establish tracking. The project uses branch names like `0.2.16` for version-specific work.", "type": "pattern", "tags": ["git", "deployment", "workflow"], "created_at": "2026-02-14T21:32:37.773956+00:00", "updated_at": "2026-02-14T21:32:37.773956+00:00", "source": "session", "source_id": "9f56308d-a65e-4bc4-940f-36979ac787bc"}
{"id": "mm-498825a8", "content": "MemoryCrossRef.from_row() method expects database rows with mem0_id field, but the migration _migrate_drop_mem0_id removes this column. This creates a potential runtime error when querying cross-references on migrated databases versus fresh installations that use BASELINE_SCHEMA_V2.", "type": "fact", "tags": ["database", "mem0_id", "MemoryCrossRef", "migration-bug", "schema-mismatch"], "created_at": "2026-02-14T21:28:54.276798+00:00", "updated_at": "2026-02-14T21:28:54.276798+00:00", "source": "session", "source_id": "10a30db1-1853-4151-8e5b-b44de991bb7b"}
{"id": "mm-9cb4fdeb", "content": "The gobby project's memory database schema migration strategy: new installations use BASELINE_SCHEMA_V2 (version 75) and skip all earlier migrations. Existing databases run incremental migrations including _migrate_drop_mem0_id which removes the deprecated mem0_id column. The baseline schema at version 103 still contains mem0_id in the memories table definition, creating a discrepancy between fresh installs and migrated databases.", "type": "fact", "tags": ["database", "schema-migration", "mem0_id", "baseline-schema", "architectural-inconsistency"], "created_at": "2026-02-14T21:28:54.177692+00:00", "updated_at": "2026-02-14T21:28:54.177692+00:00", "source": "session", "source_id": "10a30db1-1853-4151-8e5b-b44de991bb7b"}
{"id": "mm-25670e9e", "content": "The gobby project has a baseline schema migration system where new databases skip early migrations and jump directly to BASELINE_SCHEMA_V2 (version 75). For existing databases, there's a `_migrate_drop_mem0_importance_field` migration that removes an 'importance' field from the mem0 table. The baseline schema at version 103 still contains the `importance` column definition, indicating it exists in fresh installs but gets dropped during migration from older versions.", "type": "fact", "tags": ["gobby", "database", "migration", "schema", "mem0", "importance-field"], "created_at": "2026-02-14T21:28:15.287803+00:00", "updated_at": "2026-02-14T21:28:15.287803+00:00", "source": "session", "source_id": "10a30db1-1853-4151-8e5b-b44de991bb7b"}
{"id": "mm-12c7c3d6", "content": "Task notification output files in /private/tmp/claude-501/-Users-josh-Projects-gobby/tasks/ may be ephemeral or get cleaned up quickly. A failed task notification (bbf6ab0.output) showenectionClosed), and the WebSocketServer class constructor takes a WebSocketConfig parameter. These are separate codebases that may have different purposes or be in migration.", "type": "context", "tags": ["websocket", "architecture", "duplicate-implementation"], "created_at": "2026-02-14T21:28:09.499331+00:00", "updated_at": "2026-02-14T21:28:09.499331+00:00", "source": "session", "source_id": "8ed8b85b-88f6-40a1-91ba-dd5d85f98a6e"}
{"id": "mm-30a43274", "content": "The gobby project has hook execution errors in PreToolUse hooks for both `mcp__gobby__get_tool_schema` and `mcp__gobby__list_tools`. The error pattern shows hooks are being dispatched via `uv run python \".claude/hooks/hook_dispatcher.py\" --type=pre-t...` but failing before completion. This suggests the hook_dispatcher.py script has issues handling these specific tool types.", "type": "fact", "tags": ["hooks", "gobby", "errors", "debugging"], "created_at": "2026-02-14T21:28:09.468781+00:00", "updated_at": "2026-02-14T21:28:09.468781+00:00", "source": "session", "source_id": "a1983f73-1f22-4854-9cac-4c5dd44ddc26"}
{"id": "mm-f01cb30b", "content": "The baseline schema at version 103 still contains the `importance` field in the `memory_cross_ref` table definition, confirming it has not been removed and is still part of the current schema design.", "type": "fact", "tags": ["database", "schema", "importance", "memory_cross_ref"], "created_at": "2026-02-14T21:27:30.679639+00:00", "updated_at": "2026-02-14T21:27:30.679639+00:00", "source": "session", "source_id": "10a30db1-1853-4151-8e5b-b44de991bb7b"}
{"id": "mm-665e3ba1", "content": "The gobby project has a complex database migration system with two paths: new databases start at BASELINE_SCHEMA_V2 (version 75), while existing databases migrate incrementally from version 1. The `memory_cross_ref` table uses `memory_id` and `other_memory_id` columns (NOT `mem0_id`), and the migration `_migrate_drop_mem0_id` at version 75 removed the old `mem0_id` column from existing databases to align with the baseline schema.", "type": "fact", "tags": ["database", "migration", "schema", "memory_cross_ref"], "created_at": "2026-02-14T21:27:30.674164+00:00", "updated_at": "2026-02-14T21:27:30.674164+00:00", "source": "session", "source_id": "10a30db1-1853-4151-8e5b-b44de991bb7b"}
{"id": "mm-8bb4435f", "content": "The gobby project has 20 MCP servers available with 16 currently connected. The gobby-skills server provides 8 tools: list_skills, get_skill, install_skill, uninstall_skill, update_skill, create_skill, validate_skill, and search_skills.", "type": "fact", "tags": ["gobby", "mcp-servers", "gobby-skills", "available-tools"], "created_at": "2026-02-14T20:48:44.745747+00:00", "updated_at": "2026-02-14T20:48:44.745747+00:00", "source": "session", "source_id": "6e8f0b44-35cf-4699-9802-82a2b1e500ad"}
{"id": "mm-b0ffaf6d", "content": "The pre-tool-use hook for TaskList tool is failing with an error in the hook_dispatcher.py. The error message shows 'PreToolUse:TaskList hook error' when attempting to list tasks, indicating the hook system may have a bug or misconfiguration that prevents TaskList operations from completing.", "type": "fact", "tags": ["hooks", "tasklist", "bug", "hook_dispatcher"], "created_at": "2026-02-14T20:48:34.088097+00:00", "updated_at": "2026-02-14T20:48:34.088097+00:00", "source": "session", "source_id": "a5223304-6227-4c46-b4b4-f093ffe8842f"}
{"id": "mm-453d124e", "content": "The TaskList tool in this project has a pre-tool-use hook that can fail with errors. When TaskList fails due to hook errors, the user prefers to use MCP (Model Context Protocol) as an alternative approach instead of retrying TaskList.", "type": "preference", "tags": ["TaskList", "hooks", "MCP", "error-handling"], "created_at": "2026-02-14T20:48:29.519325+00:00", "updated_at": "2026-02-14T20:48:29.519325+00:00", "source": "session", "source_id": "569a3c08-67ba-4440-a42c-3a8176ef0d71"}
{"id": "mm-2634e694", "content": "The gobby project has 33 open tasks tracked in gobby-tasks MCP server. Tasks are organized across categories: Workflow UI (DB storage + versioning #8187, error recovery #8188), MCP Features (resource subscriptions #8171, pagination #8172, server lifecycle #8173), Code Editor (LSP integration #8174, multi-file editing #8175), Testing (E2E test suite #8176, integration tests #8177), Documentation (API reference #8178, tutorial series #8179), and Performance (caching strategy #8180, lazy loading #8181). Additional tasks cover security (#8182-8184), deployment (#8185-8186), accessibility (#8189-8190), collaboration (#8191-8192), data management (#8193-8194), and user experience (#8195-8199).", "type": "context", "tags": ["gobby", "task-management", "project-status", "backlog"], "created_at": "2026-02-14T20:48:24.725679+00:00", "updated_at": "2026-02-14T20:48:24.725679+00:00", "source": "session", "source_id": "473c2725-9d05-47bf-8756-fc5323e4fb23"}
{"id": "mm-cf622d97", "content": "Gobby exposes memory management through REST API routes in src/gobby/servers/routes/memory.py with endpoints for create (POST), retrieve (GET), update (PUT/PATCH), and delete (DELETE). The API uses Pydantic models (MemoryCreateRequest, MemoryUpdateRequest, MemoryResponse) for request/response validation and returns standardized JSON responses with memory objects.", "type": "fact", "tags": ["gobby", "api", "memory-system", "rest-endpoints"], "created_at": "2026-02-14T19:47:20.566079+00:00", "updated_at": "2026-02-14T19:47:20.566079+00:00", "source": "session", "source_id": "9e4c719d-642f-40b1-9acf-cf77f93aa7de"}
{"id": "mm-a4826fed", "content": "Gobby memory system uses a dual-storage architecture: MemoryStore (in-memory dictionary for session data) and PersistentStorage (filesystem-based JSON for long-term storage). The MemoryStore class (src/gobby/memory/memory_store.py) handles CRUD operations while PersistentStorage (src/gobby/storage/persistent_storage.py) manages file I/O to ~/.gobby/memories/. Memory objects follow a standardized schema with id, content, memory_type, tags, created_at, and updated_at fields.", "type": "fact", "tags": ["gobby", "architecture", "memory-system", "storage"], "created_at": "2026-02-14T19:47:20.544021+00:00", "updated_at": "2026-02-14T19:47:20.544021+00:00", "source": "session", "source_id": "9e4c719d-642f-40b1-9acf-cf77f93aa7de"}
{"id": "mm-51aa6a7e", "content": "The gobby project's tasks file is extremely large (5.1MB), which exceeds the Read tool's 256KB limit. To count open tasks, use Grep with the count_only flag to search for status patterns rather than attempting to read the entire file. The project has 33 open tasks based on grep results.", "type": "fact", "tags": ["gobby", "tasks-file", "file-size-limit", "workaround"], "created_at": "2026-02-14T19:47:13.013313+00:00", "updated_at": "2026-02-14T19:47:13.013313+00:00", "source": "session", "source_id": "87ddf002-1bd8-4b03-ad44-20e62d701dd3"}
{"id": "mm-0ba4bdc3", "content": "Claude Code hook errors show as 'PreToolUse:Bash hook error' when the MCP server is running, but hooks execute successfully when MCP is disabled. The root cause is an interaction between the MCP server process and the hook dispatcher execution environment.", "type": "pattern", "tags": ["debugging", "mcp-server", "hooks", "error-diagnosis"], "created_at": "2026-02-14T19:46:59.202454+00:00", "updated_at": "2026-02-14T19:46:59.202454+00:00", "source": "session", "source_id": "17f8c57e-c691-493f-8e37-da714a535948"}
{"id": "mm-eff29a23", "content": "The gobby MCP server causes Claude Code hooks to fail when enabled. Disabling the MCP server in .mcp.json allows hooks to work correctly. The MCP server runs via `uv run gobby mcp-server` configured as stdio transport.", "type": "fact", "tags": ["mcp-server", "hooks", "bug", "claude-code"], "created_at": "2026-02-14T19:46:59.178173+00:00", "updated_at": "2026-02-14T19:46:59.178173+00:00", "source": "session", "source_id": "17f8c57e-c691-493f-8e37-da714a535948"}
{"id": "mm-a9154a2c", "content": "Claude Code (via MCP) does not include tool_result content in post-tool-use hook payloads - only pre-tool-use hooks receive the full tool call parameters. This was discovered when attempting to access tool results in a post-tool-use hook context and finding the data unavailable.", "type": "fact", "tags": ["claude-code", "mcp", "hooks", "tool-result", "debugging"], "created_at": "2026-02-14T18:51:20.740619+00:00", "updated_at": "2026-02-14T18:51:20.740619+00:00", "source": "session", "source_id": "32fd77c0-1a22-4f53-b7c8-9286a3ac5046"}
{"id": "mm-44c468d6", "content": "The gobby project decided NOT to create a gobby-prompts MCP server despite having 13 internal callers of PromptLoader. Rationale: exposing prompts as MCP tools would inject unwanted 'Available tools' context into LLM calls, defeating the purpose of using dynamic prompts for context injection. Internal callers will continue using PromptLoader directly.", "type": "preference", "tags": ["gobby", "mcp", "prompts", "architecture-decision"], "created_at": "2026-02-14T18:50:48.332393+00:00", "updated_at": "2026-02-14T18:50:48.332393+00:00", "source": "session", "source_id": "85d7e248-6f95-4730-9588-1fbf8f56d495"}
{"id": "mm-f3675cb1", "content": "The 'plan' skill in gobby requires plans to follow a specific expansion-ready checklist format with phases containing concrete tasks, NOT just narrative text or specifications. The format must be compatible with `/gobby:expand` command. Plans need both the checklist structure AND detailed technical specifications (file paths, APIs, implementation details) to be useful.", "type": "fact", "tags": ["gobby", "plan-skill", "format-requirements", "expansion"], "created_at": "2026-02-14T17:50:25.435916+00:00", "updated_at": "2026-02-14T17:50:25.435916+00:00", "source": "session", "source_id": "374d0f63-0d52-42fc-8a32-93ff33b4f5e6"}
{"id": "mm-8fecd466", "content": "Task #8215 involved applying CodeRabbit code-quality suggestions across 15 files, resulting in commit eb26fa5b. The commit message format used was '[gobby-#8215] fix: apply CodeRabbit code-quality suggestions' at version 0.2.15.", "type": "context", "tags": ["task-8215", "coderabbit", "code-quality"], "created_at": "2026-02-14T16:50:19.015885+00:00", "updated_at": "2026-02-14T16:50:19.015885+00:00", "source": "session", "source_id": "d95089ab-b1e4-4b59-869d-b355bcf26bd4"}
{"id": "mm-554999a6", "content": "The gobby project uses a hook system that blocks certain tool operations until prerequisites are met. When attempting to close a task without committing first, the pre-tool-use hook returns an error blocking the close_task operation and instructs to commit changes first. The workflow requires: 1) check git status, 2) commit changes, 3) then close task with commit SHA.", "type": "pattern", "tags": ["hooks", "workflow", "task-management", "commit-requirements"], "created_at": "2026-02-14T16:50:18.995359+00:00", "updated_at": "2026-02-14T16:50:18.995359+00:00", "source": "session", "source_id": "d95089ab-b1e4-4b59-869d-b355bcf26bd4"}
{"id": "mm-9d01caf3", "content": "The gobby daemon lifecycle evaluator has a priority bug where session_variables (set via MCP) were being overridden by task_variables during gate evaluation. This was fixed in commit 87340d9d by checking session_variables first in `_get_variable()`, then falling back to task_variables. The stop gate is now clearable via MCP.", "type": "fact", "tags": ["daemon", "lifecycle", "session_variables", "bug-fix", "mcp"], "created_at": "2026-02-14T16:49:54.903336+00:00", "updated_at": "2026-02-14T16:49:54.903336+00:00", "source": "session", "source_id": "7e03b832-0c09-47ec-9049-cf2eae396476"}
{"id": "mm-36c14fac", "content": "When ExitPlanMode tool is used in gobby sessions, the user consistently rejects it (occurred twice in this session), indicating a preference to stay in plan mode rather than exiting. The user also interrupted the session during the second rejection attempt.", "type": "preference", "tags": ["gobby", "planning", "workflow"], "created_at": "2026-02-14T16:49:49.501956+00:00", "updated_at": "2026-02-14T16:49:49.501956+00:00", "source": "session", "source_id": "a1983f73-1f22-4854-9cac-4c5dd44ddc26"}
{"id": "mm-f926e7dd", "content": "The gobby project has hook execution errors in PreToolUse hooks for both `mcp__gobby__get_tool_schema` and `mcp__gobby__list_tools`. The error pattern shows hooks are being dispatched via `uv run python \".claude/hooks/hook_dispatcher.py\" --type=pre-t...` but failing before completion. This suggests the hook_dispatcher.py script has issues handling these specific tool types.", "type": "fact", "tags": ["hooks", "gobby", "errors", "debugging"], "created_at": "2026-02-14T16:49:49.479556+00:00", "updated_at": "2026-02-14T16:49:49.479556+00:00", "source": "session", "source_id": "a1983f73-1f22-4854-9cac-4c5dd44ddc26"}
{"id": "mm-0ba3ff2b", "content": "The gobby project has two independent WebSocket server implementations: one in src/gobby/servers/websocket/ and another in src/gobby/websocket_server.py. The broadcast.py module imports from websockets.exceptions (ConnectionClosed), and the WebSocketServer class constructor takes a WebSocketConfig parameter. These are separate codebases that may have different purposes or be in migration.", "type": "context", "tags": ["websocket", "architecture", "duplicate-implementation"], "created_at": "2026-02-14T15:49:39.922040+00:00", "updated_at": "2026-02-14T15:49:39.922040+00:00", "source": "session", "source_id": "8ed8b85b-88f6-40a1-91ba-dd5d85f98a6e"}
{"id": "mm-20fa1b2c", "content": "Task notification output files in /private/tmp/claude-501/-Users-josh-Projects-gobby/tasks/ may be ephemeral or get cleaned up quickly. A failed task notification (bbf6ab0.output) showed 'No such file or directory' when attempting to read it shortly after receiving the notification, suggesting stale notifications or rapid cleanup.", "type": "fact", "tags": ["gobby", "task-notifications", "background-tasks", "file-lifecycle"], "created_at": "2026-02-14T15:49:33.847933+00:00", "updated_at": "2026-02-14T15:49:33.847933+00:00", "source": "session", "source_id": "cc46f27d-e10f-48b8-968d-9c7f0151b21d"}
{"id": "mm-4e215064", "content": "The stop hook in gobby can fire multiple times in a single session. Setting `pending_memory_review` to `false` via the gobby MCP tool doesn't prevent subsequent hook invocations - the hook will continue triggering and requesting memory review. This creates a loop where the agent repeatedly tries to set the variable that's already set.", "type": "pattern", "tags": ["gobby", "hooks", "stop-hook", "session-variables"], "created_at": "2026-02-14T15:49:33.826525+00:00", "updated_at": "2026-02-14T15:49:33.826525+00:00", "source": "session", "source_id": "cc46f27d-e10f-48b8-968d-9c7f0151b21d"}
{"id": "mm-5e245b31", "content": "Workflow builder node architecture: React Flow nodeTypes registry maps type keys (step, trigger, observer, pipelineStep, variable, exit) to components. The nodeKindToType() function in nodeTypes.ts maps the 12 nodeKind strings to 6 React Flow type keys. Pipeline step kinds (exec, prompt, mcp, pipeline, spawn-session, approval) all map to 'pipelineStep' type, which uses a PIPELINE_ICONS lookup to render the correct icon per kind. The FlowNode type in workflowSerialization.ts uses Node<StepNodeData, string> (not 'step') to support multiple type keys.", "type": "architecture", "tags": ["workflow-ui", "react-flow", "node-types"], "created_at": "2026-02-14T15:42:24.893401+00:00", "updated_at": "2026-02-14T15:42:24.893401+00:00", "source": "mcp_tool", "source_id": "9f56308d-a65e-4bc4-940f-36979ac787bc"}
{"id": "mm-6e67e0cd", "content": "Three memory system documentation files exist with different purposes: docs/memory-system.md (general guide for AI agents), docs/replace-with-mem0.md (abandoned plan to vendor mem0 core), and docs/mem0-integration.md (standalone integration guide). The mem0 replacement was planned but not implemented - current system remains custom.", "type": "context", "tags": ["memory-system", "documentation", "mem0", "architecture"], "created_at": "2026-02-14T15:36:38.038469+00:00", "updated_at": "2026-02-14T15:36:38.038469+00:00", "source": "session", "source_id": "92855b1c-ec1a-496d-b00a-5fe7d3714784"}
{"id": "mm-6b7eaa69", "content": "Gobby's memory system migration history: mem0_id column was added in migration _migrate_add_mem0_id() but later dropped in _migrate_drop_mem0_id() (around line 1132 in src/gobby/storage/migrations.py). The system previously experimented with mem0 integration but removed it, keeping only the custom memory implementation.", "type": "fact", "tags": ["memory-system", "migrations", "mem0", "database-schema"], "created_at": "2026-02-14T15:36:38.035286+00:00", "updated_at": "2026-02-14T15:36:38.035286+00:00", "source": "session", "source_id": "92855b1c-ec1a-496d-b00a-5fe7d3714784"}
{"id": "mm-4ab7e01f", "content": "The gobby project has workflow/pipeline serialization utilities in web/src/components/workflowSerialization.ts that convert between workflow/pipeline objects and React Flow graph structures. The project uses custom StepNode components (web/src/components/workflow/StepNode.tsx) for rendering workflow steps in React Flow, and has IconComponents (web/src/components/IconComponents.tsx) extracted for reusability across pages.", "type": "context", "tags": ["gobby", "architecture", "react-flow", "workflow-serialization"], "created_at": "2026-02-14T15:35:14.601321+00:00", "updated_at": "2026-02-14T15:35:14.601321+00:00", "source": "session", "source_id": "7746aa93-2dc9-4266-a95e-8082ccbf1294"}
{"id": "mm-9e45cbf2", "content": "The gobby project has a bug where workflows with `enabled: false` (on-demand workflows like `developer`, `auto-task`, `generic`, `code`) are incorrectly showing as active. This was a repeated fix attempt across multiple turns (15+ attempts), suggesting the root cause is complex or the fix location is non-obvious.", "type": "fact", "tags": ["gobby", "workflow", "bug", "enabled-flag"], "created_at": "2026-02-14T07:49:11.696188+00:00", "updated_at": "2026-02-14T07:49:11.696188+00:00", "source": "session", "source_id": "433fe733-73e8-40fb-aac5-8c2c31c4c573"}
{"id": "mm-0d654f21", "content": "Workflow YAML files like worktree-merge.yaml can omit the 'enabled' field entirely, which triggers default=True behavior through multiple code paths. This creates backward compatibility complexity that the user wants removed, indicating a pending breaking change to make 'enabled' an explicit required field.", "type": "context", "tags": ["gobby", "workflow", "yaml-schema", "breaking-change", "enabled-field"], "created_at": "2026-02-14T07:49:06.677688+00:00", "updated_at": "2026-02-14T07:49:06.677688+00:00", "source": "session", "source_id": "0fc6dd1c-01aa-4476-8e88-04866e613244"}
{"id": "mm-f37db741", "content": "The gobby project has three separate code paths for handling workflow 'enabled' field defaults (lines 487, 1021, 1102 in workflow code). Line 1021 documents the intended behavior that workflows default to enabled=True when the field is missing, but this logic is scattered across multiple functions creating maintenance burden and potential inconsistency.", "type": "pattern", "tags": ["gobby", "workflow", "enabled-field", "code-duplication", "default-behavior"], "created_at": "2026-02-14T07:49:06.653398+00:00", "updated_at": "2026-02-14T07:49:06.653398+00:00", "source": "session", "source_id": "0fc6dd1c-01aa-4476-8e88-04866e613244"}
{"id": "mm-8ae9722e", "content": "Gobby daemon health check can fail with a timing race condition immediately after restart, even when the daemon starts successfully. The daemon may not be fully ready when the health check runs. Waiting a moment and re-checking shows the daemon running fine.", "type": "pattern", "tags": ["gobby", "daemon", "health-check", "timing"], "created_at": "2026-02-14T06:48:51.202223+00:00", "updated_at": "2026-02-14T06:48:51.202223+00:00", "source": "session", "source_id": "d6be5675-2f57-4fad-b648-2af56b05d0bf"}
{"id": "mm-3a365fcb", "content": "Gobby's HTTP server (gobby/routes/server.py) uses Quart framework and runs asyncio in a ThreadPoolExecutor. Agent routes demonstrate the pattern: POST for create, GET for list/retrieve, PUT for update, DELETE for remove, with consistent error handling and response formats that should be mirrored for workflow endpoints.", "type": "pattern", "tags": ["gobby", "http", "api", "architecture", "quart"], "created_at": "2026-02-14T06:48:39.658435+00:00", "updated_at": "2026-02-14T06:48:39.658435+00:00", "source": "session", "source_id": "f271f73a-c9c2-4382-abb9-891766b5dfef"}
{"id": "mm-b750954c", "content": "The gobby project has existing DB storage infrastructure for agents (gobby/storage/local_agent_store.py) with migration support (gobby/storage/migrations.py) and HTTP routes (gobby/routes/agent_routes.py). The agent storage uses SQLite with tables for agents, parameters, and relationships, and includes versioning/metadata fields. This same pattern can be replicated for workflow storage.", "type": "context", "tags": ["gobby", "database", "architecture", "workflows", "agents"], "created_at": "2026-02-14T06:48:39.631522+00:00", "updated_at": "2026-02-14T06:48:39.631522+00:00", "source": "session", "source_id": "f271f73a-c9c2-4382-abb9-891766b5dfef"}
{"id": "mm-0cbc8a25", "content": "When ExitPlanMode is called during plan development, the user rejected it multiple times (turns 34, 48), indicating they want to continue reviewing/editing the plan rather than exiting plan mode immediately. The agent should wait for explicit user direction before attempting to exit plan mode.", "type": "preference", "tags": ["gobby", "plan-mode", "user-workflow"], "created_at": "2026-02-14T05:47:52.564284+00:00", "updated_at": "2026-02-14T05:47:52.564284+00:00", "source": "session", "source_id": "6a5fe36c-bff0-4581-821a-3c97bb1e99ad"}
{"id": "mm-bfc17458", "content": "The gobby project uses Context7's React Flow implementation for workflow visualization. The plan file at ~/.claude/plans/parsed-petting-harp.md contains research showing Context7 uses React Flow with dagre layout (hierarchical top-to-bottom), custom node types, and drag-and-drop via react-dnd. This is the reference implementation for gobby's visual workflow builder.", "type": "fact", "tags": ["gobby", "react-flow", "context7", "workflow-builder", "architecture"], "created_at": "2026-02-14T05:47:52.544205+00:00", "updated_at": "2026-02-14T05:47:52.544205+00:00", "source": "session", "source_id": "6a5fe36c-bff0-4581-821a-3c97bb1e99ad"}
{"id": "mm-98b0d9e0", "content": "Tmux session data flow: session_manager.py extracts pane metadata (pane_id, pane_title, window_name) → websocket/tmux.py passes it through SessionInfo/PaneInfo dataclasses → frontend receives it via useTmuxSessions.ts hook → TerminalsPage.tsx displays using the pane_title || window_name || pane_id fallback pattern.", "type": "pattern", "tags": ["tmux", "data-flow", "architecture", "frontend-backend"], "created_at": "2026-02-14T05:47:36.518785+00:00", "updated_at": "2026-02-14T05:47:36.518785+00:00", "source": "session", "source_id": "c6726418-8498-4fb2-bf40-d5dc2bbec898"}
{"id": "mm-200eca81", "content": "Tmux terminal display hierarchy: The gobby UI shows terminal titles using this fallback order: 1) pane_title (custom title set via escape sequence), 2) window_name (tmux window name), 3) pane_id (fallback). The backend extracts pane_title from `tmux list-panes -F '#{pane_title}'` and window_name from `#{window_name}` format variables in session_manager.py.", "type": "fact", "tags": ["tmux", "terminals", "display-logic", "backend"], "created_at": "2026-02-14T05:47:36.496582+00:00", "updated_at": "2026-02-14T05:47:36.496582+00:00", "source": "session", "source_id": "c6726418-8498-4fb2-bf40-d5dc2bbec898"}
{"id": "mm-41a7acb2", "content": "Multi-agent orchestration design requires deciding between: (1) MCP tools-only party creation vs UI-based, and (2) coordinator as special party type vs regular party with extra responsibilities. User chose MCP-only and coordinator-as-regular-party for v1 simplification.", "type": "pattern", "tags": ["gobby", "multi-agent", "design-decisions"], "created_at": "2026-02-14T04:47:26.775893+00:00", "updated_at": "2026-02-14T04:47:26.775893+00:00", "source": "session", "source_id": "b3dd2fcc-0812-422b-9684-637398fad0db"}
{"id": "mm-b8d8bcc3", "content": "The gobby project's multi-agent orchestration plan (party-time.md) uses a two-phase approach: Phase 1 creates parties via MCP tools only (no UI), while Phase 2 adds UI features. User explicitly confirmed MCP-only party creation and removal of UI complexity from initial scope to simplify v1 implementation.", "type": "preference", "tags": ["gobby", "multi-agent", "architecture", "scope-decision"], "created_at": "2026-02-14T04:47:26.755161+00:00", "updated_at": "2026-02-14T04:47:26.755161+00:00", "source": "session", "source_id": "b3dd2fcc-0812-422b-9684-637398fad0db"}
{"id": "mm-670afc86", "content": "The projects table schema uses 'repo_path' (not 'path') as the column name for the project directory path. Query failed initially with 'SELECT id, name, path FROM projects' before discovering the correct column name is 'repo_path'.", "type": "fact", "tags": ["database", "schema", "projects-table"], "created_at": "2026-02-14T02:47:09.176649+00:00", "updated_at": "2026-02-14T02:47:09.176649+00:00", "source": "session", "source_id": "38b703f2-ec82-4ed4-a833-e33c5fca0f74"}
{"id": "mm-66069763", "content": "The gobby web UI follows a consistent 3-component pattern for list views: TasksPage uses .tasks-toolbar + .tasks-table + .task-detail-backdrop; MemoryPage uses .memory-overview + .memory-table + .memory-detail-backdrop. Each has matching CSS styling conventions (12px gaps, 20px padding, fixed backdrop overlays). This pattern should be replicated for new list-based pages.", "type": "pattern", "tags": ["gobby", "ui-architecture", "css-conventions", "component-structure"], "created_at": "2026-02-14T02:47:04.549124+00:00", "updated_at": "2026-02-14T02:47:04.549124+00:00", "source": "session", "source_id": "7800b210-9ada-4c96-be2c-a4ab56dfadfc"}
{"id": "mm-00e03ece", "content": "A workflow filtered by source='claude_code' that fires at system_start and uses inject_context would be an effective way to reinforce MCP progressive disclosure rules specifically for Claude Code agents, since they seem to struggle with this pattern more than other agents.", "type": "pattern", "tags": ["workflows", "claude-code", "mcp", "system-design"], "created_at": "2026-02-14T02:46:58.134351+00:00", "updated_at": "2026-02-14T02:46:58.134351+00:00", "source": "session", "source_id": "7cec244a-9ea7-4bad-947e-9ff9e11b8040"}
{"id": "mm-7e44eacc", "content": "Progressive disclosure for MCP tools only needs to be followed once per tool, not on every invocation. The system prompt already states this, but agents often miss it and call list_mcp_servers → get_mcp_server_info → invoke repeatedly when they could skip directly to invoke after the first discovery.", "type": "pattern", "tags": ["mcp", "progressive-disclosure", "tool-usage", "optimization"], "created_at": "2026-02-14T02:46:58.112912+00:00", "updated_at": "2026-02-14T02:46:58.112912+00:00", "source": "session", "source_id": "7cec244a-9ea7-4bad-947e-9ff9e11b8040"}
{"id": "mm-281b95bc", "content": "TaskValidationConfig in gobby had a stale default_model value that didn't match the actual model being used, causing validation failures. This was a one-line fix updating the default in the config class, committed as b4d4ff3f for task #8144.", "type": "fact", "tags": ["bug", "TaskValidationConfig", "default_model", "validation"], "created_at": "2026-02-14T02:46:51.157777+00:00", "updated_at": "2026-02-14T02:46:51.157777+00:00", "source": "session", "source_id": "488b960d-bc09-455f-9245-29591d5d58ec"}
{"id": "mm-7e48156c", "content": "Web chat session architecture: GobbySession has both `id` (internal DB UUID) and `external_id` (conversation UUID used by WebSocket). The REST API GET /sessions/{session_id}/messages uses the internal `id`, but useChat.ts switchConversation works with `external_id`. When fetching messages from API, pass both IDs. localStorage only stores messages for sessions created in the current browser tab, so older/other sessions need API fetch.", "type": "architecture", "tags": ["web-chat", "sessions", "api", "frontend"], "created_at": "2026-02-14T02:21:11.875962+00:00", "updated_at": "2026-02-14T02:21:11.875962+00:00", "source": "mcp_tool", "source_id": "7d07dcc1-b830-490a-83f0-73b9110383e5"}
{"id": "mm-6e6dbc10", "content": "The auto-task workflow in gobby requires registering new workflow actions in two places: 1) `actions.py` registration (often auto-added by linter), and 2) the workflow YAML definition in `src/gobby/install/shared/workflows/auto-task.yaml`. The workflow state actions use `set_enabled(False)` when completing loops to disable auto-suggestion.", "type": "pattern", "tags": ["gobby", "workflow", "auto-task", "registration", "yaml"], "created_at": "2026-02-14T02:17:48.438244+00:00", "updated_at": "2026-02-14T02:17:48.438244+00:00", "source": "session", "source_id": "7746aa93-2dc9-4266-a95e-8082ccbf1294"}
{"id": "mm-a46bdb55", "content": "In gobby's workflow system, `workflow_state_manager` is always created from `task_manager` passed to action handlers. When `session_task` auto-completes and `suggest_next_task` is called, the workflow state must be loaded using the `session_id` to properly scope to the session task context, not arbitrary parent tasks.", "type": "pattern", "tags": ["gobby", "workflow", "session_task", "suggest_next_task", "state_manager"], "created_at": "2026-02-14T02:17:48.436457+00:00", "updated_at": "2026-02-14T02:17:48.436457+00:00", "source": "session", "source_id": "7746aa93-2dc9-4266-a95e-8082ccbf1294"}
{"id": "mm-94fa6594", "content": "Pre-tool-use hooks in the gobby system can block tool execution. When a tool is blocked by a hook, sibling tool calls in the same turn will fail with 'Sibling tool call errored'. The stop hook will provide feedback with 'Do not stop. A tool was blocked — follow the instructions' to guide recovery.", "type": "pattern", "tags": ["gobby", "hooks", "error-handling", "tool-blocking"], "created_at": "2026-02-14T01:46:45.943642+00:00", "updated_at": "2026-02-14T01:46:45.943642+00:00", "source": "session", "source_id": "de719076-42a5-4e2e-a1dd-54ea5bdbb3b1"}
{"id": "mm-e17e41f5", "content": "The gobby workflow system's set_variable tool requires string values even for boolean variables. When setting boolean workflow variables, pass \"true\" or \"false\" as strings rather than JSON boolean literals, otherwise the tool will error.", "type": "fact", "tags": ["gobby", "workflow", "set_variable", "api-gotcha"], "created_at": "2026-02-14T01:46:45.457938+00:00", "updated_at": "2026-02-14T01:46:45.457938+00:00", "source": "session", "source_id": "de719076-42a5-4e2e-a1dd-54ea5bdbb3b1"}
{"id": "mm-501fd4e5", "content": "Task #8121 added skill usage tracking to the get_skill() MCP handler. The implementation uses session_manager.resolve_session_reference() to handle session_id parameters, and the test coverage for the 'if session_id:' branch was already complete from existing tests, so no additional coverage tests were needed.", "type": "context", "tags": ["gobby", "task-8121", "skill-tracking", "test-coverage"], "created_at": "2026-02-14T01:46:37.568728+00:00", "updated_at": "2026-02-14T01:46:37.568728+00:00", "source": "session", "source_id": "5bb31c58-6ddd-4e02-b6ea-25ee2ea3621a"}
{"id": "mm-2cb13f49", "content": "The session_manager.resolve_session_reference() method is used to handle session_id parameters that can accept both direct IDs and references. This allows MCP handlers to accept flexible session identifiers without manual parsing logic.", "type": "pattern", "tags": ["gobby", "session_manager", "api-design", "session_id"], "created_at": "2026-02-14T01:46:37.374862+00:00", "updated_at": "2026-02-14T01:46:37.374862+00:00", "source": "session", "source_id": "5bb31c58-6ddd-4e02-b6ea-25ee2ea3621a"}
{"id": "mm-d30c4d03", "content": "User preference confirmed: For config management tools, prefer building a new gobby-config server (lightweight HTTP server exposing CRUD operations) over adding direct DB access to CLI tools. This maintains separation of concerns and avoids duplicating database access logic.", "type": "preference", "tags": ["gobby", "config", "architecture-decision", "gobby-config"], "created_at": "2026-02-14T01:46:22.681766+00:00", "updated_at": "2026-02-14T01:46:22.681766+00:00", "source": "session", "source_id": "a5e24b58-a6c5-4da0-b65b-b05ff10f1c38"}
{"id": "mm-f94f1e0a", "content": "Gobby daemon config system uses three-phase loading: Phase 1 loads from TOML file (config.toml) via load_config(), Phase 2 reloads from DB via ConfigStore (secrets override env vars), Phase 3 reloads from environment variables. The config_store field in ServerContext is typed as Any | None with comment '# ConfigStore' because of circular import issues between gobby.config and the daemon.", "type": "fact", "tags": ["gobby", "config", "architecture", "config_store"], "created_at": "2026-02-14T01:46:22.664691+00:00", "updated_at": "2026-02-14T01:46:22.664691+00:00", "source": "session", "source_id": "a5e24b58-a6c5-4da0-b65b-b05ff10f1c38"}
{"id": "mm-f9238768", "content": "Task gobby-#8135 renamed task status 'approved' to 'review_approved' and added new 'implementation_approved' status. This change was committed in commit 32f14960 on branch 0.2.15.", "type": "fact", "tags": ["gobby", "task-status", "schema-change"], "created_at": "2026-02-14T01:46:04.325926+00:00", "updated_at": "2026-02-14T01:46:04.325926+00:00", "source": "session", "source_id": "dcbfaeaf-422b-47a5-94a4-dbeeccf81ef5"}
{"id": "mm-a6968578", "content": "The gobby daemon loses session state on restart, causing MCP tool calls (like update_task_status) to fail with 'Session not found' errors. This happens even after successful commits because the daemon doesn't persist session context across restarts. Tasks may also disappear from queries after daemon restarts.", "type": "fact", "tags": ["gobby", "daemon", "session-state", "mcp", "bug"], "created_at": "2026-02-14T01:46:03.893755+00:00", "updated_at": "2026-02-14T01:46:03.893755+00:00", "source": "session", "source_id": "dcbfaeaf-422b-47a5-94a4-dbeeccf81ef5"}
{"id": "mm-c3b5522e", "content": "Workflow templates in gobby are defined in `src/gobby/workflows/workflow_templates.py` and must follow the WorkflowDefinition schema from `gobby/workflows/definition.py`. The templates are registered in WORKFLOW_TEMPLATES dict and exposed via the `/api/v1/workflows/templates` endpoint in the HTTP server.", "type": "pattern", "tags": ["gobby", "workflows", "api", "templates"], "created_at": "2026-02-14T01:35:49.845900+00:00", "updated_at": "2026-02-14T01:35:49.845900+00:00", "source": "session", "source_id": "7746aa93-2dc9-4266-a95e-8082ccbf1294"}
{"id": "mm-bf7ff592", "content": "The gobby project has two separate template systems: 1) `gobby/workflows/templates.py` is a Jinja2 template engine for rendering workflow definitions (using TemplateEngine protocol), and 2) `gobby/workflows/workflow_templates.py` stores actual workflow template definitions as Python objects. These serve different purposes and should not be confused.", "type": "context", "tags": ["gobby", "architecture", "templates", "workflows"], "created_at": "2026-02-14T01:35:49.842412+00:00", "updated_at": "2026-02-14T01:35:49.842412+00:00", "source": "session", "source_id": "7746aa93-2dc9-4266-a95e-8082ccbf1294"}
{"id": "mm-6fc4577b", "content": "Test file created at tests/memory/test_maintenance_update.py for testing the maintenance module. The initial test run showed failures, indicating TDD approach where tests are written before implementation.", "type": "context", "tags": ["gobby", "testing", "maintenance", "test_maintenance_update"], "created_at": "2026-02-14T01:07:24.901440+00:00", "updated_at": "2026-02-14T01:07:24.901440+00:00", "source": "session", "source_id": "76f0f247-5e6e-4138-9197-514674be550d"}
{"id": "mm-bdc7ddc7", "content": "The `decay_memories` function in src/gobby/memory/services/maintenance.py has no external callers in the codebase (confirmed via grep). It's only called internally within the maintenance module, making it safe to refactor without affecting other components.", "type": "fact", "tags": ["gobby", "memory", "maintenance", "decay_memories", "refactoring"], "created_at": "2026-02-14T01:07:24.898078+00:00", "updated_at": "2026-02-14T01:07:24.898078+00:00", "source": "session", "source_id": "76f0f247-5e6e-4138-9197-514674be550d"}
{"id": "mm-99bb58e7", "content": "WorkflowBuilder.tsx was modified to add edge styling CSS with three edge types and a settings panel implementation. The specific edit added edge type styles and panel UI at lines that extended the existing React Flow-based workflow builder component.", "type": "context", "tags": ["gobby", "workflow-builder", "implementation", "edges"], "created_at": "2026-02-14T00:59:38.535956+00:00", "updated_at": "2026-02-14T00:59:38.535956+00:00", "source": "session", "source_id": "7746aa93-2dc9-4266-a95e-8082ccbf1294"}
{"id": "mm-255d9587", "content": "The gobby project task validation requires edge styling (three edge types) and a settings panel before tasks can be closed. Attempting to close task #8209 failed with validation_failed error because these features were missing from the WorkflowBuilder implementation, despite save/load functionality being complete.", "type": "fact", "tags": ["gobby", "task-validation", "workflow-builder", "requirements"], "created_at": "2026-02-14T00:59:38.533596+00:00", "updated_at": "2026-02-14T00:59:38.533596+00:00", "source": "session", "source_id": "7746aa93-2dc9-4266-a95e-8082ccbf1294"}
{"id": "mm-b0316829", "content": "When the left sidebar is collapsed on desktop, the conversation picker (.conversation-picker) has position: fixed and uses CSS transform: translateX(-100%) to slide it off-screen. On mobile, it uses position: absolute instead. The picker width is controlled by --sidebar-width CSS variable (280px default) and stays full-width even when sidebar is collapsed, relying on the transform for hiding.", "type": "fact", "tags": ["gobby", "css", "sidebar", "responsive-design"], "created_at": "2026-02-14T00:55:58.812849+00:00", "updated_at": "2026-02-14T00:55:58.812849+00:00", "source": "session", "source_id": "72911461-e80e-441c-89af-f7ab0a1aea6c"}
{"id": "mm-e75f86af", "content": "The gobby web app has TWO separate navigation systems: (1) Top navigation in ChatPage.tsx with items like Dashboard/Chat/Settings/Help that controls the right-side content area, and (2) A collapsible left sidebar (Sidebar component) managed by App.tsx with sidebarOpen/setSidebarOpen state. The conversation picker lives in the left sidebar, NOT in ChatPage's top navigation.", "type": "context", "tags": ["gobby", "architecture", "navigation", "ui-layout"], "created_at": "2026-02-14T00:55:58.810280+00:00", "updated_at": "2026-02-14T00:55:58.810280+00:00", "source": "session", "source_id": "72911461-e80e-441c-89af-f7ab0a1aea6c"}
{"id": "mm-7dc797ad", "content": "The TaskList tool's pre-tool-use hook in gobby project can fail with CC-related errors. The error message shows: 'PreToolUse:TaskList hook error: [uv run python \".claude/hooks/hook_dispatcher.py\" --type=pre-tool-use]' followed by a CC-related error (truncated in transcript). This indicates hook_dispatcher.py may have environment or dependency issues when running pre-tool-use hooks.", "type": "fact", "tags": ["gobby", "hooks", "TaskList", "debugging", "hook_dispatcher"], "created_at": "2026-02-14T00:27:42.777073+00:00", "updated_at": "2026-02-14T00:27:42.777073+00:00", "source": "session", "source_id": "a5223304-6227-4c46-b4b4-f093ffe8842f"}
{"id": "mm-e994368d", "content": "Task #8273 required committing changes before closing, even though no files were modified in the session. The gobby task workflow enforces that tasks must have commits (using git add + git commit) before close_task can succeed, regardless of whether actual code changes were made during the session.", "type": "pattern", "tags": ["gobby-workflow", "task-management", "git-commit"], "created_at": "2026-02-14T00:25:29.839164+00:00", "updated_at": "2026-02-14T00:25:29.839164+00:00", "source": "session", "source_id": "72911461-e80e-441c-89af-f7ab0a1aea6c"}
{"id": "mm-244de536", "content": "After a chat interruption in Claude Code, the SDK leaves stale response events in the event stream that must be drained before processing new requests. The fix involves calling `await self.sdk_client.aclose()` and `self.sdk_client = anthropic.AsyncAnthropic(...)` to reset the client connection in chat_session.py when handling interruptions.", "type": "fact", "tags": ["claude-sdk", "bug-fix", "chat-interruption", "event-stream"], "created_at": "2026-02-14T00:25:29.837112+00:00", "updated_at": "2026-02-14T00:25:29.837112+00:00", "source": "session", "source_id": "72911461-e80e-441c-89af-f7ab0a1aea6c"}
{"id": "mm-0ca7ed92", "content": "Playwright WebSocket mocking for gobby web UI: The app creates 3 WebSocket connections to /ws (useChat, useTerminal, useTmuxSessions). A mock that stores only one __mockWs will lose the chat handler when later connections overwrite it. Fix: track all mocks in __allMockWs array and broadcast handshake messages to all. For chat-specific messages (chat_stream), identify the chat WS by detecting which one sent a subscribe message with 'chat_stream' in events. Store it as __chatWs and target it specifically to avoid duplicate message processing.", "type": "debugging", "tags": ["playwright", "websocket", "testing", "web-ui", "mock"], "created_at": "2026-02-14T00:24:47.528952+00:00", "updated_at": "2026-02-14T00:24:47.528952+00:00", "source": "mcp_tool", "source_id": "72911461-e80e-441c-89af-f7ab0a1aea6c"}
{"id": "mm-2213cb44", "content": "Chat UI off-by-one bug after interrupt: When a user sends a new message while the previous response is streaming, the Claude SDK's response buffer isn't fully drained after interrupt(). The next receive_response() call returns stale events from the interrupted query, and _stream_chat_response tags them with the NEW request_id — so the frontend renders the old response as if it belongs to the new message. Fix: Added drain_pending_response() to ChatSession (chat_session.py) that consumes remaining events after interrupt, and call it in _cancel_active_chat (websocket/chat.py) after task cancellation.", "type": "debugging", "tags": ["chat", "websocket", "interrupt", "claude-sdk", "off-by-one", "bug-fix"], "created_at": "2026-02-14T00:24:41.708389+00:00", "updated_at": "2026-02-14T00:24:41.708389+00:00", "source": "mcp_tool", "source_id": "72911461-e80e-441c-89af-f7ab0a1aea6c"}
{"id": "mm-9f587b4b", "content": "Test file created at tests/memory/test_manager_vectorstore.py for MemoryManager VectorStore integration. Tests cover: vector-based storage/retrieval, semantic search with cosine similarity, conversation association, and proper cleanup. This establishes the contract before the rewrite.", "type": "context", "tags": ["testing", "memory", "tdd"], "created_at": "2026-02-13T23:34:59.764259+00:00", "updated_at": "2026-02-13T23:34:59.764259+00:00", "source": "session", "source_id": "76f0f247-5e6e-4138-9197-514674be550d"}
{"id": "mm-dd7a3b7c", "content": "MemoryManager refactor (#8246): Switching from custom chunking to VectorStore-based storage. Key implementation detail - VectorStore.add() already handles chunking internally via chunk_text(), so MemoryManager no longer needs its own chunking logic. The embeddings module uses LiteLLM with 'text-embedding-3-small' model (1536 dimensions) by default.", "type": "fact", "tags": ["memory", "vectorstore", "refactoring", "architecture"], "created_at": "2026-02-13T23:34:57.461562+00:00", "updated_at": "2026-02-13T23:34:57.461562+00:00", "source": "session", "source_id": "76f0f247-5e6e-4138-9197-514674be550d"}
{"id": "mm-5ce4ea60", "content": "When testing Claude Code interrupt handling with long-running commands, use `bash sleep 120` in the Bash tool rather than Playwright-based tests. The Playwright approach had issues with empty responses and timing, while direct bash commands provide reliable interrupt testing.", "type": "pattern", "tags": ["testing", "interrupts", "claude-code", "bash", "playwright"], "created_at": "2026-02-13T23:34:37.940362+00:00", "updated_at": "2026-02-13T23:34:37.940362+00:00", "source": "session", "source_id": "93d0affd-322f-48db-a130-f3bc337b2bb3"}
{"id": "mm-b8e17a47", "content": "When testing gobby Playwright automation with long-running commands (e.g., `sleep 120`), the command runs in background and completes immediately rather than blocking. To properly test interruption handling, send input during execution rather than after completion. The automation successfully handles sending keyboard input ('1', '2') and submitting via Playwright actions.", "type": "pattern", "tags": ["gobby", "playwright", "testing", "bash", "async-behavior"], "created_at": "2026-02-13T23:34:08.487759+00:00", "updated_at": "2026-02-13T23:34:08.487759+00:00", "source": "session", "source_id": "93d0affd-322f-48db-a130-f3bc337b2bb3"}
{"id": "mm-740436b5", "content": "Qdrant embedded mode requires string point IDs to be valid UUIDs. Non-UUID strings like 'mem-1' will raise ValueError('Point id mem-1 is not a valid UUID'). Use uuid.uuid5() or actual UUIDs for point IDs.", "type": "fact", "tags": ["qdrant", "gotcha", "uuid"], "created_at": "2026-02-13T23:25:51.626368+00:00", "updated_at": "2026-02-13T23:25:51.626368+00:00", "source": "mcp_tool", "source_id": "76f0f247-5e6e-4138-9197-514674be550d"}
{"id": "mm-4e69f1e8", "content": "MemoryPage.tsx: KnowledgeGraph component causes black screen crash when loaded over HTTP/2 in production. Fix: lazy-load KnowledgeGraph using React.lazy() and wrap in Suspense boundary with loading fallback. This prevents the component from breaking the entire page render.", "type": "fact", "tags": ["gobby", "react", "KnowledgeGraph", "http2", "lazy-loading", "crash-fix"], "created_at": "2026-02-13T23:14:55.403357+00:00", "updated_at": "2026-02-13T23:14:55.403357+00:00", "source": "session", "source_id": "3ef282c6-b74c-41bc-8a22-cbd6b147a758"}
{"id": "mm-0ca5f7c1", "content": "Latest database migration in gobby is v98. When investigating task status or schema changes, migrations are located in the standard migrations directory and can be searched with grep for 'approved' or specific status values to track schema evolution.", "type": "fact", "tags": ["database", "migrations", "schema-version"], "created_at": "2026-02-13T22:47:36.110489+00:00", "updated_at": "2026-02-13T22:47:36.110489+00:00", "source": "session", "source_id": "2ae83521-f775-4419-872d-fb069e31cc95"}
{"id": "mm-2228a8ca", "content": "The gobby backend uses a TaskStatus Literal type with allowed values: 'pending', 'in_progress', 'completed', 'failed', 'approved' (defined in src/gobby/storage/tasks/_models.py line 88). The 'approved' status exists only in the backend model's Literal definition and is not referenced anywhere else in the codebase—not in API routes, frontend hooks (useTasks.ts), or TypeScript GobbyTask interface.", "type": "fact", "tags": ["task-status", "schema", "backend", "unused-status"], "created_at": "2026-02-13T22:47:34.424368+00:00", "updated_at": "2026-02-13T22:47:34.424368+00:00", "source": "session", "source_id": "2ae83521-f775-4419-872d-fb069e31cc95"}
{"id": "mm-307ca80f", "content": "Vite dev server (web/vite.config.ts) requires `host: '0.0.0.0'` to be accessible over Tailscale. Without it, Vite defaults to localhost-only binding. The host is now configurable via GOBBY_UI_HOST env var (default: localhost). spawn_ui_server in cli/utils.py sets this env var from config.ui.host. For Tailscale access: set ui.host: 0.0.0.0 in config.yaml. IMPORTANT: Vite 6 also enforces allowedHosts checks when host is 0.0.0.0. The config now sets allowedHosts: true when bound to 0.0.0.0 to allow raw Tailscale IPs (100.x.y.z). Without this, Vite returns a 403/blank page for hosts not matching the allowlist.", "type": "fact", "tags": ["tailscale", "vite", "ui", "networking", "configuration"], "created_at": "2026-02-13T21:55:54.804550+00:00", "updated_at": "2026-02-13T22:01:56.973686+00:00", "source": "mcp_tool", "source_id": "3ef282c6-b74c-41bc-8a22-cbd6b147a758"}
{"id": "mm-d7bca7ba", "content": "Workflow loader uses a cache layer (loader_cache.py) to avoid re-parsing workflow files. The cache is separate from the storage manager's database layer, creating a three-tier system: DB lookup → filesystem discovery → cached parsing.", "type": "pattern", "tags": ["workflow-loader", "caching", "performance"], "created_at": "2026-02-13T21:51:44.501728+00:00", "updated_at": "2026-02-13T21:51:44.501728+00:00", "source": "session", "source_id": "7746aa93-2dc9-4266-a95e-8082ccbf1294"}
{"id": "mm-1f6817c1", "content": "gobby's workflow discovery system uses a two-tier lookup: first checks database via storage_manager.get_workflow_by_ref() for refs like '#8190', then falls back to filesystem scanning via discover_workflows(). The storage layer (storage/manager.py) provides the DB-first lookup capability.", "type": "pattern", "tags": ["workflow-discovery", "database-lookup", "architecture"], "created_at": "2026-02-13T21:51:42.344287+00:00", "updated_at": "2026-02-13T21:51:42.344287+00:00", "source": "session", "source_id": "7746aa93-2dc9-4266-a95e-8082ccbf1294"}
{"id": "mm-af2d2167", "content": "When adding new tables to BASELINE_SCHEMA in migrations.py, fresh databases apply baseline only (no migration functions run). If the migration function includes data import logic (like bundled YAML import), that logic must also be called from _apply_baseline(). Extract shared logic into a separate function callable from both places. The _import_bundled_workflows() pattern demonstrates this.", "type": "pattern", "tags": ["migrations", "baseline", "pattern"], "created_at": "2026-02-13T21:50:57.073822+00:00", "updated_at": "2026-02-13T21:50:57.073822+00:00", "source": "mcp_tool", "source_id": "7746aa93-2dc9-4266-a95e-8082ccbf1294"}
{"id": "mm-b158a702", "content": "SQLite does not support COALESCE() or other expressions inside inline UNIQUE table constraints (e.g., UNIQUE(name, COALESCE(project_id, '__global__'))). This causes 'expressions prohibited in PRIMARY KEY and UNIQUE constraints' error. The fix is to use a CREATE UNIQUE INDEX instead: CREATE UNIQUE INDEX idx_name ON table(col1, COALESCE(col2, 'default')). Also watch for trailing commas before closing ) when removing inline constraints from CREATE TABLE statements.", "type": "pattern", "tags": ["sqlite", "migrations", "gotcha"], "created_at": "2026-02-13T21:50:49.784898+00:00", "updated_at": "2026-02-13T21:50:49.784898+00:00", "source": "mcp_tool", "source_id": "7746aa93-2dc9-4266-a95e-8082ccbf1294"}
{"id": "mm-31f70bf8", "content": "The gobby workflow system blocks direct tool calls and requires using `set_variable` to set `tool_call_approved=false` first when a pre-tool-use hook error occurs. The stop hook instructs to follow instructions in the error message rather than stopping immediately.", "type": "pattern", "tags": ["gobby", "workflow", "hooks", "tool-blocking"], "created_at": "2026-02-13T21:47:49.217962+00:00", "updated_at": "2026-02-13T21:47:49.217962+00:00", "source": "session", "source_id": "fa953ccc-f803-4490-b8cd-8f6046569c27"}
{"id": "mm-090277c5", "content": "Memory creation tool returns 'similar_existing_memories' field that identifies potentially duplicate memories by ID (e.g., 'mm-3e04f4d2'). When creating memories during stop hooks, check this field to avoid creating redundant memories when similar content already exists.", "type": "fact", "tags": ["memory-creation", "deduplication", "gobby-mcp"], "created_at": "2026-02-13T21:13:24.134358+00:00", "updated_at": "2026-02-13T21:13:24.134358+00:00", "source": "session", "source_id": "8af1ee78-361a-47f5-bc3f-450b3aa0301a"}
{"id": "mm-12e88487", "content": "The stop hook system has a feedback mechanism where hooks can return guidance that prompts memory creation. When a stop hook requests a review ('Before stopping, briefly review what you learned this session'), the agent should save relevant memories before clearing the session flag. This creates a workflow: stop hook triggers → agent reviews session → creates memories → clears flag.", "type": "pattern", "tags": ["hooks", "stop-hook", "memory-creation", "workflow"], "created_at": "2026-02-13T21:13:22.412621+00:00", "updated_at": "2026-02-13T21:13:22.412621+00:00", "source": "session", "source_id": "8af1ee78-361a-47f5-bc3f-450b3aa0301a"}
{"id": "mm-99127e8b", "content": "mypy type: ignore elimination patterns in gobby:\n\n1. `types.ModuleType | None` for optional imports (try/except ImportError) loses specific type info — attribute access returns Any. Wrap return values with `float()`, `str()` etc. to satisfy `no-any-return`.\n\n2. mypy 1.19.1: `ignore_missing_imports = true` (global or per-module) does NOT suppress `import-untyped` errors. Fix: install `types-*` stub packages (e.g., `types-croniter`).\n\n3. ruff B010 (\"don't use setattr with constant attr\") conflicts with mypy `attr-defined` (setting attrs on Callable). Solution: `f: Any = func; f._attr = value` — satisfies both linters.\n\n4. mypy doesn't always narrow Literal types through `in` checks on property access from config objects. Use explicit `cast(LiteralType, value)` instead.\n\n5. `dict[str, type | tuple[type, ...]]` explicit annotation on type_map dicts fixes isinstance arg-type errors that occur with inferred dict types.", "type": "pattern", "tags": ["mypy", "type-checking", "ruff", "linting"], "created_at": "2026-02-13T21:10:25.786282+00:00", "updated_at": "2026-02-13T21:10:25.786282+00:00", "source": "mcp_tool", "source_id": "4311fa28-1d3f-4f3a-a016-4855e97890fd"}
{"id": "mm-777ddd66", "content": "The gobby hook system's post-tool-use hooks do not receive tool_result data in the context. This is a Claude Code limitation where the tool result is not available to post-execution hooks, only pre-tool-use hooks have access to tool parameters.", "type": "fact", "tags": ["gobby", "hooks", "claude-code", "limitation", "post-tool-use"], "created_at": "2026-02-13T21:08:32.713972+00:00", "updated_at": "2026-02-13T21:08:32.713972+00:00", "source": "session", "source_id": "27f67e88-877e-464e-af4f-e18aa7ae39e9"}
{"id": "mm-6c7f6ad9", "content": "The gobby task system's close_task validation requires commit_sha when edits were made during the session, even if those edits were reverted. The error 'missing_commits_for_edits' occurs when trying to close a task with session edits but no commits. Workaround: pass commit_sha=False to route the task to review status instead of completed.", "type": "fact", "tags": ["gobby", "task-system", "close_task", "validation", "workaround"], "created_at": "2026-02-13T21:08:31.040298+00:00", "updated_at": "2026-02-13T21:08:31.040298+00:00", "source": "session", "source_id": "27f67e88-877e-464e-af4f-e18aa7ae39e9"}
{"id": "mm-12954792", "content": "When test fixtures create registries via create_workflows_registry(db=mock_db), the registry auto-creates WorkflowInstanceManager and SessionVariableManager from db. These managers call db.execute() and json.loads() on results, which fails with MagicMock. Fix: patch both constructors to return None so the registry uses backward-compat code paths that don't touch the db.", "type": "insight", "tags": ["testing", "workflows", "mcp-proxy", "fixtures"], "created_at": "2026-02-13T20:48:42.668265+00:00", "updated_at": "2026-02-13T20:48:42.668265+00:00", "source": "mcp_tool", "source_id": "8af1ee78-361a-47f5-bc3f-450b3aa0301a"}
{"id": "mm-f0e41930", "content": "MagicMock(spec=PydanticModel) does NOT expose Pydantic v2 fields as attributes. Pydantic fields are defined via class-level annotations and __init__, not as class attributes, so mock spec introspection misses them. You must explicitly set field values on the mock: `mock.enabled = True`. This caused 'Mock object has no attribute enabled' errors on MagicMock(spec=WorkflowDefinition) instances.", "type": "insight", "tags": ["testing", "pydantic", "mock", "python", "gotcha"], "created_at": "2026-02-13T20:48:37.079862+00:00", "updated_at": "2026-02-13T20:48:37.079862+00:00", "source": "mcp_tool", "source_id": "8af1ee78-361a-47f5-bc3f-450b3aa0301a"}
{"id": "mm-799c2dee", "content": "The gobby database file (~/.gobby/gobby-hub.db) is 1.75GB in size with no WAL or journal files present, indicating it operates in DELETE mode rather than WAL mode. This was discovered during investigation of potential database-related issues.", "type": "fact", "tags": ["database", "sqlite", "storage", "performance"], "created_at": "2026-02-13T20:47:42.143825+00:00", "updated_at": "2026-02-13T20:47:42.143825+00:00", "source": "session", "source_id": "69b52472-ad73-440e-b067-20cab7057948"}
{"id": "mm-ebf7485c", "content": "Gobby daemon startup sequence: main.py creates DaemonManager with ServerManager → ServerManager.run() calls _bind_socket() with bind_host from config (default 'localhost') → find_free_port() helper uses '0.0.0.0' as host, not the actual bind_host. The config is in src/gobby/config/app.py with bind_host default='localhost' and port default=60887.", "type": "context", "tags": ["gobby", "daemon", "architecture", "startup-flow"], "created_at": "2026-02-13T20:47:35.501556+00:00", "updated_at": "2026-02-13T20:47:35.501556+00:00", "source": "session", "source_id": "aed5d772-3baa-4249-b0f2-cd721b653301"}
{"id": "mm-01cdfb5e", "content": "The gobby daemon's default bind_host is 'localhost' (not '0.0.0.0'), which prevents external connections. The find_free_port() function in src/gobby/daemon/server.py binds to '0.0.0.0' when searching for available ports, creating a mismatch that can cause port conflicts when the daemon later tries to bind to 'localhost' on what find_free_port() reported as free.", "type": "fact", "tags": ["gobby", "daemon", "networking", "bug", "port-binding"], "created_at": "2026-02-13T20:47:33.742628+00:00", "updated_at": "2026-02-13T20:47:33.742628+00:00", "source": "session", "source_id": "aed5d772-3baa-4249-b0f2-cd721b653301"}
{"id": "mm-bd1372ab", "content": "gobby implements provider-specific executors: CodexExecutor (for codex provider) and generic LLMProvider (for other providers). The get_litellm_model() function handles model selection/routing, accepting model name and optional ProviderType parameter.", "type": "pattern", "tags": ["architecture", "executors", "litellm", "providers"], "created_at": "2026-02-13T20:47:23.428872+00:00", "updated_at": "2026-02-13T20:47:23.428872+00:00", "source": "session", "source_id": "4311fa28-1d3f-4f3a-a016-4855e97890fd"}
{"id": "mm-c9f55b70", "content": "The gobby workflow's set_variable tool requires string values, not booleans. When setting boolean workflow variables, pass them as strings (e.g., 'true'/'false') rather than JSON booleans, as confirmed by the tool schema showing 'value' parameter type as string.", "type": "fact", "tags": ["gobby", "workflow", "api-quirk", "set_variable"], "created_at": "2026-02-13T20:47:22.486864+00:00", "updated_at": "2026-02-13T20:47:22.486864+00:00", "source": "session", "source_id": "23908b9c-fee7-43f5-956d-e6d94ea3b7ec"}
{"id": "mm-11f5b765", "content": "gobby supports 5 LLM providers via ProviderType: 'claude', 'gemini', 'codex', 'openai', 'litellm'. Each provider has distinct AuthMode types - general AuthMode is Literal['subscription', 'api_key', 'adc'], while CodexAuthMode is restricted to Literal['subscription', 'cli'] only.", "type": "fact", "tags": ["architecture", "providers", "authentication", "litellm"], "created_at": "2026-02-13T20:47:21.969775+00:00", "updated_at": "2026-02-13T20:47:21.969775+00:00", "source": "session", "source_id": "4311fa28-1d3f-4f3a-a016-4855e97890fd"}
{"id": "mm-34880fb7", "content": "When using ExitPlanMode tool, the user may reject it if the plan requires modification before exiting plan mode. The plan file content should specify the correct format for deliverables (e.g., documentation skill format for docs) in the Implementation Plan section, not apply that format to the plan file itself.", "type": "pattern", "tags": ["gobby", "plan-mode", "user-workflow", "tool-rejection"], "created_at": "2026-02-13T20:47:16.157577+00:00", "updated_at": "2026-02-13T20:47:16.157577+00:00", "source": "session", "source_id": "4552a4b4-25cd-4850-b649-29cff6320a00"}
{"id": "mm-39e493f9", "content": "The plan skill requires plan documents to be written to ~/.claude/plans/ directory with a structured format including YAML frontmatter (status, priority, created, updated, tags) followed by markdown sections for Context, Goals, Implementation Plan, Success Criteria, and Dependencies. Plan filenames use the format {adjective}-{adjective}-{noun}.md.", "type": "fact", "tags": ["gobby", "plan-skill", "file-format", "workflow"], "created_at": "2026-02-13T20:47:14.193428+00:00", "updated_at": "2026-02-13T20:47:14.193428+00:00", "source": "session", "source_id": "4552a4b4-25cd-4850-b649-29cff6320a00"}
{"id": "mm-d9c428d5", "content": "When examining claude.py issues related to auth_mode, the fix involves understanding the relationship between LLMProviderConfig (single provider config), LLMProvidersConfig (multi-provider config), and AuthMode type definition in the config module hierarchy.", "type": "pattern", "tags": ["debugging", "config", "type-system", "claude"], "created_at": "2026-02-13T20:45:39.147943+00:00", "updated_at": "2026-02-13T20:45:39.147943+00:00", "source": "session", "source_id": "34f3a1d3-d475-49de-997f-d45212512ba6"}
{"id": "mm-92a39c2a", "content": "The gobby codebase has a MemoryCrossRef class in src/gobby/storage/memories.py for linking related memories with similarity scores. The config system uses AuthMode = Literal['subscription', 'api_key'] and LLMProviderConfig types defined in src/gobby/config/llm_providers.py.", "type": "fact", "tags": ["architecture", "memory-system", "config", "schema"], "created_at": "2026-02-13T20:45:37.003857+00:00", "updated_at": "2026-02-13T20:45:37.003857+00:00", "source": "session", "source_id": "34f3a1d3-d475-49de-997f-d45212512ba6"}
{"id": "mm-44d70663", "content": "The gobby project has 33 open tasks tracked in the task management system. Major categories include: Workflow UI features (DB storage, versioning), MCP server implementations (gobby-tasks, gobby-memory, gobby-web), testing infrastructure (25% coverage goal, test generation), documentation (gaps in memory/skills/workflows), and core platform features (skill registry, error handling, telemetry).", "type": "context", "tags": ["gobby", "tasks", "project-status", "backlog"], "created_at": "2026-02-13T20:01:54.439975+00:00", "updated_at": "2026-02-13T20:01:54.439975+00:00", "source": "session", "source_id": "473c2725-9d05-47bf-8756-fc5323e4fb23"}
{"id": "mm-8d765226", "content": "The gobby-skills MCP server provides 8 tools for skill management: list_skills (lightweight list), get_skill (full details), search_skills (semantic search), create_skill, update_skill, delete_skill, validate_skill, and get_skill_stats. This server is separate from the gobby-tasks server and focuses specifically on skill CRUD operations.", "type": "fact", "tags": ["gobby-skills", "mcp", "tools", "architecture"], "created_at": "2026-02-13T19:49:35.186114+00:00", "updated_at": "2026-02-13T19:49:35.186114+00:00", "source": "session", "source_id": "6e8f0b44-35cf-4699-9802-82a2b1e500ad"}
{"id": "mm-592390fb", "content": "The TaskList tool encounters a PreToolUse hook error in the gobby project when attempting to execute, failing with 'CC' error from the hook_dispatcher.py. This blocks standard task list queries and requires using alternative methods (like MCP) to access task information.", "type": "fact", "tags": ["tasklist", "hook-error", "debugging", "workaround"], "created_at": "2026-02-13T19:49:24.172385+00:00", "updated_at": "2026-02-13T19:49:24.172385+00:00", "source": "session", "source_id": "569a3c08-67ba-4440-a42c-3a8176ef0d71"}
{"id": "mm-f0e8f89c", "content": "The TaskList tool's pre-tool-use hook in gobby project can fail with CC-related errors. The error message shows: 'PreToolUse:TaskList hook error: [uv run python \".claude/hooks/hook_dispatcher.py\" --type=pre-tool-use]' followed by a CC-related error (truncated in transcript). This indicates hook_dispatcher.py may have environment or dependency issues when running pre-tool-use hooks.", "type": "fact", "tags": ["gobby", "hooks", "TaskList", "debugging", "hook_dispatcher"], "created_at": "2026-02-13T19:49:22.284319+00:00", "updated_at": "2026-02-13T19:49:22.284319+00:00", "source": "session", "source_id": "a5223304-6227-4c46-b4b4-f093ffe8842f"}
{"id": "mm-4391925a", "content": "Root cause of MCP server crash: event_enrichment.py runs on every hook event and has a session lookup with an except handler. Narrowing it from `except Exception` to `except (sqlite3.Error, OSError)` (commit eb26fa5b) caused the hook chain to crash when session storage threw an unexpected exception type. The fix is to keep the handler broad (`except Exception`) since this is a defensive guard during shutdown/edge cases. General rule: never narrow except handlers in code that runs on every hook event — it's a critical path that must never crash.", "type": "pattern", "tags": ["debugging", "hooks", "event-enrichment", "exception-handling", "mcp", "root-cause"], "created_at": "2026-02-13T19:45:55.539664+00:00", "updated_at": "2026-02-13T19:45:55.539664+00:00", "source": "mcp_tool", "source_id": "f3411a0e-b454-4d2c-b037-488e5bf210b8"}
{"id": "mm-48afc0e6", "content": "CodeRabbit review commit 5faa48cb changed exception handling in unified_evaluator.py from `except (ValueError, Exception)` (catch-all) to split handlers that re-raise unexpected exceptions. This broke the MCP server by crashing the workflow evaluation hook chain on any unexpected error during condition evaluation. The `except (ValueError, Exception)` pattern is intentionally a catch-all — workflow conditions run user-defined expressions and must never crash the hook pipeline. Additionally, the same commit changed _session.py to return early on non-allow workflow responses during SESSION_START, which could short-circuit session initialization. Both changes together caused MCP server connection failures.", "type": "pattern", "tags": ["debugging", "workflows", "mcp", "coderabbit", "exception-handling"], "created_at": "2026-02-13T19:32:09.406942+00:00", "updated_at": "2026-02-13T19:32:09.406942+00:00", "source": "mcp_tool", "source_id": "f3411a0e-b454-4d2c-b037-488e5bf210b8"}
{"id": "mm-47bf873d", "content": "In session-lifecycle.yaml, memory_recall_relevant is configured at line 113 with trigger on_before_tool_result and condition plan_mode=true. In headless-lifecycle.yaml, it's at line 48 with trigger on_before_tool_result and condition plan_mode=false. Both suffer from the same timing issue where tool_result isn't available yet.", "type": "fact", "tags": ["config", "memory-system", "lifecycle-hooks", "gobby"], "created_at": "2026-02-13T19:31:57.145650+00:00", "updated_at": "2026-02-13T19:31:57.145650+00:00", "source": "session", "source_id": "d70d4536-067c-4c2b-9c5f-e97b2a207015"}
{"id": "mm-a8db82e1", "content": "Claude Code's lifecycle hooks execute BEFORE the tool result is returned to the agent, meaning hooks like on_before_tool_result and on_after_tool_use don't have access to tool_result content. This affects both headless-lifecycle.yaml and session-lifecycle.yaml memory_recall_relevant hooks that fire on_before_tool_result.", "type": "fact", "tags": ["claude-code", "lifecycle-hooks", "architecture", "limitations"], "created_at": "2026-02-13T19:31:55.421736+00:00", "updated_at": "2026-02-13T19:31:55.421736+00:00", "source": "session", "source_id": "d70d4536-067c-4c2b-9c5f-e97b2a207015"}
{"id": "mm-31f3c380", "content": "tmux configuration changes can be applied to running sessions with `tmux source-file ~/.tmux.conf` - no restart required even with active sessions.", "type": "fact", "tags": ["tmux", "configuration", "workflow"], "created_at": "2026-02-13T19:20:38.581569+00:00", "updated_at": "2026-02-13T19:20:38.581569+00:00", "source": "session", "source_id": "fdbe93cd-b8d2-4a91-a9bb-596077e30e6d"}
{"id": "mm-9cfbb158", "content": "tmux window renaming requires `set-option -g set-titles on` in ~/.tmux.conf to propagate title changes from terminal escape sequences. Without this setting, tmux ignores \\033]0; escape sequences used for dynamic window renaming.", "type": "fact", "tags": ["tmux", "configuration", "window-renaming", "gotcha"], "created_at": "2026-02-13T19:20:36.339521+00:00", "updated_at": "2026-02-13T19:20:36.339521+00:00", "source": "session", "source_id": "fdbe93cd-b8d2-4a91-a9bb-596077e30e6d"}
{"id": "mm-2baf5f2c", "content": "Gobby memory module structure: core types in src/gobby/memory/types.py (Memory, MemoryMetadata models), storage backends in src/gobby/memory/storage/, and comprehensive tests in tests/memory/ covering both storage implementations and API routes. The system is designed for extensible storage backends via abstract interface.", "type": "context", "tags": ["gobby", "memory", "architecture", "codebase-structure"], "created_at": "2026-02-13T18:58:34.852383+00:00", "updated_at": "2026-02-13T18:58:34.852383+00:00", "source": "session", "source_id": "9e4c719d-642f-40b1-9acf-cf77f93aa7de"}
{"id": "mm-02b44fd1", "content": "Gobby memory API exposes 4 endpoints via src/gobby/servers/routes/memory.py: POST /memories (create with content+metadata), GET /memories (list all), GET /memories/search?query=X (semantic search), DELETE /memories/{id}. MemoryCreateRequest requires 'content' field; 'metadata' and 'memory_type' are optional.", "type": "fact", "tags": ["gobby", "memory", "api", "endpoints", "schema"], "created_at": "2026-02-13T18:58:33.251209+00:00", "updated_at": "2026-02-13T18:58:33.251209+00:00", "source": "session", "source_id": "9e4c719d-642f-40b1-9acf-cf77f93aa7de"}
{"id": "mm-fa49dd86", "content": "Gobby memory system has 2 storage implementations: ChromaMemoryStorage (vector-based with embeddings) and InMemoryStorage (simple list). ChromaMemoryStorage uses sentence-transformers for embeddings and supports semantic search with similarity thresholds, while InMemoryStorage is basic append-only for testing. Located in src/gobby/memory/storage/.", "type": "fact", "tags": ["gobby", "memory", "architecture", "storage", "chroma", "embeddings"], "created_at": "2026-02-13T18:58:31.747851+00:00", "updated_at": "2026-02-13T18:58:31.747851+00:00", "source": "session", "source_id": "9e4c719d-642f-40b1-9acf-cf77f93aa7de"}
{"id": "mm-012704c2", "content": "Grep tool can count pattern matches in files using the -c flag. When used on gobby's tasks.md to count open tasks with pattern '## \\[ \\]', it returned 33 open tasks but reported '0 occurrences across 0 files' in the output message (the actual count appears on the first line).", "type": "pattern", "tags": ["grep", "gobby", "task-counting", "tool-output-format"], "created_at": "2026-02-13T18:57:41.127735+00:00", "updated_at": "2026-02-13T18:57:41.127735+00:00", "source": "session", "source_id": "87ddf002-1bd8-4b03-ad44-20e62d701dd3"}
{"id": "mm-65270815", "content": "The gobby project's tasks.md file is 5.1MB in size, which exceeds the Read tool's 256KB limit. To query task information, use Grep with pattern matching (e.g., counting '## \\[ \\]' for open tasks) rather than attempting to read the entire file.", "type": "fact", "tags": ["gobby", "tasks.md", "file-size-limit", "grep-workaround"], "created_at": "2026-02-13T18:57:39.686817+00:00", "updated_at": "2026-02-13T18:57:39.686817+00:00", "source": "session", "source_id": "87ddf002-1bd8-4b03-ad44-20e62d701dd3"}
{"id": "mm-d87a419e", "content": "Hook dispatcher implementation is in src/gobby/install/claude/hooks/hook_dispatcher.py (~395 lines). It POSTs hook data to the daemon, checks for result.get('continue') field in JSON response, and returns {'continue': True/False} to control execution flow. The dispatcher acts as a simple proxy between Claude Code and the gobby daemon's hook handlers.", "type": "fact", "tags": ["hooks", "hook-dispatcher", "implementation-details"], "created_at": "2026-02-13T18:55:50.004724+00:00", "updated_at": "2026-02-13T18:55:50.004724+00:00", "source": "session", "source_id": "17f8c57e-c691-493f-8e37-da714a535948"}
{"id": "mm-0d456479", "content": "The Claude Code hook system has a complete chain for BEFORE_AGENT events: hooks are dispatched via POST to {daemon_url}/hooks/{event_name}, which calls event handlers in src/gobby/hooks/event_handlers/. The _agent.py handler processes BEFORE_AGENT events by extracting user prompts and running them through prompt_processor.py's PromptProcessor.process() method.", "type": "pattern", "tags": ["hooks", "architecture", "event-flow", "before-agent"], "created_at": "2026-02-13T18:55:48.134057+00:00", "updated_at": "2026-02-13T18:55:48.134057+00:00", "source": "session", "source_id": "17f8c57e-c691-493f-8e37-da714a535948"}
{"id": "mm-51aa0d9c", "content": "Claude attempted to use a non-existent tool 'AskUserFollowup' which resulted in a tool_use_error. This tool is not available in the Claude Agent SDK - agents should use direct text responses for follow-up questions instead of attempting to invoke this tool.", "type": "fact", "tags": ["claude-agent-sdk", "tool-error", "debugging", "api-limitation"], "created_at": "2026-02-13T18:43:37.320160+00:00", "updated_at": "2026-02-13T18:43:37.320160+00:00", "source": "session", "source_id": "fe110a1e-6af3-4ed5-ba2f-1fc428fb703b"}
{"id": "mm-8da4f04e", "content": "The gobby project uses SQLite as the primary memory store (via MCP tools `delete_entities` and `create_entities`), not the JSONL file. The JSONL file at ~/.local/share/claude/gobby-memory.jsonl is only a backup/export mechanism and should not be edited directly for memory cleanup operations.", "type": "fact", "tags": ["gobby", "memory-storage", "sqlite", "architecture"], "created_at": "2026-02-13T18:34:17.861871+00:00", "updated_at": "2026-02-13T18:34:17.861871+00:00", "source": "session", "source_id": "f06d4c6e-d404-449c-aa35-5455489f605b"}
{"id": "mm-c820d509", "content": "Three-tier storage pattern for prompts follows the same approach as rules and skills: bundled (seeded from install/shared/prompts/ on startup), user (overrides in DB), project (project-scoped overrides). Tier precedence: project > user > bundled. Key files: storage/prompts.py (LocalPromptManager), prompts/sync.py (sync_bundled_prompts), prompts/loader.py (configure_default_loader). Migration v102 in storage/migrations.py.", "type": "architecture", "tags": ["prompts", "three-tier", "storage-pattern", "architecture"], "created_at": "2026-02-13T18:32:57.332547+00:00", "updated_at": "2026-02-13T18:32:57.332547+00:00", "source": "mcp_tool", "source_id": "17f8c57e-c691-493f-8e37-da714a535948"}
{"id": "mm-4ebe2061", "content": "SQLite nested transaction gotcha: ConfigStore.set_many() wraps its loop in self.db.transaction(). If a caller also wraps the call in db.transaction(), it fails with 'cannot start a transaction within a transaction'. Fix: use individual set() calls (which don't open transactions) inside the outer transaction block. This affected the config import endpoint in configuration.py.", "type": "insight", "tags": ["sqlite", "transaction", "gotcha", "config-store"], "created_at": "2026-02-13T18:32:51.400386+00:00", "updated_at": "2026-02-13T18:32:51.400386+00:00", "source": "mcp_tool", "source_id": "17f8c57e-c691-493f-8e37-da714a535948"}
{"id": "mm-b7e86d71", "content": "ActionExecutor class has a self.task_manager attribute (confirmed at line 105+ in the codebase with memory_manager and memory_sync_manager as sibling fields). This is the correct path to access task management functionality from within action execution context.", "type": "fact", "tags": ["gobby", "architecture", "action-executor", "task-manager"], "created_at": "2026-02-13T18:28:44.891208+00:00", "updated_at": "2026-02-13T18:28:44.891208+00:00", "source": "session", "source_id": "c1fe23ae-b957-42a4-a624-3b699e5cb301"}
{"id": "mm-f6023a42", "content": "DaemonClient in src/gobby/utils/daemon_client.py uses a default timeout of 5 seconds for health checks (DEFAULT_TIMEOUT = 5.0). The check_health() method at line 85+ uses this timeout when making requests, and catches connection errors (including 'refused' in error messages) at line 109+.", "type": "fact", "tags": ["gobby", "daemon", "timeout", "health-check", "connection-handling"], "created_at": "2026-02-13T18:28:43.344741+00:00", "updated_at": "2026-02-13T18:28:43.344741+00:00", "source": "session", "source_id": "c1fe23ae-b957-42a4-a624-3b699e5cb301"}
{"id": "mm-047ea843", "content": "gobby project uses branch-based development workflow on branch 0.2.15. DB-first config resolution feature (task #8098) was committed as 40c08803 with commit message format '[gobby-#XXXX] type: description'. The feature stores config in SQLite instead of JSON, spanning 10 files including src/gobby/app_context.py and src/gobby/config/app.py.", "type": "context", "tags": ["git-workflow", "db-config", "task-8098", "branch-0.2.15"], "created_at": "2026-02-13T18:28:16.952239+00:00", "updated_at": "2026-02-13T18:28:16.952239+00:00", "source": "session", "source_id": "929ef361-e8bf-40ce-a40c-9678a2eda059"}
{"id": "mm-a54cd00a", "content": "The `_maybe_import_yaml_to_db()` function in gobby is a one-time migration helper that is NOT used by the web UI's import/export functionality. The web UI implements its own separate import/export logic that directly interacts with the database, making `_maybe_import_yaml_to_db()` safe to remove without affecting web UI functionality.", "type": "fact", "tags": ["gobby", "migration", "web-ui", "yaml-import", "architecture"], "created_at": "2026-02-13T18:28:09.071685+00:00", "updated_at": "2026-02-13T18:28:09.071685+00:00", "source": "session", "source_id": "9ff21bbd-e29c-4e5a-b928-7264ca1fd6df"}
{"id": "mm-5ba3d89c", "content": "The gobby project has 3 failing import tests in tests/servers/routes/test_configuration_routes.py::TestExportImport::test_import_confi* that predate recent work. These are pre-existing test failures, not caused by current changes.", "type": "fact", "tags": ["testing", "known-issues", "test_configuration_routes"], "created_at": "2026-02-13T18:23:44.571253+00:00", "updated_at": "2026-02-13T18:23:44.571253+00:00", "source": "session", "source_id": "17f8c57e-c691-493f-8e37-da714a535948"}
{"id": "mm-10d7f037", "content": "The McpPage component (web/src/components/McpPage.tsx) contains server management UI with className patterns like 'mcp-server-row', 'mcp-server-header', 'mcp-connection-status', and extensive tool/resource display sections. This matches the CSS structure in McpPage.css.", "type": "fact", "tags": ["mcp-ui", "component-structure", "css-mapping"], "created_at": "2026-02-13T18:12:55.436669+00:00", "updated_at": "2026-02-13T18:12:55.436669+00:00", "source": "session", "source_id": "12691d66-2c8a-48dc-a657-2a38a333e3fb"}
{"id": "mm-8a09039d", "content": "CodeRabbit suggestions in gobby are concentrated in two CSS files: web/src/components/McpPage.css and web/src/components/CronJobsPage.css. McpPage.css is a large file (500+ lines) with extensive styling for server management UI including connection status, tool lists, and resource displays.", "type": "context", "tags": ["coderabbit", "css", "file-locations", "mcp-ui"], "created_at": "2026-02-13T18:12:53.617394+00:00", "updated_at": "2026-02-13T18:12:53.617394+00:00", "source": "session", "source_id": "12691d66-2c8a-48dc-a657-2a38a333e3fb"}
{"id": "mm-ad63f998", "content": "MemoryManager public API additions (v0.2.15+): mem0_client property (public accessor for _mem0_client), lazy_sync() async method (public version of _lazy_sync), _search_mem0_async() for async Mem0 search (preferred over sync _search_mem0 which returns None in running event loops).", "type": "fact", "tags": ["memory-system", "api"], "created_at": "2026-02-13T18:10:07.610615+00:00", "updated_at": "2026-02-13T18:10:07.610615+00:00", "source": "mcp_tool", "source_id": "7bc40fa5-1c1d-422b-86ac-9879bbdb0c01"}
{"id": "mm-6fa481fc", "content": "When refactoring code in gobby, the project has auto-fix hooks that may revert method deletions or restore old implementations. When replacing a method (e.g., replacing sync _search_mem0 with async _search_mem0_async), add the new method alongside the old one rather than deleting and replacing. The auto-fixer tends to restore deleted code blocks.", "type": "pattern", "tags": ["debugging", "linter", "hooks"], "created_at": "2026-02-13T18:09:56.366837+00:00", "updated_at": "2026-02-13T18:09:56.366837+00:00", "source": "mcp_tool", "source_id": "7bc40fa5-1c1d-422b-86ac-9879bbdb0c01"}
{"id": "mm-2f956ed1", "content": "Database-backed prompt storage plan for gobby (scalable-churning-boole.md) explicitly documents that gobby-prompts will NOT provide MCP tools, with rationale: prompts are context-injection mechanisms used internally by other tools, not standalone capabilities for external consumption.", "type": "context", "tags": ["gobby", "prompts", "database", "mcp", "plan"], "created_at": "2026-02-13T18:09:21.195764+00:00", "updated_at": "2026-02-13T18:09:21.195764+00:00", "source": "session", "source_id": "85d7e248-6f95-4730-9588-1fbf8f56d495"}
{"id": "mm-855bc444", "content": "gobby's prompt management design decision: prompts should NOT be exposed via MCP tools because they serve as internal context injection mechanisms (similar to system prompts), not end-user functionality. The 13 internal callers use PromptLoader directly within tools, making MCP exposure redundant and architecturally inconsistent.", "type": "pattern", "tags": ["gobby", "mcp", "architecture", "prompt-management", "design-decision"], "created_at": "2026-02-13T18:09:19.660323+00:00", "updated_at": "2026-02-13T18:09:19.660323+00:00", "source": "session", "source_id": "85d7e248-6f95-4730-9588-1fbf8f56d495"}
{"id": "mm-6e24f13a", "content": "McpPage.tsx component structure shows that MCP server UI includes server rows with expand/collapse functionality, control buttons (start/stop/restart), and server details sections. The CSS file contains specific styling patterns for .mcp-server-row, .mcp-server-controls, and modal dialogs that would take significant time to map without prior knowledge.", "type": "fact", "tags": ["gobby", "mcp-ui", "component-architecture", "styling-patterns"], "created_at": "2026-02-13T18:06:00.618919+00:00", "updated_at": "2026-02-13T18:06:00.618919+00:00", "source": "session", "source_id": "12691d66-2c8a-48dc-a657-2a38a333e3fb"}
{"id": "mm-a801308f", "content": "The gobby project has CodeRabbit suggestions concentrated in two CSS files: web/src/components/McpPage.css and web/src/components/CronJobsPage.css. McpPage.css is a large file (400+ lines) containing comprehensive styling for the MCP server management interface, including layout, server rows, control buttons, and modal dialogs.", "type": "context", "tags": ["gobby", "coderabbit", "css", "file-structure", "mcp-interface"], "created_at": "2026-02-13T18:05:59.262056+00:00", "updated_at": "2026-02-13T18:05:59.262056+00:00", "source": "session", "source_id": "12691d66-2c8a-48dc-a657-2a38a333e3fb"}
{"id": "mm-2d45089c", "content": "The `set_variable` tool in the gobby MCP server allows setting variables scoped to either 'session' or 'global'. Session-scoped variables persist only for the current session, while global variables persist across sessions. The tool returns the set value and scope in its response.", "type": "fact", "tags": ["gobby", "mcp-server", "set_variable", "session-scope", "global-scope"], "created_at": "2026-02-13T18:04:05.642018+00:00", "updated_at": "2026-02-13T18:04:05.642018+00:00", "source": "session", "source_id": "32fd77c0-1a22-4f53-b7c8-9286a3ac5046"}
{"id": "mm-96d47f47", "content": "The gobby MCP server has tools blocked by pre-tool-use hooks that require `get_tool_schema` to be called first to retrieve full tool documentation before the tool can be used. When a tool is blocked, the hook error message explicitly instructs to call `get_tool_schema` with the tool name to understand its parameters and purpose.", "type": "pattern", "tags": ["gobby", "mcp-server", "hooks", "tool-blocking", "get_tool_schema"], "created_at": "2026-02-13T18:04:04.078759+00:00", "updated_at": "2026-02-13T18:04:04.078759+00:00", "source": "session", "source_id": "32fd77c0-1a22-4f53-b7c8-9286a3ac5046"}
{"id": "mm-2758c733", "content": "LLM model alias resolution: Gobby has ZERO model alias resolution logic. Short names like claude-haiku-4-5 are passed through unchanged to the external SDK (LiteLLM/Anthropic/Claude Agent SDK), which handles resolution to full dated model IDs. The codebase consistently uses short aliases (20+ instances). Do NOT change individual model references to dated identifiers unless changing all of them.", "type": "insight", "tags": ["llm", "model-aliases", "architecture"], "created_at": "2026-02-13T18:03:07.851440+00:00", "updated_at": "2026-02-13T18:03:07.851440+00:00", "source": "mcp_tool", "source_id": "2f7bb646-c1c1-4605-8684-d7215e3e7d16"}
{"id": "mm-eb38832a", "content": "Workflow variable evaluation architecture: `variables.get()` in session-lifecycle.yaml `when` expressions is architecturally correct. The `variables` dict is a merged dict combining workflow state variables AND session variables, with session_variables having override priority. The `session` object in eval context is a Session DB record (id, status, branch metadata), NOT a variables container. Do NOT replace variables.get() with session.* - this would break all workflows. The set_variable workflow action persists to workflow_states.variables, and the MCP set_variable tool persists to session_variables table. Both are loaded and merged before evaluation.", "type": "insight", "tags": ["workflow-engine", "architecture", "variables", "coderabbit"], "created_at": "2026-02-13T18:03:01.434883+00:00", "updated_at": "2026-02-13T18:03:01.434883+00:00", "source": "mcp_tool", "source_id": "2f7bb646-c1c1-4605-8684-d7215e3e7d16"}
{"id": "mm-4faff19a", "content": "Gobby config supports `$secret:NAME` syntax for secrets-store integration. Pattern is resolved at config load time via `ConfigManager._resolve_secret_value()` which calls `gobby secret get NAME`. Verified working for OPENAI_API_KEY in test environment.", "type": "fact", "tags": ["config", "secrets-store", "integration", "syntax"], "created_at": "2026-02-13T16:20:38.825533+00:00", "updated_at": "2026-02-13T16:20:38.825533+00:00", "source": "session", "source_id": "8b03b181-ca3b-4b83-a28e-380a1ccfb91d"}
{"id": "mm-c30dfb0b", "content": "Both qdrant-client and chromadb natively support remote deployment modes: qdrant-client accepts a `url` parameter for remote Qdrant servers, and chromadb supports remote mode via HTTPClient. The plan explicitly includes environment-based configuration (QDRANT_URL/QDRANT_API_KEY) for production deployments.", "type": "fact", "tags": ["qdrant", "chromadb", "deployment", "remote-config"], "created_at": "2026-02-13T16:19:16.983429+00:00", "updated_at": "2026-02-13T16:19:16.983429+00:00", "source": "session", "source_id": "374d0f63-0d52-42fc-8a32-93ff33b4f5e6"}
{"id": "mm-75ebe331", "content": "The project is replacing its TF-IDF-based memory system with a vendored mem0 implementation using Qdrant as the vector store. The plan involves 5 waves: vendoring mem0 core logic, integrating Qdrant client (supports both local and remote with `url` parameter), replacing existing memory layer, removing TF-IDF components, and adding mem0-specific features like hierarchical memories and custom categories.", "type": "context", "tags": ["memory-system", "architecture", "mem0", "qdrant", "migration"], "created_at": "2026-02-13T16:19:15.414983+00:00", "updated_at": "2026-02-13T16:19:15.414983+00:00", "source": "session", "source_id": "374d0f63-0d52-42fc-8a32-93ff33b4f5e6"}
{"id": "mm-3f49caaa", "content": "BUG: pending_memory_review stop gate is unresettable via MCP set_variable. Root cause: workflow YAML set_variable action writes to workflow_states.variables, but MCP set_variable tool writes to session_variables table (because session_var_manager takes priority in _variables.py:124-126). The lifecycle evaluator (lifecycle_evaluator.py:621-623) only reads from workflow_states.variables, never session_variables. So the MCP call writes to the wrong store. Fix: merge session_variables into context_data in the lifecycle evaluator around line 618, so both stores are visible to when-clause evaluation.", "type": "bug", "tags": ["workflow-engine", "variables", "stop-gate", "lifecycle-evaluator"], "created_at": "2026-02-13T16:07:22.955286+00:00", "updated_at": "2026-02-13T16:07:22.955286+00:00", "source": "mcp_tool", "source_id": "7e03b832-0c09-47ec-9049-cf2eae396476"}
{"id": "mm-68a70718", "content": "Gobby daemon's embedding service can timeout during create_memory operations with ReadTimeout errors. The daemon itself remains stable (continues running) but the memory creation fails. Logs show 'Retrying request to _base_client.py:1621' when this occurs.", "type": "pattern", "tags": ["gobby", "daemon", "embedding", "timeout", "create_memory"], "created_at": "2026-02-13T15:40:43.089447+00:00", "updated_at": "2026-02-13T15:40:43.089447+00:00", "source": "session", "source_id": "16810f19-280c-4a8e-9663-ac826ae47c0c"}
{"id": "mm-31819a62", "content": "The Mem0 sync service extracted to services/mem0_sync.py contains 6 methods spanning lines 884-1043 in the original MemoryService: _index_in_mem0, _delete_from_mem0, _search_mem0, _initialize_mem0_client, _get_mem0_user_id, and _update_in_mem0. These methods handle all Mem0 cloud integration including indexing, searching, and deletion with user_id derivation from project_id.", "type": "fact", "tags": ["mem0", "refactoring", "services", "architecture"], "created_at": "2026-02-13T06:53:49.960973+00:00", "updated_at": "2026-02-13T06:53:49.960973+00:00", "source": "session", "source_id": "cc46f27d-e10f-48b8-968d-9c7f0151b21d"}
{"id": "mm-1798b512", "content": "The refactoring plan addressed 3 core issues: (1) `safe_eval_expr` lacks docstring and example usage, (2) MCP registry lacks caching causing repeated instantiation, (3) Tmux death monitor polls every second in tight loop without async context. Issue #2 was confirmed by grep showing `get_default_registry()` called in observer detection loop.", "type": "context", "tags": ["refactoring", "technical-debt", "performance"], "created_at": "2026-02-13T06:23:52.747487+00:00", "updated_at": "2026-02-13T06:23:52.747487+00:00", "source": "session", "source_id": "635bdff2-c358-4d37-8e85-d5e4b40096d3"}
{"id": "mm-ca738804", "content": "The MCP tool registry is recreated on every call to `get_default_registry()` instead of being cached. This causes repeated schema parsing and tool instantiation. The function is called per-event in `detect_mcp_call()` at workflows/observers.py:291, creating performance overhead for MCP tool detection.", "type": "fact", "tags": ["performance", "mcp", "registry", "caching"], "created_at": "2026-02-13T06:23:51.166424+00:00", "updated_at": "2026-02-13T06:23:51.166424+00:00", "source": "session", "source_id": "635bdff2-c358-4d37-8e85-d5e4b40096d3"}
{"id": "mm-3e04f4d2", "content": "MagicMock(spec=WorkflowDefinition) does NOT auto-expose Pydantic v2 model fields. When testing code that accesses fields like `.enabled`, `.sources`, etc., you must explicitly set them on the mock (e.g., `wf.enabled = True`). This is because Pydantic BaseModel fields aren't visible as class-level attributes to Mock's spec introspection.", "type": "insight", "tags": ["testing", "pydantic", "mock", "gotcha"], "created_at": "2026-02-13T06:17:48.823809+00:00", "updated_at": "2026-02-13T06:17:48.823809+00:00", "source": "mcp_tool", "source_id": "356ec93c-5282-45c2-8b07-92113ca70cce"}
{"id": "mm-19ab1d72", "content": "The Claude Agent SDK passes the model parameter directly to the Claude CLI as a string. The CLI handles model alias resolution internally, accepting short aliases like 'sonnet', 'opus', 'haiku', 'claude-sonnet-4-5', etc. Therefore resolve_model_id() and MODEL_ALIASES are unnecessary for SDK call sites — they only add a brittle hardcoded mapping that can break (as happened with the bad opus alias). resolve_model_id should only be used for the LiteLLM/direct API path which requires dated model IDs.", "type": "fact", "tags": ["llm", "claude", "agent-sdk", "model-aliases", "architecture"], "created_at": "2026-02-13T06:17:08.100290+00:00", "updated_at": "2026-02-13T06:17:08.100290+00:00", "source": "mcp_tool", "source_id": "d6be5675-2f57-4fad-b648-2af56b05d0bf"}
{"id": "mm-a18d3112", "content": "MODEL_ALIASES in claude_models.py must only contain confirmed dated model IDs. Adding speculative IDs (like claude-opus-4-6-20250826) causes resolve_model_id to return a non-existent model, breaking all downstream API calls including task validation. The Claude CLI accepts short aliases directly, so unresolved aliases pass through safely.", "type": "fact", "tags": ["llm", "claude", "validation", "model-aliases"], "created_at": "2026-02-13T06:12:08.096952+00:00", "updated_at": "2026-02-13T06:12:08.096952+00:00", "source": "mcp_tool", "source_id": "d6be5675-2f57-4fad-b648-2af56b05d0bf"}
{"id": "mm-c5167824", "content": "gobby's workflow loading has three separate code paths that all instantiate WorkflowDefinition: line 482 (removes 'file'), line 475-484 (converts spec to dict), and line 1095+ (sets name). These paths don't share a common factory, creating maintenance risk if WorkflowDefinition schema changes.", "type": "pattern", "tags": ["gobby", "code-duplication", "architecture-smell"], "created_at": "2026-02-13T06:01:48.322398+00:00", "updated_at": "2026-02-13T06:01:48.322398+00:00", "source": "session", "source_id": "0fc6dd1c-01aa-4476-8e88-04866e613244"}
{"id": "mm-faad21be", "content": "WorkflowDefinition in gobby has an optional `enabled` field (defaults to true). When loading workflows from YAML specs, the `file` field must be removed before instantiating WorkflowDefinition, and `name` must be explicitly set in the data dict (handle both missing and None cases) at lines 1095-1097.", "type": "fact", "tags": ["gobby", "workflow", "pydantic", "yaml-loading"], "created_at": "2026-02-13T06:01:46.975160+00:00", "updated_at": "2026-02-13T06:01:46.975160+00:00", "source": "session", "source_id": "0fc6dd1c-01aa-4476-8e88-04866e613244"}
{"id": "mm-be9272af", "content": "gobby project uses hook_dispatcher.py at .claude/hooks/hook_dispatcher.py that can fail during tool execution. When PreToolUse or other hooks error, they may block tool schema fetching. This is a known limitation of the hook system, not a tool bug.", "type": "fact", "tags": ["gobby", "hooks", "debugging", "error-handling"], "created_at": "2026-02-13T06:01:00.137997+00:00", "updated_at": "2026-02-13T06:01:00.137997+00:00", "source": "session", "source_id": "8264345e-68a1-4f70-bbea-e4d703df9389"}
{"id": "mm-fe7a739d", "content": "gobby-memory server provides create_memory and set_variable tools. Use create_memory for persistent cross-session memories with auto-deduplication against similar existing memories. The server requires progressive disclosure like other gobby servers.", "type": "fact", "tags": ["gobby", "memory-system", "persistent-state"], "created_at": "2026-02-13T06:00:59.326500+00:00", "updated_at": "2026-02-13T06:00:59.326500+00:00", "source": "session", "source_id": "8264345e-68a1-4f70-bbea-e4d703df9389"}
{"id": "mm-7b7cbad9", "content": "gobby MCP server uses progressive disclosure for tool discovery: list_mcp_servers() → list_tools(server_name) → get_tool_schema(server_name, tool_name) → call_tool(). Each step must complete before the next is available. Schema fetches are cached per session, so don't refetch when calling the same tool multiple times.", "type": "fact", "tags": ["gobby", "mcp", "tool-discovery", "api-pattern"], "created_at": "2026-02-13T06:00:57.678590+00:00", "updated_at": "2026-02-13T06:00:57.678590+00:00", "source": "session", "source_id": "8264345e-68a1-4f70-bbea-e4d703df9389"}
{"id": "mm-4db864cd", "content": "Stderr capture in Claude.py subprocess calls is not working - exit code 1 occurs with no stderr output, making it difficult to debug CLI failures. The CLAUDECODE env var approach for capturing errors may not be functioning as expected.", "type": "pattern", "tags": ["debugging", "subprocess", "stderr-capture", "claude.py"], "created_at": "2026-02-13T05:25:34.178123+00:00", "updated_at": "2026-02-13T05:25:34.178123+00:00", "source": "session", "source_id": "4d883b3e-7a55-4c18-b8c9-a3b6863a74e6"}
{"id": "mm-f43c12bb", "content": "LLMService initializes with empty providers list when daemon starts, indicating configuration may not be loading LLM providers correctly at startup. The issue stems from config.llm_providers.get_enabled_providers() returning an empty list despite having configured providers.", "type": "fact", "tags": ["llm-service", "initialization", "bug", "providers-config"], "created_at": "2026-02-13T05:25:33.899034+00:00", "updated_at": "2026-02-13T05:25:33.899034+00:00", "source": "session", "source_id": "4d883b3e-7a55-4c18-b8c9-a3b6863a74e6"}
{"id": "mm-e4d91d1f", "content": "Git revert workflow for reverting specific file changes: Use `git show <commit>:<filepath>` to verify file existence in a commit, then `git checkout <commit> -- <filepath>` to revert individual files to previous versions. The `git revert` command operates on commits, not individual files.", "type": "pattern", "tags": ["git", "workflow", "revert"], "created_at": "2026-02-13T03:39:56.698029+00:00", "updated_at": "2026-02-13T03:39:56.698029+00:00", "source": "session", "source_id": "fcdd9c52-29ef-4137-990f-9574912321a5"}
{"id": "mm-60ba6bec", "content": "KnowledgeGraph.tsx file path issue: The file `web/src/components/KnowledgeGraph.tsx` was referenced in a git revert operation but git couldn't find it by that path. When reverting to a previous commit (13d944ef), the file exists in that commit. This suggests the file may have been moved, deleted, or the path structure changed between commits.", "type": "fact", "tags": ["git", "file-path", "debugging", "KnowledgeGraph"], "created_at": "2026-02-13T03:39:40.185450+00:00", "updated_at": "2026-02-13T03:39:40.185450+00:00", "source": "session", "source_id": "fcdd9c52-29ef-4137-990f-9574912321a5"}
{"id": "mm-1fdaf161", "content": "Lifecycle YAML files are large multi-state workflow definitions. The test file created (test_lifecycle_yaml_migration.py) validates the migration of these specs. Key workflow files to modify: headless-lifecycle.yaml and session-lifecycle.yaml in src/gobby/install/shared/workflows/lifecycle/.", "type": "fact", "tags": ["lifecycle-yaml", "test-structure", "file-locations"], "created_at": "2026-02-13T02:53:27.343841+00:00", "updated_at": "2026-02-13T02:53:27.343841+00:00", "source": "session", "source_id": "4d883b3e-7a55-4c18-b8c9-a3b6863a74e6"}
{"id": "mm-15a3a5a6", "content": "Task #8092 involves migrating lifecycle YAML files (session-lifecycle.yaml and headless-lifecycle.yaml in src/gobby/install/shared/workflows/lifecycle/) to add `enabled`, `priority`, and `tags` fields to workflow definitions. The WorkflowDefinition model in the codebase already has these fields defined, so the migration is adding them to the YAML specs.", "type": "context", "tags": ["task-8092", "lifecycle-yaml", "workflow-migration"], "created_at": "2026-02-13T02:53:04.064651+00:00", "updated_at": "2026-02-13T02:53:04.064651+00:00", "source": "session", "source_id": "4d883b3e-7a55-4c18-b8c9-a3b6863a74e6"}
{"id": "mm-edc4147c", "content": "Plan file location: ~/.claude/plans/merry-crafting-widget.md contains detailed implementation spec for the new widget, including visual component breakdown modeled after TasksPage and MemoryPage patterns.", "type": "context", "tags": ["merry-crafting-widget", "planning", "file-location"], "created_at": "2026-02-13T02:29:29.947857+00:00", "updated_at": "2026-02-13T02:29:29.947857+00:00", "source": "session", "source_id": "7800b210-9ada-4c96-be2c-a4ab56dfadfc"}
{"id": "mm-843b4d8c", "content": "Plan file location: ~/.claude/plans/merry-crafting-widget.md contains detailed implementation spec for the new widget, including visual component breakdown modeled after TasksPage and MemoryPage patterns.", "type": "context", "tags": ["merry-crafting-widget", "planning", "file-location"], "created_at": "2026-02-13T02:28:39.341918+00:00", "updated_at": "2026-02-13T02:28:39.341918+00:00", "source": "session", "source_id": "7800b210-9ada-4c96-be2c-a4ab56dfadfc"}
{"id": "mm-f3cdc433", "content": "TasksPage and MemoryPage use consistent layout patterns: .tasks-toolbar/.memory-overview use flex with gap:12px and padding:20px/12px respectively; .task-overview/.memory-overview both use flex gap:12px; modals use .memory-detail-backdrop with position:fixed inset:0. Reference these CSS patterns when building merry-crafting-widget to maintain UI consistency.", "type": "pattern", "tags": ["UI", "CSS", "layout", "merry-crafting-widget", "TasksPage", "MemoryPage"], "created_at": "2026-02-13T02:28:38.720032+00:00", "updated_at": "2026-02-13T02:28:38.720032+00:00", "source": "session", "source_id": "7800b210-9ada-4c96-be2c-a4ab56dfadfc"}
{"id": "mm-0169e2a0", "content": "Workflow filtering by source can inject context at system_start specifically for Claude Code (e.g., 'Each step (list_mcp_server_status, etc.) must...'). This allows source-specific instruction injection without affecting other interfaces.", "type": "pattern", "tags": ["workflows", "source-filtering", "system-prompts", "claude-code"], "created_at": "2026-02-13T02:10:56.961589+00:00", "updated_at": "2026-02-13T02:10:56.961589+00:00", "source": "session", "source_id": "7cec244a-9ea7-4bad-947e-9ff9e11b8040"}
{"id": "mm-680a7e0b", "content": "Claude Code doesn't return tool_result in post-tool-use hooks (unlike other interfaces). This is a source integration difference that affects hook logic—workflows should account for this platform-specific behavior.", "type": "fact", "tags": ["claude-code", "hooks", "tool-results", "platform-differences"], "created_at": "2026-02-13T02:10:39.977059+00:00", "updated_at": "2026-02-13T02:10:39.977059+00:00", "source": "session", "source_id": "7cec244a-9ea7-4bad-947e-9ff9e11b8040"}
{"id": "mm-e5e63b9f", "content": "Progressive disclosure pattern in system prompts only needs to be followed once per tool, not repeatedly. The gobby system already implements this correctly—agents don't need to re-disclose tool capabilities on each invocation.", "type": "pattern", "tags": ["system-prompts", "progressive-disclosure", "agent-behavior"], "created_at": "2026-02-13T02:10:28.862315+00:00", "updated_at": "2026-02-13T02:10:28.862315+00:00", "source": "session", "source_id": "7cec244a-9ea7-4bad-947e-9ff9e11b8040"}
{"id": "mm-5123254a", "content": "The engine.py handle_event method contains multiple inline evaluation blocks that need systematic removal during refactoring: inline rules checking (around lines 359-373) and inline transition loop (starting around line 422). Both should be delegated to unified_evaluator methods after extraction.", "type": "fact", "tags": ["engine_py", "refactoring_targets", "code_locations"], "created_at": "2026-02-13T02:09:03.527755+00:00", "updated_at": "2026-02-13T02:09:03.527755+00:00", "source": "session", "source_id": "4d883b3e-7a55-4c18-b8c9-a3b6863a74e6"}
{"id": "mm-3869daad", "content": "Workflow refactoring in engine.py involves extracting inline evaluation logic into unified_evaluator.py. The pattern: (1) Add evaluation methods to unified_evaluator (evaluate_triggers, evaluate_rules, evaluate_transitions), (2) Import and delegate from engine.py's handle_event, (3) Remove inline checking blocks (rules check at lines 359-373, transition loop at lines 422+). This centralizes workflow evaluation logic.", "type": "pattern", "tags": ["workflow_engine", "refactoring", "unified_evaluator", "code_structure"], "created_at": "2026-02-13T02:09:03.019272+00:00", "updated_at": "2026-02-13T02:09:03.019272+00:00", "source": "session", "source_id": "4d883b3e-7a55-4c18-b8c9-a3b6863a74e6"}
{"id": "mm-5924fb18", "content": "TaskValidationConfig has a stale model default that causes validation errors. The fix is a one-line change to update the default model reference in TaskValidationConfig (commit b4d4ff3f). This affects task validation across the system.", "type": "fact", "tags": ["bug_fix", "TaskValidationConfig", "model_default", "validation"], "created_at": "2026-02-13T02:00:44.147521+00:00", "updated_at": "2026-02-13T02:00:44.147521+00:00", "source": "session", "source_id": "488b960d-bc09-455f-9245-29591d5d58ec"}
{"id": "mm-102eb252", "content": "LLM generate_text() returns error STRINGS instead of raising exceptions (e.g., 'Generation failed: {e}'). Downstream code like validation can't distinguish 'bad LLM output' from 'LLM call failed entirely'. When debugging 'Could not parse response' from extract_json_object(), always check if the input is an error string rather than actual LLM output. The real error is logged at ERROR level in claude.py but swallowed before reaching the caller.", "type": "debugging", "tags": ["llm", "debugging", "error-handling", "validation"], "created_at": "2026-02-13T01:58:43.978512+00:00", "updated_at": "2026-02-13T01:58:43.978512+00:00", "source": "mcp_tool", "source_id": "488b960d-bc09-455f-9245-29591d5d58ec"}
{"id": "mm-5623a651", "content": "To save persistent memories/notes across sessions, use create_memory on gobby-memory MCP server. Do NOT manually edit ~/.claude/projects/.../memory/MEMORY.md. The gobby-memory system manages memories in its database; MEMORY.md is exported/synced from there.", "type": "pattern", "tags": ["gobby", "memory", "workflow"], "created_at": "2026-02-13T01:56:03.864347+00:00", "updated_at": "2026-02-13T01:56:03.864347+00:00", "source": "mcp_tool", "source_id": "7cec244a-9ea7-4bad-947e-9ff9e11b8040"}
{"id": "mm-503c8618", "content": "Gobby MCP Progressive Disclosure: The flow is STRICT and hook-enforced: list_mcp_servers() → list_tools(server) → get_tool_schema(server, tool) → call_tool(server, tool, args). Each step gates the next. The proxy tools (list_mcp_servers, list_tools, get_tool_schema, call_tool) are top-level deferred tools (e.g. mcp__gobby__get_tool_schema) — must load via ToolSearch before first use. They do NOT exist on sub-servers like gobby-tasks. Never skip list_tools — the hook will block get_tool_schema if you haven't called it for that server.", "type": "pattern", "tags": ["mcp", "progressive-disclosure", "gobby", "workflow"], "created_at": "2026-02-13T01:55:24.298317+00:00", "updated_at": "2026-02-13T01:55:24.298317+00:00", "source": "mcp_tool", "source_id": "7cec244a-9ea7-4bad-947e-9ff9e11b8040"}
{"id": "mm-72d641e4", "content": "The `if session_id:` branch in get_skill() MCP handler was already covered by existing tests, so adding new test coverage for session_id parameter won't improve overall test coverage metrics.", "type": "pattern", "tags": ["testing", "test_coverage", "get_skill"], "created_at": "2026-02-13T01:43:41.629182+00:00", "updated_at": "2026-02-13T01:43:41.629182+00:00", "source": "session", "source_id": "5bb31c58-6ddd-4e02-b6ea-25ee2ea3621a"}
{"id": "mm-08069b84", "content": "session_manager.resolve_session_reference() can accept session_id as a parameter and resolve it like a ref. This allows flexible session lookup by either ID or reference format.", "type": "fact", "tags": ["session_manager", "API_gotcha", "session_lookup"], "created_at": "2026-02-13T01:43:33.130790+00:00", "updated_at": "2026-02-13T01:43:33.130790+00:00", "source": "session", "source_id": "5bb31c58-6ddd-4e02-b6ea-25ee2ea3621a"}
{"id": "mm-7e300307", "content": "Architecture preference: Session-level tracking (like record_skills_used) should NOT be added to MCP tool handlers. MCP tools should stay focused on their domain. Session tracking belongs in the hook/workflow layer (inject_context, observers, AFTER_TOOL hooks) which already has session context naturally. The user questioned adding session_id to get_skill() MCP handler — keep MCP tools clean of session concerns.", "type": "insight", "tags": ["architecture", "mcp", "skills", "session-tracking"], "created_at": "2026-02-13T01:37:00.756135+00:00", "updated_at": "2026-02-13T01:37:00.756135+00:00", "source": "mcp_tool", "source_id": "5bb31c58-6ddd-4e02-b6ea-25ee2ea3621a"}
{"id": "mm-d62a4423", "content": "User decision: For config tools architecture, chose 'New gobby-config server' approach over ad-hoc additions to existing patterns. This architectural direction was documented in jazzy-stargazing-map.md plan file.", "type": "preference", "tags": ["config", "architecture-decision", "gobby-config"], "created_at": "2026-02-13T01:22:43.063444+00:00", "updated_at": "2026-02-13T01:22:43.063444+00:00", "source": "session", "source_id": "a5e24b58-a6c5-4da0-b65b-b05ff10f1c38"}
{"id": "mm-9b8abaf9", "content": "Gobby config system uses ConfigStore (typed as Any | None) in SkillsRegistry. Config loading happens in two phases: Phase 1 loads from file/CLI, Phase 2 reloads from DB (secrets > env vars). The load_config() function is in the config module and handles file path, CLI overrides, and database reload logic.", "type": "context", "tags": ["config", "architecture", "SkillsRegistry"], "created_at": "2026-02-13T01:22:21.981464+00:00", "updated_at": "2026-02-13T01:22:21.981464+00:00", "source": "session", "source_id": "a5e24b58-a6c5-4da0-b65b-b05ff10f1c38"}
{"id": "mm-b3f85f4e", "content": "Bandit config consistency: pyproject.toml [tool.bandit] skips are only applied when -c pyproject.toml is passed. The pre-commit hook and CI both pass it correctly, but the local pre-push-test.sh scripts did not — causing false failures. Always check all invocation sites when adding bandit skips.", "type": "insight", "tags": ["bandit", "ci", "pre-push", "config"], "created_at": "2026-02-13T01:09:45.729082+00:00", "updated_at": "2026-02-13T01:09:45.729082+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-502d11c3", "content": "BASELINE_SCHEMA must be kept in sync with BASELINE_VERSION. When bumping BASELINE_VERSION, audit ALL migrations between the old and new version for: (1) ALTER TABLE ADD COLUMN statements — add columns to the baseline table definition, (2) CREATE TABLE statements — add new tables to baseline, (3) INSERT statements for seed data — add to baseline. The migration guard for existing databases should check against _MIN_MIGRATION_VERSION (the first migration in the MIGRATIONS list, currently 76), NOT BASELINE_VERSION. These serve different purposes: BASELINE_VERSION controls fresh DB schema, _MIN_MIGRATION_VERSION controls the upgrade cutoff for existing DBs.", "type": "insight", "tags": ["migrations", "baseline", "schema", "debugging"], "created_at": "2026-02-13T00:57:14.876440+00:00", "updated_at": "2026-02-13T00:57:14.876440+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-64cd33cb", "content": "test_runner.py isinstance check gotcha: isinstance(mock_instance, MockedClass) fails with 'TypeError: isinstance() arg 2 must be a type' because patch() replaces the class with a MagicMock (not a real type). When runner.py added isinstance(self.database, LocalDatabase), all test_runner tests broke. Fix: removed the isinstance check (redundant since _init_database always returns LocalDatabase) and added SecretStore/ConfigStore patches to create_base_patches.", "type": "debugging", "tags": ["testing", "mocking", "isinstance", "runner"], "created_at": "2026-02-13T00:38:47.336129+00:00", "updated_at": "2026-02-13T00:38:47.336129+00:00", "source": "mcp_tool", "source_id": "3459526d-63d7-414f-9a94-66cf359ad6a9"}
{"id": "mm-47d4c0a8", "content": "E2E test env leak: protect_production_resources sets GOBBY_TEST_PROTECT=1 in the test process env. When e2e conftest spawns daemon subprocesses via os.environ.copy(), this flag leaks into the subprocess. The daemon's load_config safety switch then fires but GOBBY_DATABASE_PATH was already popped, causing inconsistent state. Fix: pop GOBBY_TEST_PROTECT and GOBBY_CONFIG_FILE from daemon subprocess env alongside GOBBY_DATABASE_PATH.", "type": "debugging", "tags": ["e2e-tests", "env-vars", "conftest", "root-cause"], "created_at": "2026-02-13T00:38:23.915080+00:00", "updated_at": "2026-02-13T00:38:23.915080+00:00", "source": "mcp_tool", "source_id": "3459526d-63d7-414f-9a94-66cf359ad6a9"}
{"id": "mm-34bd910d", "content": "runner.py Phase 2 config reload bug: The second load_config() call (with config_store) didn't pass config_file, so when the DB config_store was empty (fresh installs, e2e tests), DaemonConfig(**{}) returned all defaults (daemon_port=60887, default DB path). Fix: pass self._config_file to both load_config calls, and in load_config fall back to YAML when config_store is empty.", "type": "debugging", "tags": ["runner", "config", "e2e-tests", "root-cause"], "created_at": "2026-02-13T00:37:53.196815+00:00", "updated_at": "2026-02-13T00:37:53.196815+00:00", "source": "mcp_tool", "source_id": "3459526d-63d7-414f-9a94-66cf359ad6a9"}
{"id": "mm-19ea3692", "content": "Bug in memory_review_gate: The MCP set_variable tool's value param is typed as string, so setting value.", "type": "fact", "tags": ["bug", "mcp", "call_tool", "workaround"], "created_at": "2026-02-13T00:25:47.310070+00:00", "updated_at": "2026-02-13T00:25:47.310070+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-ec42538a", "content": "Antigravity (VS Code fork) terminal sidebar shows 'tmux' for all terminals by default because `terminal.integrated.tabs.title` defaults to `${process}`. To display tmux window names (set via `set-titles` + `set-titles-string`), change the setting to `${sequence}`. The setting is in `~/Library/Application Support/Antigravity/User/settings.json`. The `set-titles-string` format controls what tmux emits via OSC — consider using just `#W` (window name) for clean sidebar labels instead of the verbose default `#S:#I:#W - \"#T\" #{session_alerts}`.", "type": "insight", "tags": ["antigravity", "vscode", "tmux", "terminal", "configuration"], "created_at": "2026-02-13T00:25:47.299016+00:00", "updated_at": "2026-02-13T00:25:47.299016+00:00", "source": "mcp_tool", "source_id": "2c404415-4523-4d88-b820-0802a8dfaedb"}
{"id": "mm-8cd3d655", "content": "Gobby's bind_host configuration is currently manual—no automatic Tailscale detection exists. The bind_host setting is in src/gobby/config/app.py (default port 60887). When Tailscale is properly configured, users must manually set bind_host to 0.0.0.0 to serve across the network; otherwise it defaults to localhost.", "type": "fact", "tags": ["configuration", "tailscale", "networking", "bind_host"], "created_at": "2026-02-12T22:02:45.034992+00:00", "updated_at": "2026-02-12T22:02:45.034992+00:00", "source": "session", "source_id": "432c9580-9d9f-46ca-9c22-ad02bfc2d171"}
{"id": "mm-58c57291", "content": "Gobby has a bind_host configuration (defaults to localhost) that can be set to 0.0.0.0 for Tailscale remote access. Currently, detection/automation of Tailscale presence is NOT implemented—it's purely manual configuration via bind_host setting in src/gobby/config/app.py.", "type": "fact", "tags": ["tailscale", "network-config", "bind_host", "feature-gap"], "created_at": "2026-02-12T21:14:02.310825+00:00", "updated_at": "2026-02-12T21:14:02.310825+00:00", "source": "session", "source_id": "432c9580-9d9f-46ca-9c22-ad02bfc2d171"}
{"id": "mm-b411f6ab", "content": "Gobby UI dev server auto-start: GobbyRunner.run() now spawns Vite via spawn_ui_server when ui.enabled=true and ui.mode=dev, and stops it on shutdown. Port lineup: 60887 (HTTP daemon), 60888 (WebSocket), 60889 (Vite dev). Config default is UIConfig.port=60889. The spawn/stop helpers live in gobby.cli.utils (spawn_ui_server, stop_ui_server, find_web_dir).", "type": "fact", "tags": ["web-ui", "architecture", "ports"], "created_at": "2026-02-12T21:08:14.538094+00:00", "updated_at": "2026-02-12T21:08:14.538094+00:00", "source": "mcp_tool", "source_id": "432c9580-9d9f-46ca-9c22-ad02bfc2d171"}
{"id": "mm-94fa07d5", "content": "NEVER add startup code that kills other processes on ports. _clear_port() using lsof + SIGTERM was added to GobbyRunner.run() to handle orphaned test daemons, but it caused e2e tests to kill the production daemon. The correct approach to port isolation is preventing collisions at allocation time (find_free_port without SO_REUSEADDR + excluded ports), not killing processes at startup.", "type": "fact", "tags": ["architecture-decision", "anti-pattern", "port-isolation", "runner"], "created_at": "2026-02-12T21:00:05.722499+00:00", "updated_at": "2026-02-12T21:00:05.722499+00:00", "source": "mcp_tool", "source_id": "432c9580-9d9f-46ca-9c22-ad02bfc2d171"}
{"id": "mm-ee1a9610", "content": "SO_REUSEADDR port collision root cause: When find_free_port() uses SO_REUSEADDR, the OS can assign a port (e.g. 60887) to localhost even if production daemon is bound on 0.0.0.0:60887 — they're treated as non-conflicting addresses. The verification bind also passes with SO_REUSEADDR. Fix: remove SO_REUSEADDR from both sockets and add a 0.0.0.0 verification bind. Also exclude known gobby ports (60887/60888) as defense-in-depth. File: tests/e2e/conftest.py:find_free_port().", "type": "fact", "tags": ["debugging", "e2e-tests", "port-isolation", "networking"], "created_at": "2026-02-12T20:20:49.727285+00:00", "updated_at": "2026-02-12T20:20:49.727285+00:00", "source": "mcp_tool", "source_id": "432c9580-9d9f-46ca-9c22-ad02bfc2d171"}
{"id": "mm-fa438a26", "content": "Gobby has a find_free_port() function that needs investigation/fixing - identified during session analysis as part of a 4-task improvement plan (fix find_free_port, verify port binding logic, update config handling, add integration tests).", "type": "context", "tags": ["gobby", "port-management", "bug", "planned-work"], "created_at": "2026-02-12T20:14:46.878501+00:00", "updated_at": "2026-02-12T20:14:46.878501+00:00", "source": "session", "source_id": "aed5d772-3baa-4249-b0f2-cd721b653301"}
{"id": "mm-f87ed79f", "content": "Gobby daemon default bind_host is 'localhost' (not '0.0.0.0'), configured in src/gobby/config/app.py line 221-222 with default port 60887. This restricts daemon to local connections only unless explicitly changed.", "type": "fact", "tags": ["gobby", "daemon", "configuration", "networking"], "created_at": "2026-02-12T20:14:33.830536+00:00", "updated_at": "2026-02-12T20:14:33.830536+00:00", "source": "session", "source_id": "aed5d772-3baa-4249-b0f2-cd721b653301"}
{"id": "mm-51f265f6", "content": "The gobby expansion workflow stores expansion_context in task metadata and the get_expansion_spec tool tracks pending status. After execute_expansion completes, the spec's pending flag becomes false and all dependencies are wired - attempting to wire them again will trigger UNIQUE constraint violations, which is expected behavior indicating successful idempotent completion.", "type": "fact", "tags": ["gobby", "expansion-workflow", "state-management", "database-schema"], "created_at": "2026-02-12T19:56:33.248968+00:00", "updated_at": "2026-02-12T19:56:33.248968+00:00", "source": "session", "source_id": "d0446fa0-f37c-4bad-b269-1bd5ed7d73a1"}
{"id": "mm-9725cf67", "content": "The gobby project has a hook_dispatcher system at .claude/hooks/hook_dispatcher.py that validates tool calls. PreToolUse hooks can fail with constraint violations (e.g., UNIQUE constraint on task_dependencies) - these failures are recoverable and don't indicate actual API errors, just that operations already succeeded in previous attempts.", "type": "pattern", "tags": ["gobby", "hook-system", "error-handling", "idempotency"], "created_at": "2026-02-12T19:56:16.389478+00:00", "updated_at": "2026-02-12T19:56:16.389478+00:00", "source": "session", "source_id": "d0446fa0-f37c-4bad-b269-1bd5ed7d73a1"}
{"id": "mm-10f41d2a", "content": "Auto-Task Workflow: Activate with session_task variable (not assigned_task_id): activate_workflow(name='auto-task', variables={session_task: '#1234'}). Meeseeks agent pattern is deprecated and no longer in use. The call_tool MCP proxy uses `arguments` parameter (not `args`).", "type": "pattern", "tags": ["workflows", "auto-task", "mcp"], "created_at": "2026-02-12T19:39:41.876752+00:00", "updated_at": "2026-02-12T19:39:41.876752+00:00", "source": "mcp_tool", "source_id": "4552a4b4-25cd-4850-b649-29cff6320a00"}
{"id": "mm-5e9fc5fa", "content": "SafeExpressionEvaluator.evaluate() in src/gobby/workflows/lifecycle_evaluator.py explicitly wraps results in bool() (line ~81: return bool(self.visit(tree.body))). Test assertions should use `is True`/`is False`, not `== \"\"`/`== \"abc\"`. CodeRabbit incorrectly flagged these assertions — they are correct as-is.", "type": "pattern", "tags": ["workflows", "evaluator", "testing"], "created_at": "2026-02-12T19:39:17.121415+00:00", "updated_at": "2026-02-12T19:39:17.121415+00:00", "source": "mcp_tool", "source_id": "4552a4b4-25cd-4850-b649-29cff6320a00"}
{"id": "mm-06218e98", "content": "Config Resolution (DB-First, Two-Phase): Config is DB-first via config_store table (migration 98). YAML is import/export only. Phase 1 (runner.py:61): load_config() from yaml bootstraps database_path only. Phase 2 (runner.py:~95): After DB init, _maybe_import_yaml_to_db() one-time migrates yaml to DB, then load_config(config_store=...) loads from DB. Resolution: DB config_store > Pydantic defaults. $secret: and ${VAR} patterns resolved at load time via _resolve_config_values(). One-time import tracked by _meta.yaml_imported key. ConfigStore at src/gobby/storage/config_store.py with flatten_config()/unflatten_config(). deep_merge() in config/app.py. REST: /api/config/template replaced /api/config/yaml; export uses config_store field. LiteLLMProvider unconditionally sets env vars from config.", "type": "pattern", "tags": ["config", "database", "architecture"], "created_at": "2026-02-12T19:37:13.391012+00:00", "updated_at": "2026-02-12T19:37:13.391012+00:00", "source": "mcp_tool", "source_id": "4552a4b4-25cd-4850-b649-29cff6320a00"}
{"id": "mm-134fa8ab", "content": "Skill Routing (/gobby commands): Claude Code's Skill tool only knows native skills (.claude/commands/). Gobby skills are routed via hook interception in _agent.py, NOT via the Skill tool. /gobby expand routing: _intercept_skill_command() in src/gobby/hooks/event_handlers/_agent.py matches /gobby commands and injects <skill-context> blocks via hooks. Supports both `/gobby:expand` (colon) and `/gobby expand` (space) syntax.", "type": "pattern", "tags": ["skills", "routing", "hooks", "commands"], "created_at": "2026-02-12T19:35:33.231396+00:00", "updated_at": "2026-02-12T19:35:33.231396+00:00", "source": "mcp_tool", "source_id": "4552a4b4-25cd-4850-b649-29cff6320a00"}
{"id": "mm-d3ef80b8", "content": "Skill Injection Architecture: SkillInjector in src/gobby/skills/injector.py handles context-aware skill selection. AgentContext.from_session() derives agent_type from depth + workflow name. Skills have metadata.gobby in SKILL.md frontmatter with audience/depth/format_overrides. `filter: context_aware` in lifecycle YAMLs routes through SkillInjector. SkillProfile allows per-agent include/exclude/format overrides via _skill_profile variable. Workflow state is one per session (shared by lifecycle + step workflows). ParsedSkill.always_apply field (not is_always_apply() method) used for legacy fallback.", "type": "pattern", "tags": ["skills", "injection", "architecture", "workflows"], "created_at": "2026-02-12T19:35:00.893970+00:00", "updated_at": "2026-02-12T19:35:00.893970+00:00", "source": "mcp_tool", "source_id": "4552a4b4-25cd-4850-b649-29cff6320a00"}
{"id": "mm-aa0e0be3", "content": "Session Matching for Spawned Agents: Spawned agents find their pre-created sessions via GOBBY_SESSION_ID env var. Flow: 1) Parent pre-creates child session with known ID. 2) Env vars set during terminal spawn include GOBBY_SESSION_ID. 3) Hook dispatcher captures env vars in terminal_context. 4) Daemon matches session via gobby_session_id in terminal_context.", "type": "pattern", "tags": ["sessions", "agents", "spawning", "env-vars"], "created_at": "2026-02-12T19:34:37.124150+00:00", "updated_at": "2026-02-12T19:34:37.124150+00:00", "source": "mcp_tool", "source_id": "4552a4b4-25cd-4850-b649-29cff6320a00"}
{"id": "mm-9948faed", "content": "Terminal Spawning (macOS): The Ghostty spawner on macOS injects env vars via shell exports because macOS `open` command doesn't pass env vars to launched apps. In macos.py GhosttySpawner.spawn(), if env vars are provided, they're converted to shell exports and prepended to the command: `exports = \" \".join(f\"export {k}={v};\" for k, v in env.items())` then `shell_cmd = f\"{exports} exec {shlex.join(command)}\"` with `ghostty_args.extend([\"-e\", \"sh\", \"-c\", shell_cmd])`.", "type": "pattern", "tags": ["terminal", "macos", "ghostty", "spawner"], "created_at": "2026-02-12T19:34:14.417744+00:00", "updated_at": "2026-02-12T19:34:14.417744+00:00", "source": "mcp_tool", "source_id": "4552a4b4-25cd-4850-b649-29cff6320a00"}
{"id": "mm-53aa67dc", "content": "CRITICAL: Use `uv run gobby` instead of `gobby` for development! The system-wide `gobby` CLI (`~/.local/bin/gobby`) uses a global uv tools install that may be outdated. Always use `uv run gobby start` to run the daemon from the local development environment. Commands: `uv run gobby start` (start daemon), `uv run gobby stop` (stop), `uv run gobby restart` (restart).", "type": "pattern", "tags": ["development", "environment", "cli"], "created_at": "2026-02-12T19:33:43.658840+00:00", "updated_at": "2026-02-12T19:33:43.658840+00:00", "source": "mcp_tool", "source_id": "4552a4b4-25cd-4850-b649-29cff6320a00"}
{"id": "mm-7bbe1f5e", "content": "Skill YAML parsing correctly handles `alwaysApply: true` field and converts it to the `always_apply` boolean property in ParsedSkill. The parsing logic in allowed_tools handling (around line 270) properly routes this through the skill injector.", "type": "pattern", "tags": ["yaml-parsing", "skill-config"], "created_at": "2026-02-12T19:25:42.948218+00:00", "updated_at": "2026-02-12T19:25:42.948218+00:00", "source": "session", "source_id": "60cfb08d-8b7d-4c3b-8d91-b24dae2cbabd"}
{"id": "mm-6001a855", "content": "ParsedSkill uses `.always_apply` field (not `is_always_apply()` method) for legacy fallback when determining if a skill should always be applied. This is the correct property to check in skill routing logic.", "type": "fact", "tags": ["skill-routing", "parsing", "legacy-behavior"], "created_at": "2026-02-12T19:25:27.311708+00:00", "updated_at": "2026-02-12T19:25:27.311708+00:00", "source": "session", "source_id": "60cfb08d-8b7d-4c3b-8d91-b24dae2cbabd"}
{"id": "mm-c2fff3b1", "content": "Daemon restart required after skill code changes to reload skill definitions. Use 'uv run gobby restart' to pick up newly added or modified skills (session discovered 32 skills loaded after restart).", "type": "pattern", "tags": ["development-workflow", "daemon", "skills"], "created_at": "2026-02-12T19:19:28.573782+00:00", "updated_at": "2026-02-12T19:19:28.573782+00:00", "source": "session", "source_id": "60cfb08d-8b7d-4c3b-8d91-b24dae2cbabd"}
{"id": "mm-c3385832", "content": "ParsedSkill.always_apply field (not is_always_apply() method) is used for legacy fallback when checking if skills should always be applied. This is the actual field used in skill routing logic, not the method.", "type": "fact", "tags": ["skill-routing", "skills", "legacy-behavior"], "created_at": "2026-02-12T19:19:19.897227+00:00", "updated_at": "2026-02-12T19:19:19.897227+00:00", "source": "session", "source_id": "60cfb08d-8b7d-4c3b-8d91-b24dae2cbabd"}
{"id": "mm-d6692a3e", "content": "Antigravity (VS Code fork) terminal sidebar shows 'tmux' for all terminals by default because `terminal.integrated.tabs.title` defaults to `${process}`. To display tmux window names (set via `set-titles` + `set-titles-string`), change the setting to `${sequence}`. The setting is in `~/Library/Application Support/Antigravity/User/settings.json`. The `set-titles-string` format controls what tmux emits via OSC — consider using just `#W` (window name) for clean sidebar labels instead of the verbose default `#S:#I:#W - \"#T\" #{session_alerts}`.", "type": "insight", "tags": ["antigravity", "vscode", "tmux", "terminal", "configuration"], "created_at": "2026-02-12T19:10:17.862084+00:00", "updated_at": "2026-02-12T19:10:17.862084+00:00", "source": "mcp_tool", "source_id": "2c404415-4523-4d88-b820-0802a8dfaedb"}
{"id": "mm-16402158", "content": "Hook dispatcher errors occur when closing tasks via mcp__gobby__call_tool if changes haven't been committed first. Always run `git commit` before calling close_task to avoid 'PreToolUse:mcp__gobby__call_tool hook error' failures.", "type": "pattern", "tags": ["gobby-hooks", "task-management", "error-handling"], "created_at": "2026-02-12T19:07:22.001206+00:00", "updated_at": "2026-02-12T19:07:22.001206+00:00", "source": "session", "source_id": "fdbe93cd-b8d2-4a91-a9bb-596077e30e6d"}
{"id": "mm-36f0976b", "content": "tmux `set-titles` option must be enabled in config for window rename propagation to work. The setting affects how session titles propagate when spawning agents. Without this enabled, terminal window titles won't update properly in tmux.", "type": "fact", "tags": ["tmux", "configuration", "window-management", "gobby-core"], "created_at": "2026-02-12T19:07:03.888415+00:00", "updated_at": "2026-02-12T19:07:03.888415+00:00", "source": "session", "source_id": "fdbe93cd-b8d2-4a91-a9bb-596077e30e6d"}
{"id": "mm-9921888e", "content": "tmux rename-window only changes the tmux status bar name. To propagate the window name to the outer terminal emulator (e.g. Antigravity sidebar), you must also enable `set-titles on` globally. Additionally, disable `automatic-rename off` per-window to prevent tmux from overwriting the title on the next command. DANGER: Never write raw OSC escape sequences to the tmux client TTY (/dev/ttysNNN) — this injects bytes into tmux's input stream and can kill the terminal window.", "type": "insight", "tags": ["tmux", "terminal", "gotcha"], "created_at": "2026-02-12T19:00:31.217035+00:00", "updated_at": "2026-02-12T19:00:31.217035+00:00", "source": "mcp_tool", "source_id": "fdbe93cd-b8d2-4a91-a9bb-596077e30e6d"}
{"id": "mm-932ea0d8", "content": "DANGER: Do NOT write OSC 2 escape sequences directly to the tmux client TTY (/dev/ttysXXX). This injects bytes into tmux's input stream and can kill the terminal window. Instead, use `tmux set-option -g set-titles on` to propagate window names to the outer terminal emulator.", "type": "pattern", "tags": ["terminal-spawning", "escape-sequences", "tmux", "macos"], "created_at": "2026-02-12T18:53:59.905710+00:00", "updated_at": "2026-02-12T19:01:04.016868+00:00", "source": "session", "source_id": "fdbe93cd-b8d2-4a91-a9bb-596077e30e6d"}
{"id": "mm-7b767da0", "content": "tmux `set-titles` is disabled globally in the environment (tmux 3.6a shows 'set-titles off'). This prevents automatic window title updates via escape sequences. To enable dynamic titles, need to explicitly set `set-titles on` in tmux config or per-session.", "type": "fact", "tags": ["tmux", "configuration", "terminal-spawning", "gobby"], "created_at": "2026-02-12T18:53:47.410929+00:00", "updated_at": "2026-02-12T18:53:47.410929+00:00", "source": "session", "source_id": "fdbe93cd-b8d2-4a91-a9bb-596077e30e6d"}
{"id": "mm-f565acb6", "content": "To set config values in Gobby's DB-first config store at runtime: PUT http://localhost:60887/api/config/values with {\"values\": {\"key.path\": \"value\"}}. Returns {\"ok\": true, \"requires_restart\": true} when a daemon restart is needed.", "type": "insight", "tags": ["config", "rest-api", "config-store"], "created_at": "2026-02-12T18:52:31.864028+00:00", "updated_at": "2026-02-12T18:52:31.864028+00:00", "source": "mcp_tool", "source_id": "8ca08fd5-9b9c-43f3-880a-6f59cb806d05"}
{"id": "mm-70dc425c", "content": "mem0 Docker healthcheck: The mem0/mem0-api-server base image does NOT include curl. Use Python urllib for healthchecks instead: [\"CMD\", \"python\", \"-c\", \"import urllib.request; urllib.request.urlopen('http://localhost:8000/')\"]", "type": "insight", "tags": ["mem0", "docker", "healthcheck"], "created_at": "2026-02-12T18:52:03.665057+00:00", "updated_at": "2026-02-12T18:52:03.665057+00:00", "source": "mcp_tool", "source_id": "8ca08fd5-9b9c-43f3-880a-6f59cb806d05"}
{"id": "mm-85f6598e", "content": "Mem0 API Dockerfile pinned to version 0.1.115 but compose uses `latest` tag — version mismatch causes container unhealthy status. Source and installed Dockerfiles are independent copies; fixes must be applied to both locations.", "type": "fact", "tags": ["mem0", "docker", "version-mismatch", "deployment"], "created_at": "2026-02-12T18:51:06.892724+00:00", "updated_at": "2026-02-12T18:51:06.892724+00:00", "source": "session", "source_id": "4f4bc972-1c3c-41ef-b0d1-20c8b4730655"}
{"id": "mm-c630e784", "content": "Mem0 container health check fails because Dockerfile uses `curl` without installing it first. Both source (/gobby/services/mem0/Dockerfile) and installed copy have identical issue: `curl` command in healthcheck but not in RUN pip install. Fix requires adding `curl` to apt-get or using `python -m http.client` alternative.", "type": "fact", "tags": ["mem0", "docker", "healthcheck", "bug", "blocking"], "created_at": "2026-02-12T18:50:55.036630+00:00", "updated_at": "2026-02-12T18:50:55.036630+00:00", "source": "session", "source_id": "4f4bc972-1c3c-41ef-b0d1-20c8b4730655"}
{"id": "mm-40f83732", "content": "When hook dispatcher blocks a tool (via `Do not stop` feedback), Claude Code silently suppresses subsequent Read/Write tool calls with `<tool_use_error>Sibling tool call errored</tool_use_error>`. Workaround: abandon the blocked operation and start fresh, or use Bash as an alternative when Read/Write are blocked.", "type": "pattern", "tags": ["claude-code", "hooks", "tool-blocking", "error-handling"], "created_at": "2026-02-12T18:47:51.546200+00:00", "updated_at": "2026-02-12T18:47:51.546200+00:00", "source": "session", "source_id": "4f4bc972-1c3c-41ef-b0d1-20c8b4730655"}
{"id": "mm-80124865", "content": "Mem0 container health check fails because Dockerfile uses `curl` without `-f` flag. The curl command returns HTTP 200 even on application errors, so unhealthy containers report as healthy. Fix: add `-f` flag to curl in health check (e.g., `curl -f http://localhost:8000/health`). Affects both source Dockerfile and installed copies.", "type": "fact", "tags": ["mem0", "docker", "health-check", "bug", "critical"], "created_at": "2026-02-12T18:47:51.213244+00:00", "updated_at": "2026-02-12T18:47:51.213244+00:00", "source": "session", "source_id": "4f4bc972-1c3c-41ef-b0d1-20c8b4730655"}
{"id": "mm-b35d7320", "content": "The file src/gobby/mcp_proxy/tools/cron.py requires adding `Literal` to the typing import.", "type": "fact", "tags": ["imports", "typing", "cron.py"], "created_at": "2026-02-12T18:42:49.366546+00:00", "updated_at": "2026-02-12T18:42:49.366546+00:00", "source": "session", "source_id": "669b1ae9-d975-4308-a38d-267e7ca871e4"}
{"id": "mm-f81c90dc", "content": "A pre-tool-use hook error in the file path '.claude/hooks/hook_dispatcher.py' caused a tool to be blocked, and feedback suggests not stopping despite the error.", "type": "fact", "tags": ["hook error", "tool blockage", "debugging"], "created_at": "2026-02-12T18:42:49.349329+00:00", "updated_at": "2026-02-12T18:42:49.349329+00:00", "source": "session", "source_id": "a8cbfde2-f52a-44bb-9dbf-23cdb75b7401"}
{"id": "mm-f2923cfe", "content": "SafeExpressionEvaluator.evaluate() in src/gobby/workflows/safe_evaluator.py wraps results in bool() at line 81: `return bool(self.visit(tree.body))`. While visit_BoolOp returns actual Python values (empty string, dict, etc.), the public evaluate() API always returns a bool. Assertions using `is True`/`is False` are correct for evaluate() output. Don't change them to value comparisons like `== ''` or `== 'abc'`.", "type": "fact", "tags": ["safe-evaluator", "gotcha", "testing"], "created_at": "2026-02-12T18:41:42.956800+00:00", "updated_at": "2026-02-12T18:41:42.956800+00:00", "source": "mcp_tool", "source_id": "66cb7110-c987-47a1-8e86-08cb1109e0f0"}
{"id": "mm-1df90456", "content": "The task of fixing mypy errors included ensuring there are no issues remaining in the code. During work on 'AgentDefinitionsPage.tsx', an Edit button was added next to the detail view, and the build process highlighted some chunks larger than 500 kB after minification, suggesting the need for dynamic imports or code splitting.", "type": "fact", "tags": ["build", "performance", "minification"], "created_at": "2026-02-12T18:16:17.580614+00:00", "updated_at": "2026-02-12T18:16:17.580614+00:00", "source": "session", "source_id": "50115209-7ed5-4649-9eaf-fba48a0473c4"}
{"id": "mm-06984858", "content": "The workflow engine's rule-checking system expects `check_rules` attribute on WorkflowStep objects. This is part of the lifecycle rule evaluation flow and must be present (even as empty list) on all step mocks to avoid runtime failures during workflow execution.", "type": "pattern", "tags": ["workflow-rules", "engine-design", "required-attributes"], "created_at": "2026-02-12T17:54:08.780346+00:00", "updated_at": "2026-02-12T17:54:08.780346+00:00", "source": "session", "source_id": "0077bd03-f3d5-4da6-a660-e1329764de33"}
{"id": "mm-4a30275f", "content": "WorkflowStep mocks in tests require `check_rules = []` attribute initialization. Multiple test files (test_engine.py, test_lifecycle_observers.py, test_lifecycle_tool_rules.py, test_lifecycle_yaml_observers.py, test_observers.py) needed this added to step mocks to prevent AttributeError when engine processes rules.", "type": "fact", "tags": ["testing", "workflow-engine", "mock-setup", "gotcha"], "created_at": "2026-02-12T17:53:48.943820+00:00", "updated_at": "2026-02-12T17:53:48.943820+00:00", "source": "session", "source_id": "0077bd03-f3d5-4da6-a660-e1329764de33"}
{"id": "mm-180dbdbd", "content": "react-force-graph-3d uses TrackballControls (not OrbitControls). TrackballControls lacks autoRotate support. To implement idle rotation, use manual camera orbit via requestAnimationFrame + fg.cameraPosition() API. Also: three-spritetext sets .scale to text dimensions (e.g. 9,3,0) during construction. Never overwrite sprite scale with absolute values — always capture original scale first and multiply by the desired factor.", "type": "pattern", "tags": ["react-force-graph-3d", "three-spritetext", "three.js", "web-ui", "gotcha"], "created_at": "2026-02-12T17:49:51.169879+00:00", "updated_at": "2026-02-12T17:49:51.169879+00:00", "source": "mcp_tool", "source_id": "9ff21bbd-e29c-4e5a-b928-7264ca1fd6df"}
{"id": "mm-96dde21c", "content": "Timezone gotcha in session activity stats: When querying commits/tasks within a session date range, ensure timezone-aware datetime comparisons. The session created_at is stored in UTC, but filtering may use local time, causing off-by-one-day issues if not careful with timezone normalization.", "type": "fact", "tags": ["gobby", "session-stats", "datetime", "timezone", "debugging"], "created_at": "2026-02-12T17:34:07.463660+00:00", "updated_at": "2026-02-12T17:34:07.463660+00:00", "source": "session", "source_id": "5d62aa66-df84-418d-890c-d4d71f58a3ff"}
{"id": "mm-ded108b9", "content": "Gobby 3D knowledge graph display requires neo4j_url and neo4j_auth in ~/.gobby/config.yaml under the memory section. The web UI checks /admin/status for memory.neo4j.configured before showing the KnowledgeGraph tab. The Neo4j instance runs on port 8474 (HTTP) from mem0's docker compose, with auth neo4j:mem0graph.", "type": "technical", "tags": ["neo4j", "config", "web-ui"], "created_at": "2026-02-12T17:12:09.152762+00:00", "updated_at": "2026-02-12T17:12:09.152762+00:00", "source": "mcp_tool", "source_id": "9ff21bbd-e29c-4e5a-b928-7264ca1fd6df"}
{"id": "mm-b74031a5", "content": "Mem0 Docker setup: The mem0/mem0-api-server Docker Hub image is missing critical dependencies for postgres+neo4j usage. Must extend with mem0ai[graph,vector-stores] and psycopg[binary,pool] extras. The image's main.py reads POSTGRES_HOST/USER/PASSWORD/DB and NEO4J_URI/USERNAME/PASSWORD env vars (NOT MEM0_* style). Needs /app/history volume for SQLite history. Internal port is 8000.", "type": "technical", "tags": ["mem0", "docker", "gotcha"], "created_at": "2026-02-12T17:06:40.330275+00:00", "updated_at": "2026-02-12T17:06:40.330275+00:00", "source": "mcp_tool", "source_id": "9ff21bbd-e29c-4e5a-b928-7264ca1fd6df"}
{"id": "mm-d5dd8c01", "content": "Gobby _mem0_start() in daemon.py now resolves OPENAI_API_KEY from the SecretStore and injects it into the docker compose subprocess env. This keeps the API key out of .env files and off disk. The flow: instantiate LocalDatabase + SecretStore from config, call secret_store.get('OPENAI_API_KEY'), pass via env dict to subprocess.run(). The compose file references ${OPENAI_API_KEY} which gets resolved from the subprocess environment.", "type": "technical", "tags": ["mem0", "secrets", "architecture"], "created_at": "2026-02-12T17:06:26.561096+00:00", "updated_at": "2026-02-12T17:06:26.561096+00:00", "source": "mcp_tool", "source_id": "9ff21bbd-e29c-4e5a-b928-7264ca1fd6df"}
{"id": "mm-753a9f55", "content": "Config architecture goal: config.yaml should be optional. Resolution priority is: (1) database/secrets store, (2) config.yaml, (3) environment variables. Pydantic defaults cover everything else. The UI should support import/export of config. The stripped config.yaml (24 lines, non-defaults only) is the target state — everything not explicitly overridden falls through to Pydantic defaults.", "type": "fact", "tags": ["architecture", "config", "preference"], "created_at": "2026-02-12T16:36:57.711058+00:00", "updated_at": "2026-02-12T16:36:57.711058+00:00", "source": "mcp_tool", "source_id": "655a5b27-9355-40d4-8652-60b8843105f7"}
{"id": "mm-99d5d6d2", "content": "API key resolution architecture issue: LiteLLMProvider.__init__ (litellm.py:78-80) pushes config api_keys into os.environ as a side effect. Other modules (semantic_search.py, search/embeddings.py) rely on os.environ.get('OPENAI_API_KEY') which only works because LiteLLM was initialized first. CodexProvider.get_api_key() (codex.py:121) in api_key mode reads directly from os.environ, never checking config.llm_providers.api_keys. This is fragile — depends on init order and breaks if LiteLLM isn't initialized before Codex.", "type": "fact", "tags": ["architecture", "api-keys", "config", "bug"], "created_at": "2026-02-12T16:20:02.805974+00:00", "updated_at": "2026-02-12T16:20:02.805974+00:00", "source": "mcp_tool", "source_id": "655a5b27-9355-40d4-8652-60b8843105f7"}
{"id": "mm-87e3b260", "content": "Config supports two secret reference patterns: $secret:NAME (secrets-store-only, no env fallback) and ${VAR} (secrets store first, then env vars, then default). Use $secret:NAME when you want encrypted-at-rest secrets with no env leakage. Config.yaml uses $secret:OPENAI_API_KEY in llm_providers.api_keys. Both patterns are resolved in expand_env_vars() in config/app.py during phase 2 config loading (after DB init).", "type": "architecture", "tags": ["config", "secrets", "api-keys"], "created_at": "2026-02-12T16:03:50.793323+00:00", "updated_at": "2026-02-12T16:03:50.793323+00:00", "source": "mcp_tool", "source_id": "8b03b181-ca3b-4b83-a28e-380a1ccfb91d"}
{"id": "mm-d0c2252c", "content": "LiteLLMProvider in llm/litellm.py sets os.environ from config api_keys. Previously had 'if value and key not in os.environ' guard which meant env vars always won over config. Changed to unconditionally set from config since config is now the source of truth (resolved from secrets store > env vars). This ensures secrets-store priority propagates to LiteLLM.", "type": "architecture", "tags": ["litellm", "api-keys", "secrets"], "created_at": "2026-02-12T15:31:50.195663+00:00", "updated_at": "2026-02-12T15:31:50.195663+00:00", "source": "mcp_tool", "source_id": "8b03b181-ca3b-4b83-a28e-380a1ccfb91d"}
{"id": "mm-a4dc0c28", "content": "Config variable resolution has a two-phase design due to chicken-and-egg: config must load before DB init (to get db_path), but SecretStore needs the DB. Phase 1: expand_env_vars() with env vars only. Phase 2: after DB init in runner.py, reload config with secret_store.get as secret_resolver. Resolution order: secrets store > env vars > default > warn. The expand_env_vars function in config/app.py accepts an optional secret_resolver: Callable[[str], str | None] parameter.", "type": "architecture", "tags": ["config", "secrets", "env-vars"], "created_at": "2026-02-12T15:31:19.435309+00:00", "updated_at": "2026-02-12T15:31:19.435309+00:00", "source": "mcp_tool", "source_id": "8b03b181-ca3b-4b83-a28e-380a1ccfb91d"}
{"id": "mm-cdcacb06", "content": "The Claude Code `Skill` tool only knows about skills registered directly with Claude Code (via .claude/commands/ or built-in). Gobby skills (expand, tasks, memory, etc.) are discovered via gobby-skills MCP server and injected through hooks — they are NOT in Claude Code's native skill registry. Never use the Skill tool to invoke gobby skills; they're routed through the /gobby command's hook interception in _agent.py.", "type": "insight", "tags": ["skills", "claude-code", "architecture"], "created_at": "2026-02-12T15:26:36.693010+00:00", "updated_at": "2026-02-12T15:26:36.693010+00:00", "source": "mcp_tool", "source_id": "9db8b4a1-ad65-4ddf-b8b2-cb412f5e42b6"}
{"id": "mm-c372066d", "content": "The /gobby skill routing in _agent.py uses regex `^/gobby(?::(\\S+))?\\s*(.*)?$` which only captures skill names after a colon (/gobby:expand), not after a space (/gobby expand). Fixed by adding fallback logic: when skill_name is None but args is non-empty, check if the first word of args resolves to a valid skill via resolve_skill_name(). If so, treat it as the skill name. File: src/gobby/hooks/event_handlers/_agent.py, method _intercept_skill_command().", "type": "insight", "tags": ["skills", "routing", "hooks", "bugfix"], "created_at": "2026-02-12T15:25:57.802577+00:00", "updated_at": "2026-02-12T15:25:57.802577+00:00", "source": "mcp_tool", "source_id": "9db8b4a1-ad65-4ddf-b8b2-cb412f5e42b6"}
{"id": "mm-b6c982c8", "content": "Gobby UI config: ui.enabled must be true and bind_host must be 0.0.0.0 (not localhost) for the web UI to be accessible over Tailscale/network. The UI is served by the main HTTP server (not a separate Vite process) in production mode from web/dist/. The daemon can take 15-30s to start listening on the port after the process starts — health checks may time out during this window but the daemon eventually comes up.", "type": "fact", "tags": ["config", "ui", "tailscale", "networking"], "created_at": "2026-02-12T15:04:59.021038+00:00", "updated_at": "2026-02-12T15:04:59.021038+00:00", "source": "mcp_tool", "source_id": "16810f19-280c-4a8e-9663-ac826ae47c0c"}
{"id": "mm-bff7de2e", "content": "Unified Workflow Architecture design spec created (plan at .claude/plans/elegant-wobbling-forest.md). Key decisions: (1) Merge lifecycle + step workflows into single type — no `type` field, capabilities determined by what's declared (`triggers:` for reactive, `steps:` for state machine, both optional). (2) `enabled: true/false` flag replaces activate/deactivate dance. (3) `session_variables:` dedicated shared namespace (accessed as `session.*`) for cross-workflow state; workflow `variables:` isolated per-workflow (accessed as `variables.*`). (4) Pipeline/workflow composability: `run_pipeline` action in workflows, `spawn_session` and `activate_workflow` step types in pipelines. (5) Pipelines stay as `type: pipeline` — separate execution model bridged by composability. (6) Engine uses trigger-type index for performance, 'accumulate context, first block stops' conflict resolution.", "type": "fact", "tags": ["architecture", "workflows", "pipelines", "design"], "created_at": "2026-02-12T07:30:44.674946+00:00", "updated_at": "2026-02-12T07:30:44.674946+00:00", "source": "mcp_tool", "source_id": "9fa21d80-09b0-4a4d-a3eb-f77ab358d231"}
{"id": "mm-50bbaf1e", "content": "ConditionEvaluator.check_exit_conditions() context has 'task_list': state.task_list as an internal key. Variables with the same name as WorkflowState fields (task_list, step_action_count, total_action_count) are skipped during merge to avoid shadowing. Use variables.get('task_list') in exit_when expressions when the variable name collides with a WorkflowState field. The variable_set condition type checks state.variables directly and doesn't have this issue.", "type": "insight", "tags": ["workflows", "evaluator", "exit_conditions", "gotcha"], "created_at": "2026-02-12T05:59:35.138443+00:00", "updated_at": "2026-02-12T05:59:35.138443+00:00", "source": "mcp_tool", "source_id": "8264345e-68a1-4f70-bbea-e4d703df9389"}
{"id": "mm-e722fbed", "content": "The user decided to strip the config file to non-defaults only, which means only explicitly set configurations should remain.", "type": "preference", "tags": ["config_cleanup", "preferences"], "created_at": "2026-02-12T05:45:13.977769+00:00", "updated_at": "2026-02-12T05:45:13.977769+00:00", "source": "session", "source_id": "687611cf-90fa-4295-ab3c-4d37d209ff2e"}
{"id": "mm-25caa9ce", "content": "The mem0 backend was removed from the memory setup, leaving only the 'local' (SQLite) backend available.", "type": "fact", "tags": ["memory_config", "backend", "SQLite"], "created_at": "2026-02-12T05:45:06.789495+00:00", "updated_at": "2026-02-12T05:45:06.789495+00:00", "source": "session", "source_id": "687611cf-90fa-4295-ab3c-4d37d209ff2e"}
{"id": "mm-64bec743", "content": "Decision made to make `faster-whisper` a regular dependency instead of an optional one, which was documented as part of the plan update.", "type": "preference", "tags": ["dependencies", "configuration"], "created_at": "2026-02-12T05:42:00.927185+00:00", "updated_at": "2026-02-12T05:42:00.927185+00:00", "source": "session", "source_id": "99ebf42b-ba46-43b9-8b06-426dd4af0ffd"}
{"id": "mm-5cd62661", "content": "During the session, it was determined that `DaemonConfig` does not have `frozen=True`, which was crucial for resolving an issue related to Web UI configuration.", "type": "fact", "tags": ["debugging", "configuration"], "created_at": "2026-02-12T05:41:59.093088+00:00", "updated_at": "2026-02-12T05:41:59.093088+00:00", "source": "session", "source_id": "99ebf42b-ba46-43b9-8b06-426dd4af0ffd"}
{"id": "mm-e82dd91a", "content": "The recent edit in `lifecycle_evaluator.py` involved adding `observer_engine` as a keyword argument, which caused unexpected test failures due to previously unrecognized parameters.", "type": "fact", "tags": ["parameter quirk", "test failure", "observer_engine"], "created_at": "2026-02-12T05:14:32.714896+00:00", "updated_at": "2026-02-12T05:14:32.714896+00:00", "source": "session", "source_id": "8264345e-68a1-4f70-bbea-e4d703df9389"}
{"id": "mm-2b8a7c06", "content": "When using unittest.mock.patch() with string paths like 'gobby.cli.installers.claude.install_claude', the patch fails if gobby.cli hasn't been imported yet (module 'gobby' has no attribute 'cli'). Fix: use patch.object() with direct module imports instead (e.g., from gobby.cli.installers import claude as claude_mod; patch.object(claude_mod, 'install_claude')). This is a general Python gotcha with lazy/nested imports and mock.patch string paths.", "type": "fact", "tags": ["testing", "mocking", "python", "gotcha"], "created_at": "2026-02-12T05:11:14.402419+00:00", "updated_at": "2026-02-12T05:11:14.402419+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-febb9866", "content": "Bug #8055: The auto-task workflow in the 'gobby' project ignores 'assigned_task_id' and requires fixing of the 'session_task' variable. The issue might involve the workflow not accepting 'N' or '#N' for 'session_id' in the 'mcp' call.", "type": "fact", "tags": ["bug", "workflow", "session_task", "assigned_task_id"], "created_at": "2026-02-12T05:03:06.204699+00:00", "updated_at": "2026-02-12T05:03:06.204699+00:00", "source": "session", "source_id": "7e334f64-c43a-46fe-8f4d-29b72e1c6526"}
{"id": "mm-869c64a9", "content": "An issue related to `create_memory` FK constraint was filed as task #8061.", "type": "context", "tags": ["task", "create_memory", "bug"], "created_at": "2026-02-12T04:58:18.860886+00:00", "updated_at": "2026-02-12T04:58:18.860886+00:00", "source": "session", "source_id": "971fbce6-9aeb-4001-9097-8d3b11e63b18"}
{"id": "mm-35665903", "content": "The `memories` table does not have a session ID column, which may cause confusion or errors when attempting to reference sessions.", "type": "fact", "tags": ["database", "schema", "memories"], "created_at": "2026-02-12T04:58:12.502359+00:00", "updated_at": "2026-02-12T04:58:12.502359+00:00", "source": "session", "source_id": "971fbce6-9aeb-4001-9097-8d3b11e63b18"}
{"id": "mm-afca4dda", "content": "The `create_memory` function had a foreign key constraint error due to not correctly handling the `#N` shorthand for session IDs.", "type": "fact", "tags": ["create_memory", "bug", "foreign_key"], "created_at": "2026-02-12T04:58:11.315760+00:00", "updated_at": "2026-02-12T04:58:11.315760+00:00", "source": "session", "source_id": "971fbce6-9aeb-4001-9097-8d3b11e63b18"}
{"id": "mm-0441424c", "content": "Feature removal gotcha: When removing a field from a dataclass (e.g., WorkflowState.artifacts), MagicMock(spec=WorkflowState) in tests will correctly reject the removed attribute — but production code that still references it will cause AttributeError at runtime. This means removing a model field requires checking not just tests but all production code paths that use the model. The state_manager SQL (INSERT/UPDATE) must also be updated if a DB column is removed from the baseline schema, or new databases will fail.", "type": "insight", "tags": ["testing", "refactoring", "gotcha", "sqlite"], "created_at": "2026-02-12T04:56:48.553094+00:00", "updated_at": "2026-02-12T04:56:48.553094+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-4c1ef195", "content": "The file src/gobby/mcp_proxy/tools/cron.py requires adding `Literal` to the typing import.", "type": "fact", "tags": ["imports", "typing", "cron.py"], "created_at": "2026-02-12T03:12:35.762976+00:00", "updated_at": "2026-02-12T03:12:35.762976+00:00", "source": "session", "source_id": "669b1ae9-d975-4308-a38d-267e7ca871e4"}
{"id": "mm-d3b61f6d", "content": "The task of fixing mypy errors included ensuring that there are no issues remaining in the code after updates.", "type": "context", "tags": ["mypy", "linting", "issue resolution"], "created_at": "2026-02-12T03:04:39.281641+00:00", "updated_at": "2026-02-12T03:04:39.281641+00:00", "source": "session", "source_id": "669b1ae9-d975-4308-a38d-267e7ca871e4"}
{"id": "mm-adfad928", "content": "The file `factory.py` had no unstaged or staged changes during the session because the changes had already been committed. This discovery clarified why modifications were not appearing as expected.", "type": "fact", "tags": ["git", "commits", "file changes"], "created_at": "2026-02-12T02:04:08.171384+00:00", "updated_at": "2026-02-12T02:04:08.171384+00:00", "source": "session", "source_id": "4c1d8ccb-7f94-49ac-8922-587d0f5baf04"}
{"id": "mm-a6a0b28a", "content": "There was an error when attempting to open a directory 'web/web/tests/' indicating it does not exist. This caused a fatal pathspec error related to 'web/tests/terminal-color.' The solution involved using a full path, indicating possible issues with current working directory assumptions.", "type": "fact", "tags": ["debugging", "directory-structure", "filesystem"], "created_at": "2026-02-12T01:03:49.236451+00:00", "updated_at": "2026-02-12T01:03:49.236451+00:00", "source": "session", "source_id": "7ed97f8f-a6c1-4ee7-84d4-216f0f91b733"}
{"id": "mm-de85ebb0", "content": "A standard sidebar width is specified as 260px, and this template is applied in updating 'nifty-snacking-waterfall.md'.", "type": "pattern", "tags": ["UI", "styleguide", "sidebar"], "created_at": "2026-02-12T00:03:26.301243+00:00", "updated_at": "2026-02-12T00:03:26.301243+00:00", "source": "session", "source_id": "48603b3e-2995-4a3c-8cc1-4cabcc41a55b"}
{"id": "mm-d1e3d60f", "content": "The current migration version is 90, and a one-off SQL query for 'A1' is now included in the updated plan file 'nifty-snacking-waterfall.md'.", "type": "fact", "tags": ["migration", "SQL", "plan"], "created_at": "2026-02-12T00:03:14.861071+00:00", "updated_at": "2026-02-12T00:03:14.861071+00:00", "source": "session", "source_id": "48603b3e-2995-4a3c-8cc1-4cabcc41a55b"}
{"id": "mm-21e64bde", "content": "Test writing insights for gobby codebase:\n\n1. agent_definitions table has UNIQUE constraint on name - duplicate name inserts fail with IntegrityError\n2. import_from_definition() has isinstance(agent_def, AgentDefinition) check - MagicMock fails this, must use real AgentDefinition Pydantic models when testing import endpoints\n3. Foreign keys are enforced in SQLite - tests referencing project_id must create real projects first via project_manager.create()\n4. Full pytest suite with coverage takes ~43 minutes - use targeted test runs during dev\n5. Background bash commands piped through tail produce no output until process finishes - use --tb=short without pipe for long runs", "type": "fact", "tags": ["testing", "debugging", "gotchas"], "created_at": "2026-02-12T00:01:58.128549+00:00", "updated_at": "2026-02-12T00:01:58.128549+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-01fbe3e5", "content": "The session established that all 6 batch agents are running in parallel and actively working, achieving 100% test coverage on four source files.", "type": "context", "tags": ["test coverage", "batch agents"], "created_at": "2026-02-11T22:27:44.352369+00:00", "updated_at": "2026-02-11T22:27:44.352369+00:00", "source": "session", "source_id": "a57eb6c0-deae-4349-8311-b79d4667387b"}
{"id": "mm-ad886cfc", "content": "The project currently has 78.67% test coverage and needs an additional 8% to reach the desired 82% coverage target.", "type": "fact", "tags": ["coverage", "metrics"], "created_at": "2026-02-11T22:08:04.131483+00:00", "updated_at": "2026-02-11T22:08:04.131483+00:00", "source": "session", "source_id": "807bb581-68c4-4b86-ad3d-71fc16492214"}
{"id": "mm-0b993eae", "content": "The `message_count` column is not present in the schema and must be computed, likely derived from the `message_map` variable in the code.", "type": "fact", "tags": ["schema", "message_count", "computed"], "created_at": "2026-02-11T22:02:58.917620+00:00", "updated_at": "2026-02-11T22:02:58.917620+00:00", "source": "session", "source_id": "b3d9d76c-7bc6-459e-9713-e854979b9a29"}
{"id": "mm-9930a242", "content": "ForceGraph3D (react-force-graph-3d) destroys custom nodeThreeObject instances (SpriteText labels) on parent re-renders. CONFIRMED: even with ALL ForceGraph3D props stable (memoized callbacks, constant values, no nodePositionUpdate), labels still disappear when parent component re-renders due to state change. The react-kapsule wrapper appears to re-process nodes on ANY re-render, not just prop changes. Attempted fixes that FAILED: (1) Removing nodePositionUpdate + memoizing nodeLabel + constant linkDirectionalParticles — still broke. (2) Using animateIdleRef to avoid prop changes — still broke. (3) rAF loop for animation outside React — animation itself works but labels still lost. The issue is fundamental to how react-force-graph-3d/react-kapsule handles re-renders. Next approach to try: React.memo() wrapper on ForceGraph3D, or isolating it in a child component that never re-renders (no state, only refs).", "type": "debugging", "tags": ["react-force-graph-3d", "three.js", "ForceGraph3D", "SpriteText", "react-kapsule", "animation"], "created_at": "2026-02-11T21:49:49.461832+00:00", "updated_at": "2026-02-11T22:07:21.059640+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-69d4c1d5", "content": "The session highlights a bug related to toggling animations in the UI: **Before toggle** the 365 Knowledge Graph nodes are clearly visible, but **After toggle** an animation causes flickering, making it hard to read labels.", "type": "fact", "tags": ["bug", "ui", "knowledge graph", "animation"], "created_at": "2026-02-11T21:15:28.877572+00:00", "updated_at": "2026-02-11T21:15:28.877572+00:00", "source": "session", "source_id": "a3fe98a6-4c68-48d4-b67c-e27bd4103b92"}
{"id": "mm-68041626", "content": "The format conventions for plan documents include specific heading styles and sections, as exemplified by the 'Auto-Detect CLIs, Auth Modes, and Models on Daemon Startup' section.", "type": "fact", "tags": ["format", "conventions", "plan documents"], "created_at": "2026-02-11T21:13:17.062511+00:00", "updated_at": "2026-02-11T21:13:17.062511+00:00", "source": "session", "source_id": "1e52524f-f0e8-49f3-8245-0ee6c0f6a823"}
{"id": "mm-bd45e000", "content": "FastAPI test patterns: 1) Lazy isinstance checks with MagicMock need autouse fixture patching the class. 2) Test dirs named after packages (mcp/) cause import conflicts. 3) Depends-based routes use dependency_overrides, not create_X_router. 4) Generic except handlers re-wrap HTTPExceptions as 500. 5) Installer backup runs before read.", "type": "fact", "tags": ["testing", "fastapi"], "created_at": "2026-02-11T21:05:24.404982+00:00", "updated_at": "2026-02-11T21:05:24.404982+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-d370bb38", "content": "FastAPI test patterns learned during coverage push:\n\n1. isinstance with lazy imports: When route handlers do `from gobby.storage.database import LocalDatabase; isinstance(db, LocalDatabase)`, MagicMock fails. Fix: autouse fixture patching `gobby.storage.database.LocalDatabase` with `MagicMock` class so isinstance(MagicMock(), MagicMock) returns True.\n\n2. Test directory naming conflicts: Never name a test directory after a Python package (e.g., tests/servers/routes/mcp/ clashes with the `mcp` package). Use `mcp_endpoints/` instead.\n\n3. FastAPI dependency_overrides: Routes using Depends(get_server) need `app.dependency_overrides[get_server] = override_fn` instead of `create_X_router(mock_server)` pattern.\n\n4. Exception re-wrapping: If a route catches HTTPException(503) inside a generic `except Exception`, it re-raises as 500. Check the actual handler logic when writing test assertions.\n\n5. Installer backup-before-read order: copy2 (backup) runs before open (read), so making a file unreadable causes 'Failed to create backup' not 'Failed to read'.", "type": "fact", "tags": ["testing", "fastapi", "patterns", "mocking"], "created_at": "2026-02-11T21:04:37.108848+00:00", "updated_at": "2026-02-11T21:04:37.108848+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-f1f0f287", "content": "FastAPI routes that return Union types like dict[str, Any] | JSONResponse will fail with FastAPIError at app startup. Fix: add response_model=None to the route decorator. Example: @router.post('/path', response_model=None). Found in cron.py run_job_now route.", "type": "fact", "tags": ["fastapi", "gotcha", "routes"], "created_at": "2026-02-11T19:58:42.089630+00:00", "updated_at": "2026-02-11T19:58:42.089630+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-5e24ae05", "content": "Coding CLI auth detection locations: Codex stores auth in ~/.codex/auth.json (has tokens field for subscription, OPENAI_API_KEY field for API key) and caches its full model list in ~/.codex/models_cache.json (models array with slug, display_name, description fields). Gemini stores OAuth creds in ~/.gemini/oauth_creds.json (has refresh_token for subscription) and account info in ~/.gemini/google_accounts.json. Claude Code has no explicit auth file — subscription is implicit from binary presence. LiteLLM has litellm.models_by_provider dict and litellm.model_cost registry but NO unified list_models(api_key) function — must call provider APIs directly for dynamic model listing.", "type": "fact", "tags": ["cli-detection", "auth", "llm", "codex", "gemini", "claude", "litellm"], "created_at": "2026-02-11T19:58:00.633183+00:00", "updated_at": "2026-02-11T19:58:00.633183+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-07319c65", "content": "The gobby MCP call_tool tool parameter is named \"arguments\" (not \"args\"). When calling mcp__gobby__call_tool, pass nested tool arguments as \"arguments\": {\"key\": \"value\"}, NOT \"args\". FastMCP validates parameter names strictly and rejects unknown parameters.", "type": "fact", "tags": ["bug", "mcp", "call_tool", "workaround"], "created_at": "2026-02-11T19:44:47.928108+00:00", "updated_at": "2026-02-11T19:58:15.162753+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-59745a69", "content": "There was a UNIQUE constraint error when attempting to execute an expansion, which indicates that all 17 dependencies were already wired. This suggests that the expansion logic correctly ensures all dependencies are set up, and re-running it will not duplicate tasks.", "type": "fact", "tags": ["debugging", "dependency management", "error handling"], "created_at": "2026-02-11T19:30:03.360621+00:00", "updated_at": "2026-02-11T19:30:03.360621+00:00", "source": "session", "source_id": "d0446fa0-f37c-4bad-b269-1bd5ed7d73a1"}
{"id": "mm-206b0a84", "content": "The `de_escalate` function is referenced in multiple locations within the codebase, such as in `task_validation.py:452`, and is implemented in both the MCP tool and as an HTTP route.", "type": "fact", "tags": ["function usage", "code references"], "created_at": "2026-02-11T19:24:05.600577+00:00", "updated_at": "2026-02-11T19:24:05.600577+00:00", "source": "session", "source_id": "8e0e0642-0012-43cb-b811-eddc78893202"}
{"id": "mm-0c61bd9e", "content": "Bug: RegistryContext in src/gobby/mcp_proxy/tools/tasks/_context.py line 123 had self.db instead of self.task_manager.db. RegistryContext has no db attribute - it accesses the database through task_manager.db (see __post_init__ line 59). This broke any gobby-tasks MCP tool that calls resolve_project_filter (list_tasks, save_expansion_spec, etc). Fixed in commit 70a74b4d.", "type": "debugging", "tags": ["bug", "mcp-proxy", "tasks", "registry-context"], "created_at": "2026-02-11T18:02:15.762293+00:00", "updated_at": "2026-02-11T18:02:15.762293+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-c6599f32", "content": "Workflow engine has two evaluators: ConditionEvaluator (eval-based, used by transitions/step rules/action when clauses) and SafeExpressionEvaluator (AST-based, used only by block_tools enforcement). Plan at docs/plans/workflow-engine-rules.md proposes unifying on the AST evaluator, adding named rule definitions with DB-backed three-tier inheritance, tool_rules shorthand, hybrid observer registry (YAML for simple, Python behaviors for complex like detect_task_claim), and simplified exit conditions.", "type": "architecture", "tags": ["workflow-engine", "architecture", "evaluator", "rules"], "created_at": "2026-02-11T17:35:50.357886+00:00", "updated_at": "2026-02-11T17:35:50.357886+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-a4dd55df", "content": "GobbyTask (list interface) and GobbyTaskDetail (detail interface) are separate TypeScript interfaces in useTasks.ts. GobbyTask is the lighter version used in task lists — it does NOT include project_id, description, labels, etc. Only GobbyTaskDetail extends GobbyTask with those fields. When filtering tasks by project_id client-side, project_id must be added to the base GobbyTask interface.", "type": "pattern", "tags": ["frontend", "typescript", "tasks", "gotcha"], "created_at": "2026-02-11T17:33:42.755231+00:00", "updated_at": "2026-02-11T17:33:42.755231+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-1e9e86e7", "content": "Plans should not have open questions or unresolved options. Settle all decisions before presenting a plan for approval. Josh doesn't like being asked to choose between options at the end — resolve them during the planning discussion.", "type": "preference", "tags": ["planning", "workflow", "preference"], "created_at": "2026-02-11T17:21:48.375243+00:00", "updated_at": "2026-02-11T17:21:48.375243+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-bc9ffa4e", "content": "Git timestamp timezone gotcha: When using git --since/--until with timestamps parsed from the database (which stores UTC with +00:00 offset), you MUST include the timezone offset in the formatted string (use %z). Without it, git interprets bare timestamps as local time, causing incorrect filtering. Also, session.jsonl_path parent (~/.claude/projects/...) is NOT a git repo — use project.repo_path from the projects table instead.", "type": "insight", "tags": ["git", "timezone", "sessions", "gotcha"], "created_at": "2026-02-11T17:20:12.592588+00:00", "updated_at": "2026-02-11T17:20:12.592588+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-6d8d6a6e", "content": "The _personal project name is mapped to 'Personal' in App.tsx (line 86). This causes UI confusion when components use project names as labels - any toggle or display showing 'Personal' may collide with the _personal project name. The ChatInput scope toggle was redesigned to use fixed 'Personal'/'Project' labels with a search dropdown instead of showing project names directly.", "type": "pattern", "tags": ["web-ui", "projects", "gotcha"], "created_at": "2026-02-11T16:36:54.327240+00:00", "updated_at": "2026-02-11T16:36:54.327240+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-90e1218d", "content": "Session detail endpoint GET /sessions/{id} returns session.to_dict() which does NOT include computed fields like message_count. The list endpoint GET /sessions enriches with message_count from session_messages table. Any new computed fields must be added to both endpoints. Fixed in sessions.py by adding get_all_counts() enrichment to the detail endpoint.", "type": "pattern", "tags": ["web-ui", "sessions", "api", "backend"], "created_at": "2026-02-11T16:36:35.130284+00:00", "updated_at": "2026-02-11T16:36:35.130284+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-98ef118d", "content": "Gobby web frontend is at /web/ (React 18 + TypeScript + Vite). Single CSS file at web/src/styles/index.css (~196KB). Components in web/src/components/, hooks in web/src/hooks/. API proxy to daemon on localhost:60887, WebSocket on localhost:60888.", "type": "fact", "tags": ["web-ui", "frontend", "architecture"], "created_at": "2026-02-11T16:36:06.188022+00:00", "updated_at": "2026-02-11T16:36:06.188022+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-8157dc3e", "content": "A pre-tool-use hook error in the file path '.claude/hooks/hook_dispatcher.py' caused a tool to be blocked, and feedback suggests not stopping despite the error.", "type": "fact", "tags": ["hook error", "tool blockage", "debugging"], "created_at": "2026-02-11T15:47:22.636635+00:00", "updated_at": "2026-02-11T15:47:22.636635+00:00", "source": "session", "source_id": "a8cbfde2-f52a-44bb-9dbf-23cdb75b7401"}
{"id": "mm-9577f734", "content": "InternalToolRegistry._get_json_schema_type() collapses union types (str|int|float|bool|None) to just the first non-None type (\"string\"). This means MCP tool params declared as union types get a string-only schema, and _coerce_args skips coercion for string-declared params. The set_variable MCP tool now has explicit coercion for string booleans/nulls/numbers in _artifacts.py to work around this.", "type": "pattern", "tags": ["mcp", "workflow", "schema", "gotcha"], "created_at": "2026-02-11T15:29:07.579161+00:00", "updated_at": "2026-02-11T15:29:07.579161+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-74ae00c8", "content": "A pre-tool-use hook error in the file path '.claude/hooks/hook_dispatcher.py' caused a tool to be blocked, and feedback suggests not stopping despite the error.", "type": "fact", "tags": ["hook error", "tool blockage", "debugging"], "created_at": "2026-02-11T15:21:29.992628+00:00", "updated_at": "2026-02-11T15:21:29.992628+00:00", "source": "session", "source_id": "a8cbfde2-f52a-44bb-9dbf-23cdb75b7401"}
{"id": "mm-52b47f5b", "content": "Bug in memory_review_gate: The MCP set_variable tool's value param is typed as string, so setting value=\"false\" stores the string \"false\" which is truthy in Python. The YAML condition `variables.get('pending_memory_review')` evaluates string \"false\" as True. Fix: either make set_variable coerce \"true\"/\"false\" strings to booleans, or change the gate condition to check `variables.get('pending_memory_review') == True` or `is True`. Also, on_after_tool resets stop_attempts to 0 on every tool call, which means the 3-strike escape hatch can never trigger if the agent keeps calling tools to try to clear the variable.", "type": "pattern", "tags": ["bug", "memory-system", "workflow-engine", "set_variable"], "created_at": "2026-02-11T15:09:03.518439+00:00", "updated_at": "2026-02-11T15:09:03.518439+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-f51d4e1a", "content": "Self-hosted mem0 Docker API uses different paths than the hosted platform: /memories and /search (no /v1/ prefix, no trailing slashes). The Mem0Client auto-detects by checking if 'api.mem0.ai' is in the base_url. Response format uses 'memory' field instead of 'content'. The mem0 Docker instance runs on port 8888 with postgres on 8432 and neo4j on 8474/8687.", "type": "fact", "tags": ["mem0", "docker", "api-paths", "self-hosted"], "created_at": "2026-02-11T02:02:10.649543+00:00", "updated_at": "2026-02-11T02:02:10.649543+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-0b35820d", "content": "Project resolution mock targets: When testing CLI commands that resolve project IDs, patch gobby.cli.utils.get_project_context (not gobby.cli.tasks.crud.get_project_context), because resolve_project_ref() in cli/utils.py does the actual import. The _resolve_project_id in hook_manager.py now falls back to PERSONAL_PROJECT_ID instead of calling initialize_project.", "type": "pattern", "tags": ["testing", "mocking", "project-resolution"], "created_at": "2026-02-10T20:21:43.208477+00:00", "updated_at": "2026-02-10T20:21:43.208477+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-830c4c3a", "content": "The gobby mcp-server stdio process (started by Claude Code) is long-running and caches Python modules from startup. When changing config validation (like MemoryConfig.validate_backend), the daemon restarts with new code but the stale mcp-server process still runs old validation. Workaround: use config values valid in BOTH old and new code, or add backwards-compat aliases in validators. Fixed by adding 'sqlite' -> 'local' alias in validate_backend. YAML bare 'null' is parsed as None - use quoted '\"null\"' for the string value.", "type": "fact", "tags": ["debugging", "mcp-server", "config", "gotcha"], "created_at": "2026-02-10T14:25:18.003615+00:00", "updated_at": "2026-02-10T14:25:18.003615+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-749df05c", "content": "Bandit nosec annotations require space-separated codes, not comma-separated. Use `# nosec B603 B607` not `# nosec B603,B607`. Comma-separated format only suppresses the first code.", "type": "fact", "tags": ["bandit", "python", "linting"], "created_at": "2026-02-10T04:42:58.399207+00:00", "updated_at": "2026-02-10T04:42:58.399207+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-f7fa2e99", "content": "Architecture decision: For web UI chat sessions that lack SessionStart hooks, use a 'headless-lifecycle.yaml' workflow (separate from session-lifecycle.yaml) that moves all session_start initialization into on_before_agent with a _session_initialized guard variable. Backend (ChatMixin) handles session DB registration, lifecycle activation, and /clear. SDK hooks bridge to the workflow engine via callbacks. Plan at docs/plans/web-chat-lifecycle.md.", "type": "decision", "tags": ["architecture", "web-chat", "lifecycle", "headless"], "created_at": "2026-02-10T03:17:03.573659+00:00", "updated_at": "2026-02-10T03:17:03.573659+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-2418f3f8", "content": "The Claude Agent SDK has resume and fork_session options: ClaudeAgentOptions(resume='<session-uuid>', fork_session=False). The SDK wraps the Claude CLI binary and passes --resume <session_id> to it. Claude Code manages JSONL transcripts at ~/.claude/sessions/<session-id>/. Web chat sessions DO have JSONL transcripts because the underlying CLI writes them via --output-format stream-json.", "type": "fact", "tags": ["claude-sdk", "sessions", "transcripts", "web-chat"], "created_at": "2026-02-10T03:17:00.347196+00:00", "updated_at": "2026-02-10T03:17:00.347196+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-fb475c85", "content": "The Claude Agent SDK (claude_agent_sdk) supports these Python hook types: UserPromptSubmit, PreToolUse, PostToolUse, PreCompact (with trigger: 'manual' | 'auto'), Stop, SubagentStop. It explicitly does NOT support SessionStart, SessionEnd, or Notification hooks. Hooks are registered via ClaudeAgentOptions(hooks={'PreCompact': [HookMatcher(matcher=None, hooks=[callback])]}).", "type": "fact", "tags": ["claude-sdk", "hooks", "web-chat"], "created_at": "2026-02-10T03:16:56.088116+00:00", "updated_at": "2026-02-10T03:16:56.088116+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-bc234065", "content": "Web UI useFiles.ts had getBaseUrl() returning http://hostname:60887 for HTTP connections, creating cross-origin requests that bypass the Vite proxy. This caused 'TypeError: Failed to fetch' when opening multiple files. Fix: always return '' (relative URLs) since Vite proxy is configured for /api→localhost:60887 in dev, and production serves both static+API on same origin. Multiple useCallback hooks (openFile, saveFile, expandProject, expandDir) had stale closure bugs from depending on openFiles/expandedDirs state. Fix: use useRef to track latest state and remove state from dependency arrays.", "type": "debugging", "tags": ["web-ui", "useFiles", "stale-closure", "cors", "debugging"], "created_at": "2026-02-10T02:58:12.398418+00:00", "updated_at": "2026-02-12T18:38:27.986719+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-822e34ff", "content": "Playwright tests for the gobby web UI: The Files page (useFiles.ts hook) now uses relative URLs through the Vite proxy (getBaseUrl returns ''). Use page.route('**/api/files/*') to intercept and mock API calls in tests. Navigation requires opening the sidebar first via .hamburger-button click, then clicking the .sidebar-item. The terminal-colors.spec.ts test is broken because it skips this step. Run Playwright tests from web/ directory: cd web && npx playwright test.", "type": "pattern", "tags": ["web-ui", "playwright", "testing"], "created_at": "2026-02-10T02:47:17.713217+00:00", "updated_at": "2026-02-10T02:58:26.595438+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-bf5a66c2", "content": "CodeMirror + Vite duplicate module crash: The web file editor's CodeMirror component crashes with 'Unrecognized extension value in extension set... multiple instances of @codemirror/state are loaded, breaking instanceof checks.' even though npm ls shows all @codemirror/state properly deduped to one version. The fix is adding resolve.dedupe to vite.config.ts: resolve: { dedupe: ['@codemirror/state', '@codemirror/view', '@codemirror/language'] }. This is a well-known Vite dev server issue where dependency pre-bundling creates separate module copies.", "type": "debugging", "tags": ["web-ui", "codemirror", "vite", "debugging"], "created_at": "2026-02-10T02:47:10.252217+00:00", "updated_at": "2026-02-10T02:47:10.252217+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-2095597f", "content": "After changing ~/.gobby/config.yaml (e.g., switching memory backend), the gobby daemon must be restarted with 'uv run gobby restart' to pick up the new configuration. Config changes are not hot-reloaded.", "type": "fact", "tags": "daemon,config,restart", "created_at": "2026-02-10T02:42:48.459768+00:00", "updated_at": "2026-02-10T02:42:48.459768+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-6b6f9fe6", "content": "InternalToolRegistry schema generation still produces type: 'string' for all parameters in MCP tool schemas (e.g., search_memories limit: int shows as type: string). The #7418 fix for get_tools_json_schema() with typing.get_type_hints() may not cover all code paths. Passing limit as string '5' causes 'slice indices must be integers' error at runtime.", "type": "fact", "tags": "bug,schema,mcp-proxy,InternalToolRegistry", "created_at": "2026-02-10T02:42:46.325325+00:00", "updated_at": "2026-02-10T02:42:46.325325+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-46d0f151", "content": "memu-py SDK was removed from gobby due to critical upstream bug: create_memory_item() missing resource_id parameter. Replaced with sqlite backend.", "type": "fact", "tags": "memory,memu,removal", "created_at": "2026-02-10T02:41:44.504868+00:00", "updated_at": "2026-02-10T02:41:44.504868+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-430eb283", "content": "Claude Agents SDK (claude_agent_sdk / ClaudeSDKClient) does not fire SessionStart hooks. This means the session-lifecycle workflow never initializes via on_session_start triggers — variables like enforce_tool_schema_check, unlocked_tools, and servers_listed are never set, so all on_before_tool enforcement (progressive disclosure, task-before-edit) is bypassed. The fix for dev mode is to use _find_project_root() to set the correct cwd in ChatSession.start(). For production, a UI project picker is needed to bootstrap the session before chatting.", "type": "fact", "tags": "agents-sdk,hooks,session-start,chat-session,enforcement", "created_at": "2026-02-09T04:02:23.943085+00:00", "updated_at": "2026-02-09T04:02:23.943085+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-b43447eb", "content": "Josh Wilhelmi is Gobby's creator and primary developer. He goes by Josh.", "type": "fact", "tags": "identity, creator, josh", "created_at": "2026-02-09T01:52:28.946058+00:00", "updated_at": "2026-02-09T01:52:28.946058+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-78b3b992", "content": "Step and pipeline workflows do not replace lifecycle workflows: they run concurrently. The primary difference between the workflow types is that you can have multiple lifecycle workflows running in a session but only one step or one pipeline workflow active at a time in a session.", "type": "fact", "tags": "workflows, lifecycle, step, pipeline, concurrency", "created_at": "2026-02-06T16:17:35.575620+00:00", "updated_at": "2026-02-06T16:17:35.575620+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-8f0bc4be", "content": "We don't do workarounds, we log and fix bugs. When encountering a bug, document it and fix it rather than working around it.", "type": "preference", "tags": "development,bugs,workflow", "created_at": "2026-02-05T02:09:03.761109+00:00", "updated_at": "2026-02-05T02:09:03.761109+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-cbd103cd", "content": "When updating gobby's version number, update it in TWO places: pyproject.toml and src/gobby/__init__.py", "type": "pattern", "tags": "release,versioning,development", "created_at": "2026-02-05T00:41:11.939039+00:00", "updated_at": "2026-02-05T00:41:11.939039+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-2e8d0b10", "content": "Workflow activation on a session is persistent and requires explicit deactivation/ending via hook_dispatcher.py before the session can cleanly stop - accidental workflow activation can block session exit.", "type": "pattern", "tags": ["workflow-lifecycle", "session-management", "debugging"], "created_at": "2026-01-28T20:38:12.091482+00:00", "updated_at": "2026-01-28T20:38:12.091482+00:00", "source": "session", "source_id": "8cc46e99-2e03-41f8-ba7e-7ad372450e56"}
{"id": "mm-f3c42990", "content": "When debugging gobby agent spawns, check: (1) session transcripts via gobby-sessions tools—empty transcript means agent never ran, (2) agent run records via agent runs queries, (3) gobby.log for 'Invalid JSON at line 0' warnings in transcript parsing. Silent failures can occur where spawn claims success but no Ghostty launches and no agent registers.", "type": "pattern", "tags": ["gobby", "debugging", "troubleshooting", "spawn_agent", "validation"], "created_at": "2026-01-28T20:27:23.836631+00:00", "updated_at": "2026-01-28T20:27:23.836631+00:00", "source": "session", "source_id": "d347d68e-869d-4a6e-a8d5-8fe855bba25e"}
{"id": "mm-fda429ea", "content": "gobby's spawn_agent tool uses a preflight capture pattern via prepare_gemini_spawn_with_preflight to obtain a Gemini session_id before launching the terminal. The preflight succeeds (capturing session_id in format that becomes run_id like 'gemini-{first8chars}'), but subsequent terminal spawn via 'open -na Ghostty.app' can fail silently—the macOS 'open' utility returns success even if Ghostty fails to execute the command afterward, making shell escaping of long prompts a potential failure point.", "type": "context", "tags": ["gobby", "spawn_agent", "gemini", "terminal_spawn", "preflight", "failure_mode"], "created_at": "2026-01-28T20:27:23.834828+00:00", "updated_at": "2026-01-28T20:27:23.834828+00:00", "source": "session", "source_id": "d347d68e-869d-4a6e-a8d5-8fe855bba25e"}
{"id": "mm-a028f56e", "content": "Gobby has migrated to database schema v75 as baseline minimum. Legacy migrations (versions 0-75) are from migrations_legacy.py, while new migrations v76+ go in MIGRATIONS list. run_migrations rejects versions below v75, and docstrings should reference v75+ not v60+.", "type": "fact", "tags": ["database", "migrations", "schema-version"], "created_at": "2026-01-28T03:41:22.372041+00:00", "updated_at": "2026-01-28T03:41:22.372041+00:00", "source": "session", "source_id": "740c4be1-cfcc-4aa0-ab30-7a088d85d22d"}
{"id": "mm-3dcf766c", "content": "Prompt file creation in prompt_manager.py requires: (1) sanitize session_id to prevent path traversal by stripping separators/disallowed chars or using uuid4, (2) use thread-safe lock (_atexit_lock) around _atexit_registered check to prevent race conditions in atexit registration, (3) store safe path in _prompt_files_to_cleanup for cleanup on exit.", "type": "pattern", "tags": ["security", "path-traversal", "thread-safety", "prompt-manager"], "created_at": "2026-01-27T22:52:38.926303+00:00", "updated_at": "2026-01-27T22:52:38.926303+00:00", "source": "session", "source_id": "935114fe-ccaa-4dfc-8f95-99956c976c4f"}
{"id": "mm-eed85876", "content": "Migration 77 has a UNIQUE constraint issue on seq_num that requires clearing values to NULL before reassigning to avoid violations. This is a known gotcha when modifying sequence numbers in migrations.", "type": "context", "tags": ["migration", "database", "constraints", "gobby"], "created_at": "2026-01-27T01:29:58.428788+00:00", "updated_at": "2026-01-27T01:29:58.428788+00:00", "source": "session", "source_id": "2bc8895b-b292-4b81-acfc-180c276ca5cd"}
{"id": "mm-bf7a7539", "content": "The gobby project has a pre-merge-commit hook that blocks automatic merge commits. When merging branches, if the hook fails, manually commit the merge using 'git commit' rather than relying on automatic merge commit creation.", "type": "pattern", "tags": ["git", "merge", "pre-commit-hook", "gobby"], "created_at": "2026-01-26T22:59:23.544337+00:00", "updated_at": "2026-01-26T22:59:23.544337+00:00", "source": "session", "source_id": "b422c481-ba1d-44da-8912-666de487efbf"}
{"id": "mm-d2d969c7", "content": "Task lifecycle tools in _lifecycle.py must return success: False on errors so that _process_tool_proxy_result can correctly identify and handle task failures. Returning success: true with an error is a bug that masks failures.", "type": "fact", "tags": ["architecture", "error-handling", "_lifecycle.py", "_process_tool_proxy_result"], "created_at": "2026-01-26T22:56:14.015774+00:00", "updated_at": "2026-01-26T22:56:14.015774+00:00", "source": "session", "source_id": "b422c481-ba1d-44da-8912-666de487efbf"}
{"id": "mm-2e8319e2", "content": "In gobby's conductor module, pricing.py and token_tracker.py are intentionally placed in conductor/ (not a separate metrics/ module) because they are active control plane components that drive orchestration decisions, not passive observability. SessionTokenTracker.can_spawn_agent() gates agent spawning based on budget, and ConductorLoop uses BudgetChecker to throttle the loop when budget is exceeded.", "type": "fact", "tags": ["architecture", "conductor", "budget-management", "cost-control"], "created_at": "2026-01-26T21:16:57.260247+00:00", "updated_at": "2026-01-26T21:16:57.260247+00:00", "source": "session", "source_id": "9ef8d770-7c10-4f8e-800a-a7c749644689"}
{"id": "mm-79c16332", "content": "Step workflows in gobby require explicit activation via activate_workflow() call before steps execute. The on_enter hook only runs after activation, not immediately when a child agent is spawned. Parent workflows (like meeseeks-box) must include activation instructions in the spawn prompt.", "type": "pattern", "tags": ["workflows", "meeseeks", "lifecycle", "parent-child"], "created_at": "2026-01-26T14:25:46.470795+00:00", "updated_at": "2026-01-26T14:25:46.470795+00:00", "source": "session", "source_id": "4cb1f535-45d0-476c-92e1-5c11a06e1ef2"}
{"id": "mm-874484a3", "content": "Terminal mode spawning (mode='terminal') should not use -p flag to allow multi-turn interaction. The -p flag causes single-turn exit and is only appropriate for headless spawning. This was a critical fix in spawn.py.", "type": "pattern", "tags": ["spawn", "terminal-mode", "claude-integration"], "created_at": "2026-01-26T14:25:01.562910+00:00", "updated_at": "2026-01-26T14:25:01.562910+00:00", "source": "session", "source_id": "4cb1f535-45d0-476c-92e1-5c11a06e1ef2"}
{"id": "mm-30645c7e", "content": "Gobby uses ~/.gobby/ directory for its database (gobby-hub.db), config (config.yaml), and other runtime files. When running different versions of gobby, they share this directory and database, which can cause schema compatibility issues. Use GOBBY_HOME environment variable to isolate different gobby instances if needed.", "type": "fact", "tags": ["gobby", "database", "configuration", "environment"], "created_at": "2026-01-25T23:52:00.971538+00:00", "updated_at": "2026-01-25T23:52:00.971538+00:00", "source": "session", "source_id": "2ceaa340-cf01-4208-80b8-dcc482c3992c"}
{"id": "mm-052d36a2", "content": "In gobby's logging configuration, setup_file_logging() sets propagate=False on the gobby package logger to prevent duplicate logs. This breaks pytest's caplog fixture because caplog captures via root logger handlers and depends on propagation. Tests need either a fixture enabling propagate=True during test execution, or should avoid using caplog.at_level(logger='gobby.utils.git') in favor of capturing all logs.", "type": "context", "tags": ["logging", "testing", "caplog", "pytest", "gobby-logger-config"], "created_at": "2026-01-25T20:04:09.517652+00:00", "updated_at": "2026-01-25T20:04:09.517652+00:00", "source": "session", "source_id": "4042c9be-18da-4d31-9039-027a93af8c78"}
{"id": "mm-2bb6bfa4", "content": "LocalTaskManager.get_task() in src/gobby/storage/tasks/_manager.py accepts multiple task ID formats (UUID, #N, N notation) and resolves them internally, but direct comparisons between task.id (UUID) and claimed_task_id values fail if claimed_task_id stores non-UUID formats.", "type": "fact", "tags": ["gobby", "task-management", "id-formats", "bug-pattern"], "created_at": "2026-01-25T18:32:33.161333+00:00", "updated_at": "2026-01-25T18:32:33.161333+00:00", "source": "session", "source_id": "3fe55f9e-069d-470f-ab2f-03ceaf53a6b0"}
{"id": "mm-1a26cb0a", "content": "Task ID comparison bugs exist at _lifecycle.py:199 (claimed_task_id == resolved_id) and task_enforcement_actions.py:963 (t.id == claimed_task_id). These fail when claimed_task_id contains refs like '#6066' instead of UUIDs. Fix: ensure claimed_task_id always stores resolved UUIDs at storage time.", "type": "context", "tags": ["gobby", "bug-location", "task-ids", "comparison"], "created_at": "2026-01-25T18:19:24.504439+00:00", "updated_at": "2026-01-25T18:19:24.504439+00:00", "source": "session", "source_id": "3fe55f9e-069d-470f-ab2f-03ceaf53a6b0"}
{"id": "mm-3860c4e5", "content": "Claude Code doesn't include tool_result in post-tool-use hooks, causing detection_helpers.py to receive empty tool_output dicts. This breaks error detection in detect_task_claim for close_task validation - when close_task fails validation (e.g., 'no_commits_linked'), the empty tool_output passes all error checks and incorrectly clears task_claimed=False.", "type": "fact", "tags": ["claude-code-limitation", "detection_helpers", "close_task", "task_claimed", "bug-root-cause"], "created_at": "2026-01-25T17:15:06.972227+00:00", "updated_at": "2026-01-25T17:15:06.972227+00:00", "source": "session", "source_id": "b08118fe-cfa2-4c04-b92a-d381c05e7eda"}
{"id": "mm-099c9ea0", "content": "In gobby's detection_helpers.py, when handling close_task in the AFTER_TOOL hook (lines 67-81), the function should NOT clear task_claimed if tool_output is empty, since it cannot verify whether the close actually succeeded. The MCP proxy's close_task handles clearing task_claimed for genuine successes.", "type": "pattern", "tags": ["detection_helpers", "close_task", "task_claimed", "fix-strategy"], "created_at": "2026-01-25T17:14:28.200002+00:00", "updated_at": "2026-01-25T17:14:28.200002+00:00", "source": "session", "source_id": "b08118fe-cfa2-4c04-b92a-d381c05e7eda"}
{"id": "mm-7b530aea", "content": "The gobby MCP proxy's close_task function has validation checks (validate_commit_requirements) that return errors BEFORE the code that clears task_claimed state (lines 192-207). So the proxy itself doesn't clear task_claimed on validation failures - only on actual successful closes.", "type": "fact", "tags": ["_lifecycle.py", "close_task", "state-management", "validation-flow"], "created_at": "2026-01-25T17:14:28.199456+00:00", "updated_at": "2026-01-25T17:14:28.199456+00:00", "source": "session", "source_id": "b08118fe-cfa2-4c04-b92a-d381c05e7eda"}
{"id": "mm-04676fa3", "content": "The _LazyBool class in task_enforcement_actions.py lacks __eq__ and __ne__ operators, causing expressions like 'session_has_dirty_files == False' to skip thunk evaluation. Add __eq__(self, other) and __ne__(self, other) methods that coerce self to bool via bool(self) before comparison to ensure lazy evaluation is triggered and comparisons return correct True/False semantics.", "type": "pattern", "tags": ["lazy-evaluation", "task-enforcement", "operator-overloading", "python-semantics"], "created_at": "2026-01-25T16:54:00.257505+00:00", "updated_at": "2026-01-25T16:54:00.257505+00:00", "source": "session", "source_id": "389037ea-8953-4e4f-bcb4-29c5dc468357"}
{"id": "mm-0dc68d2a", "content": "The _normalize_timestamp() function in sync/tasks.py should treat empty string as None (return None if ts == ''), and use regex pattern matching (e.g., r'Z|[+-]\\d{2}:\\d{2}$') to detect RFC3339 timezone suffixes instead of brittle slice checks. Only append 'Z' when the pattern does not match the timestamp suffix.", "type": "pattern", "tags": ["timestamp-handling", "iso8601", "sync", "task-export", "regex-validation"], "created_at": "2026-01-25T04:38:01.653774+00:00", "updated_at": "2026-01-25T04:38:01.653774+00:00", "source": "session", "source_id": "389037ea-8953-4e4f-bcb4-29c5dc468357"}
{"id": "mm-f4d2816d", "content": "Memory exports in gobby should sanitize user home paths by replacing absolute paths with '~' using _sanitize_content() method (src/gobby/sync/memories.py) to avoid exposing user-specific paths.", "type": "pattern", "tags": ["gobby", "memory-export", "path-sanitization", "privacy"], "created_at": "2026-01-25T04:17:24.127397+00:00", "updated_at": "2026-01-25T04:17:24.127397+00:00", "source": "session", "source_id": "c9787d92-bd8e-4fcc-a158-05af9147f470"}
{"id": "mm-41a61c2a", "content": "Memory ID generation in gobby uses '||' delimiter between content and project_id to prevent collisions (e.g., 'abc'+'def' vs 'abcd'+'ef'). This is implemented in src/gobby/storage/memories.py.", "type": "fact", "tags": ["gobby", "memory-system", "id-generation", "collision-prevention"], "created_at": "2026-01-25T04:17:24.123650+00:00", "updated_at": "2026-01-25T04:17:24.123650+00:00", "source": "session", "source_id": "c9787d92-bd8e-4fcc-a158-05af9147f470"}
{"id": "mm-28d8d578", "content": "Test fixtures in gobby: protect_production_resources fixture patches load_config in already-imported modules (e.g., gobby.runner, gobby.mcp_proxy.stdio) to use safe_load_config with test DB paths. Must be added to test signature to ensure safe DB is used when instantiating GobbyRunner.", "type": "fact", "tags": ["testing", "fixtures", "safety"], "created_at": "2026-01-25T04:04:50.334561+00:00", "updated_at": "2026-01-25T04:04:50.334561+00:00", "source": "session", "source_id": "90eefa0c-bedd-4489-bcd4-df7bf8a3cc6b"}
{"id": "mm-3f91e1c8", "content": "The _is_plan_file() function in task_enforcement_actions.py should explicitly check `if source != \"claude\"` rather than `if source and source != \"claude\"` to enforce that a source value must be present and not 'claude'. This prevents plan files from being processed without explicit source attribution.", "type": "pattern", "tags": ["validation", "task-enforcement", "source-attribution"], "created_at": "2026-01-25T04:02:56.263283+00:00", "updated_at": "2026-01-25T04:02:56.263283+00:00", "source": "session", "source_id": "1a867b59-ad3d-4075-9020-6293616fbeb2"}
{"id": "mm-9a411c25", "content": "The gobby project uses SQLite with custom datetime adapters. The `_adapt_datetime` function in `database.py` (line 24) uses `isoformat(\" \")` which produces space-separated timestamps like \"2026-01-25 01:43:54\" instead of ISO 8601 standard \"2026-01-25T01:43:54\". This non-standard format can cause timestamp normalization issues in exported JSONL files.", "type": "fact", "tags": ["database", "datetime", "sqlite", "bug-source"], "created_at": "2026-01-25T03:59:31.178992+00:00", "updated_at": "2026-01-25T03:59:31.178992+00:00", "source": "session", "source_id": "8dfb36ae-572d-4a12-a667-0e710b658a2d"}
