{"id": "mm-b43447eb", "content": "Josh Wilhelmi is Gobby's creator and primary developer. He goes by Josh.", "type": "fact", "importance": 0.9, "tags": "identity, creator, josh", "created_at": "2026-02-09T01:52:28.946058+00:00", "updated_at": "2026-02-09T01:52:28.946058+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-78b3b992", "content": "Step and pipeline workflows do not replace lifecycle workflows: they run concurrently. The primary difference between the workflow types is that you can have multiple lifecycle workflows running in a session but only one step or one pipeline workflow active at a time in a session.", "type": "fact", "importance": 0.9, "tags": "workflows, lifecycle, step, pipeline, concurrency", "created_at": "2026-02-06T16:17:35.575620+00:00", "updated_at": "2026-02-06T16:17:35.575620+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-90e1218d", "content": "Session detail endpoint GET /sessions/{id} returns session.to_dict() which does NOT include computed fields like message_count. The list endpoint GET /sessions enriches with message_count from session_messages table. Any new computed fields must be added to both endpoints. Fixed in sessions.py by adding get_all_counts() enrichment to the detail endpoint.", "type": "pattern", "importance": 8.0, "tags": ["web-ui", "sessions", "api", "backend"], "created_at": "2026-02-11T16:36:35.130284+00:00", "updated_at": "2026-02-11T16:36:35.130284+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-98ef118d", "content": "Gobby web frontend is at /web/ (React 18 + TypeScript + Vite). Single CSS file at web/src/styles/index.css (~196KB). Components in web/src/components/, hooks in web/src/hooks/. API proxy to daemon on localhost:60887, WebSocket on localhost:60888.", "type": "fact", "importance": 7.0, "tags": ["web-ui", "frontend", "architecture"], "created_at": "2026-02-11T16:36:06.188022+00:00", "updated_at": "2026-02-11T16:36:06.188022+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-6d8d6a6e", "content": "The _personal project name is mapped to 'Personal' in App.tsx (line 86). This causes UI confusion when components use project names as labels - any toggle or display showing 'Personal' may collide with the _personal project name. The ChatInput scope toggle was redesigned to use fixed 'Personal'/'Project' labels with a search dropdown instead of showing project names directly.", "type": "pattern", "importance": 6.0, "tags": ["web-ui", "projects", "gotcha"], "created_at": "2026-02-11T16:36:54.327240+00:00", "updated_at": "2026-02-11T16:36:54.327240+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-0c61bd9e", "content": "Bug: RegistryContext in src/gobby/mcp_proxy/tools/tasks/_context.py line 123 had self.db instead of self.task_manager.db. RegistryContext has no db attribute - it accesses the database through task_manager.db (see __post_init__ line 59). This broke any gobby-tasks MCP tool that calls resolve_project_filter (list_tasks, save_expansion_spec, etc). Fixed in commit 70a74b4d.", "type": "debugging", "importance": 2.0, "tags": ["bug", "mcp-proxy", "tasks", "registry-context"], "created_at": "2026-02-11T18:02:15.762293+00:00", "updated_at": "2026-02-11T18:02:15.762293+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-8f0bc4be", "content": "We don't do workarounds, we log and fix bugs. When encountering a bug, document it and fix it rather than working around it.", "type": "preference", "importance": 1.0, "tags": "development,bugs,workflow", "created_at": "2026-02-05T02:09:03.761109+00:00", "updated_at": "2026-02-05T02:09:03.761109+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-430eb283", "content": "Claude Agents SDK (claude_agent_sdk / ClaudeSDKClient) does not fire SessionStart hooks. This means the session-lifecycle workflow never initializes via on_session_start triggers — variables like enforce_tool_schema_check, unlocked_tools, and servers_listed are never set, so all on_before_tool enforcement (progressive disclosure, task-before-edit) is bypassed. The fix for dev mode is to use _find_project_root() to set the correct cwd in ChatSession.start(). For production, a UI project picker is needed to bootstrap the session before chatting.", "type": "fact", "importance": 0.95, "tags": "agents-sdk,hooks,session-start,chat-session,enforcement", "created_at": "2026-02-09T04:02:23.943085+00:00", "updated_at": "2026-02-09T04:02:23.943085+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-052d36a2", "content": "In gobby's logging configuration, setup_file_logging() sets propagate=False on the gobby package logger to prevent duplicate logs. This breaks pytest's caplog fixture because caplog captures via root logger handlers and depends on propagation. Tests need either a fixture enabling propagate=True during test execution, or should avoid using caplog.at_level(logger='gobby.utils.git') in favor of capturing all logs.", "type": "context", "importance": 0.95, "tags": ["logging", "testing", "caplog", "pytest", "gobby-logger-config"], "created_at": "2026-01-25T20:04:09.517652+00:00", "updated_at": "2026-01-25T20:04:09.517652+00:00", "source": "session", "source_id": "4042c9be-18da-4d31-9039-027a93af8c78"}
{"id": "mm-3860c4e5", "content": "Claude Code doesn't include tool_result in post-tool-use hooks, causing detection_helpers.py to receive empty tool_output dicts. This breaks error detection in detect_task_claim for close_task validation - when close_task fails validation (e.g., 'no_commits_linked'), the empty tool_output passes all error checks and incorrectly clears task_claimed=False.", "type": "fact", "importance": 0.95, "tags": ["claude-code-limitation", "detection_helpers", "close_task", "task_claimed", "bug-root-cause"], "created_at": "2026-01-25T17:15:06.972227+00:00", "updated_at": "2026-01-25T17:15:06.972227+00:00", "source": "session", "source_id": "b08118fe-cfa2-4c04-b92a-d381c05e7eda"}
{"id": "mm-1e9e86e7", "content": "Plans should not have open questions or unresolved options. Settle all decisions before presenting a plan for approval. Josh doesn't like being asked to choose between options at the end — resolve them during the planning discussion.", "type": "preference", "importance": 0.9, "tags": ["planning", "workflow", "preference"], "created_at": "2026-02-11T17:21:48.375243+00:00", "updated_at": "2026-02-11T17:21:48.375243+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-52b47f5b", "content": "Bug in memory_review_gate: The MCP set_variable tool's value param is typed as string, so setting value=\"false\" stores the string \"false\" which is truthy in Python. The YAML condition `variables.get('pending_memory_review')` evaluates string \"false\" as True. Fix: either make set_variable coerce \"true\"/\"false\" strings to booleans, or change the gate condition to check `variables.get('pending_memory_review') == True` or `is True`. Also, on_after_tool resets stop_attempts to 0 on every tool call, which means the 3-strike escape hatch can never trigger if the agent keeps calling tools to try to clear the variable.", "type": "pattern", "importance": 0.9, "tags": ["bug", "memory-system", "workflow-engine", "set_variable"], "created_at": "2026-02-11T15:09:03.518439+00:00", "updated_at": "2026-02-11T15:09:03.518439+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-880f7f6b", "content": "BASELINE_VERSION in migrations.py must NOT be bumped when adding new migrations. It represents the flattened schema version (v81) for new databases only. Existing databases run migrations incrementally. Bumping it rejects existing databases that are between old and new baseline. Instead: add changes to MIGRATIONS list only. The baseline schema can optionally include new columns/inserts for cleanliness, but BASELINE_VERSION stays at 81. Also: SQLite doesn't support ALTER TABLE ADD COLUMN IF NOT EXISTS, so use a callable migration that checks PRAGMA table_info first.", "type": "pattern", "importance": 0.9, "tags": ["migrations", "sqlite", "gotcha"], "created_at": "2026-02-10T07:26:20.064161+00:00", "updated_at": "2026-02-10T07:26:20.064161+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-f7fa2e99", "content": "Architecture decision: For web UI chat sessions that lack SessionStart hooks, use a 'headless-lifecycle.yaml' workflow (separate from session-lifecycle.yaml) that moves all session_start initialization into on_before_agent with a _session_initialized guard variable. Backend (ChatMixin) handles session DB registration, lifecycle activation, and /clear. SDK hooks bridge to the workflow engine via callbacks. Plan at docs/plans/web-chat-lifecycle.md.", "type": "decision", "importance": 0.9, "tags": ["architecture", "web-chat", "lifecycle", "headless"], "created_at": "2026-02-10T03:17:03.573659+00:00", "updated_at": "2026-02-10T03:17:03.573659+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-fb475c85", "content": "The Claude Agent SDK (claude_agent_sdk) supports these Python hook types: UserPromptSubmit, PreToolUse, PostToolUse, PreCompact (with trigger: 'manual' | 'auto'), Stop, SubagentStop. It explicitly does NOT support SessionStart, SessionEnd, or Notification hooks. Hooks are registered via ClaudeAgentOptions(hooks={'PreCompact': [HookMatcher(matcher=None, hooks=[callback])]}).", "type": "fact", "importance": 0.9, "tags": ["claude-sdk", "hooks", "web-chat"], "created_at": "2026-02-10T03:16:56.088116+00:00", "updated_at": "2026-02-10T03:16:56.088116+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-bc234065", "content": "Web UI useFiles.ts had getBaseUrl() returning http://hostname:60887 for HTTP connections, creating cross-origin requests that bypass the Vite proxy. This caused 'TypeError: Failed to fetch' when opening multiple files. Fix: always return '' (relative URLs) since Vite proxy is configured for /api→localhost:60887 in dev, and production serves both static+API on same origin. Multiple useCallback hooks (openFile, saveFile, expandProject, expandDir) had stale closure bugs from depending on openFiles/expandedDirs state. Fix: use useRef to track latest state and remove state from dependency arrays.", "type": "debugging", "importance": 0.9, "tags": ["web-ui", "useFiles", "stale-closure", "cors", "debugging"], "created_at": "2026-02-10T02:58:12.398418+00:00", "updated_at": "2026-02-10T02:58:12.398418+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-cbd103cd", "content": "When updating gobby's version number, update it in TWO places: pyproject.toml and src/gobby/__init__.py", "type": "pattern", "importance": 0.9, "tags": "release,versioning,development", "created_at": "2026-02-05T00:41:11.939039+00:00", "updated_at": "2026-02-05T00:41:11.939039+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-bf7a7539", "content": "The gobby project has a pre-merge-commit hook that blocks automatic merge commits. When merging branches, if the hook fails, manually commit the merge using 'git commit' rather than relying on automatic merge commit creation.", "type": "pattern", "importance": 0.9, "tags": ["git", "merge", "pre-commit-hook", "gobby"], "created_at": "2026-01-26T22:59:23.544337+00:00", "updated_at": "2026-01-26T22:59:23.544337+00:00", "source": "session", "source_id": "b422c481-ba1d-44da-8912-666de487efbf"}
{"id": "mm-2e8319e2", "content": "In gobby's conductor module, pricing.py and token_tracker.py are intentionally placed in conductor/ (not a separate metrics/ module) because they are active control plane components that drive orchestration decisions, not passive observability. SessionTokenTracker.can_spawn_agent() gates agent spawning based on budget, and ConductorLoop uses BudgetChecker to throttle the loop when budget is exceeded.", "type": "fact", "importance": 0.9, "tags": ["architecture", "conductor", "budget-management", "cost-control"], "created_at": "2026-01-26T21:16:57.260247+00:00", "updated_at": "2026-01-26T21:16:57.260247+00:00", "source": "session", "source_id": "9ef8d770-7c10-4f8e-800a-a7c749644689"}
{"id": "mm-79c16332", "content": "Step workflows in gobby require explicit activation via activate_workflow() call before steps execute. The on_enter hook only runs after activation, not immediately when a child agent is spawned. Parent workflows (like meeseeks-box) must include activation instructions in the spawn prompt.", "type": "pattern", "importance": 0.9, "tags": ["workflows", "meeseeks", "lifecycle", "parent-child"], "created_at": "2026-01-26T14:25:46.470795+00:00", "updated_at": "2026-01-26T14:25:46.470795+00:00", "source": "session", "source_id": "4cb1f535-45d0-476c-92e1-5c11a06e1ef2"}
{"id": "mm-30645c7e", "content": "Gobby uses ~/.gobby/ directory for its database (gobby-hub.db), config (config.yaml), and other runtime files. When running different versions of gobby, they share this directory and database, which can cause schema compatibility issues. Use GOBBY_HOME environment variable to isolate different gobby instances if needed.", "type": "fact", "importance": 0.9, "tags": ["gobby", "database", "configuration", "environment"], "created_at": "2026-01-25T23:52:00.971538+00:00", "updated_at": "2026-01-25T23:52:00.971538+00:00", "source": "session", "source_id": "2ceaa340-cf01-4208-80b8-dcc482c3992c"}
{"id": "mm-2bb6bfa4", "content": "LocalTaskManager.get_task() in src/gobby/storage/tasks/_manager.py accepts multiple task ID formats (UUID, #N, N notation) and resolves them internally, but direct comparisons between task.id (UUID) and claimed_task_id values fail if claimed_task_id stores non-UUID formats.", "type": "fact", "importance": 0.9, "tags": ["gobby", "task-management", "id-formats", "bug-pattern"], "created_at": "2026-01-25T18:32:33.161333+00:00", "updated_at": "2026-01-25T18:32:33.161333+00:00", "source": "session", "source_id": "3fe55f9e-069d-470f-ab2f-03ceaf53a6b0"}
{"id": "mm-1a26cb0a", "content": "Task ID comparison bugs exist at _lifecycle.py:199 (claimed_task_id == resolved_id) and task_enforcement_actions.py:963 (t.id == claimed_task_id). These fail when claimed_task_id contains refs like '#6066' instead of UUIDs. Fix: ensure claimed_task_id always stores resolved UUIDs at storage time.", "type": "context", "importance": 0.9, "tags": ["gobby", "bug-location", "task-ids", "comparison"], "created_at": "2026-01-25T18:19:24.504439+00:00", "updated_at": "2026-01-25T18:19:24.504439+00:00", "source": "session", "source_id": "3fe55f9e-069d-470f-ab2f-03ceaf53a6b0"}
{"id": "mm-9a411c25", "content": "The gobby project uses SQLite with custom datetime adapters. The `_adapt_datetime` function in `database.py` (line 24) uses `isoformat(\" \")` which produces space-separated timestamps like \"2026-01-25 01:43:54\" instead of ISO 8601 standard \"2026-01-25T01:43:54\". This non-standard format can cause timestamp normalization issues in exported JSONL files.", "type": "fact", "importance": 0.9, "tags": ["database", "datetime", "sqlite", "bug-source"], "created_at": "2026-01-25T03:59:31.178992+00:00", "updated_at": "2026-01-25T03:59:31.178992+00:00", "source": "session", "source_id": "8dfb36ae-572d-4a12-a667-0e710b658a2d"}
{"id": "mm-8157dc3e", "content": "A pre-tool-use hook error in the file path '~/Projects/gobby/.claude/hooks/hook_dispatcher.py' caused a tool to be blocked, and feedback suggests not stopping despite the error.", "type": "fact", "importance": 0.85, "tags": ["hook error", "tool blockage", "debugging"], "created_at": "2026-02-11T15:47:22.636635+00:00", "updated_at": "2026-02-11T15:47:22.636635+00:00", "source": "session", "source_id": "a8cbfde2-f52a-44bb-9dbf-23cdb75b7401"}
{"id": "mm-74ae00c8", "content": "A pre-tool-use hook error in the file path '~/Projects/gobby/.claude/hooks/hook_dispatcher.py' caused a tool to be blocked, and feedback suggests not stopping despite the error.", "type": "fact", "importance": 0.85, "tags": ["hook error", "tool blockage", "debugging"], "created_at": "2026-02-11T15:21:29.992628+00:00", "updated_at": "2026-02-11T15:21:29.992628+00:00", "source": "session", "source_id": "a8cbfde2-f52a-44bb-9dbf-23cdb75b7401"}
{"id": "mm-f51d4e1a", "content": "Self-hosted mem0 Docker API uses different paths than the hosted platform: /memories and /search (no /v1/ prefix, no trailing slashes). The Mem0Client auto-detects by checking if 'api.mem0.ai' is in the base_url. Response format uses 'memory' field instead of 'content'. The mem0 Docker instance runs on port 8888 with postgres on 8432 and neo4j on 8474/8687.", "type": "fact", "importance": 0.85, "tags": ["mem0", "docker", "api-paths", "self-hosted"], "created_at": "2026-02-11T02:02:10.649543+00:00", "updated_at": "2026-02-11T02:02:10.649543+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-2418f3f8", "content": "The Claude Agent SDK has resume and fork_session options: ClaudeAgentOptions(resume='<session-uuid>', fork_session=False). The SDK wraps the Claude CLI binary and passes --resume <session_id> to it. Claude Code manages JSONL transcripts at ~/.claude/sessions/<session-id>/. Web chat sessions DO have JSONL transcripts because the underlying CLI writes them via --output-format stream-json.", "type": "fact", "importance": 0.85, "tags": ["claude-sdk", "sessions", "transcripts", "web-chat"], "created_at": "2026-02-10T03:17:00.347196+00:00", "updated_at": "2026-02-10T03:17:00.347196+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-6b6f9fe6", "content": "InternalToolRegistry schema generation still produces type: 'string' for all parameters in MCP tool schemas (e.g., search_memories limit: int shows as type: string). The #7418 fix for get_tools_json_schema() with typing.get_type_hints() may not cover all code paths. Passing limit as string '5' causes 'slice indices must be integers' error at runtime.", "type": "fact", "importance": 0.85, "tags": "bug,schema,mcp-proxy,InternalToolRegistry", "created_at": "2026-02-10T02:42:46.325325+00:00", "updated_at": "2026-02-10T02:42:46.325325+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-fda429ea", "content": "gobby's spawn_agent tool uses a preflight capture pattern via prepare_gemini_spawn_with_preflight to obtain a Gemini session_id before launching the terminal. The preflight succeeds (capturing session_id in format that becomes run_id like 'gemini-{first8chars}'), but subsequent terminal spawn via 'open -na Ghostty.app' can fail silently—the macOS 'open' utility returns success even if Ghostty fails to execute the command afterward, making shell escaping of long prompts a potential failure point.", "type": "context", "importance": 0.85, "tags": ["gobby", "spawn_agent", "gemini", "terminal_spawn", "preflight", "failure_mode"], "created_at": "2026-01-28T20:27:23.834828+00:00", "updated_at": "2026-01-28T20:27:23.834828+00:00", "source": "session", "source_id": "d347d68e-869d-4a6e-a8d5-8fe855bba25e"}
{"id": "mm-3dcf766c", "content": "Prompt file creation in prompt_manager.py requires: (1) sanitize session_id to prevent path traversal by stripping separators/disallowed chars or using uuid4, (2) use thread-safe lock (_atexit_lock) around _atexit_registered check to prevent race conditions in atexit registration, (3) store safe path in _prompt_files_to_cleanup for cleanup on exit.", "type": "pattern", "importance": 0.85, "tags": ["security", "path-traversal", "thread-safety", "prompt-manager"], "created_at": "2026-01-27T22:52:38.926303+00:00", "updated_at": "2026-01-27T22:52:38.926303+00:00", "source": "session", "source_id": "935114fe-ccaa-4dfc-8f95-99956c976c4f"}
{"id": "mm-d2d969c7", "content": "Task lifecycle tools in _lifecycle.py must return success: False on errors so that _process_tool_proxy_result can correctly identify and handle task failures. Returning success: true with an error is a bug that masks failures.", "type": "fact", "importance": 0.85, "tags": ["architecture", "error-handling", "_lifecycle.py", "_process_tool_proxy_result"], "created_at": "2026-01-26T22:56:14.015774+00:00", "updated_at": "2026-01-26T22:56:14.015774+00:00", "source": "session", "source_id": "b422c481-ba1d-44da-8912-666de487efbf"}
{"id": "mm-874484a3", "content": "Terminal mode spawning (mode='terminal') should not use -p flag to allow multi-turn interaction. The -p flag causes single-turn exit and is only appropriate for headless spawning. This was a critical fix in spawn.py.", "type": "pattern", "importance": 0.85, "tags": ["spawn", "terminal-mode", "claude-integration"], "created_at": "2026-01-26T14:25:01.562910+00:00", "updated_at": "2026-01-26T14:25:01.562910+00:00", "source": "session", "source_id": "4cb1f535-45d0-476c-92e1-5c11a06e1ef2"}
{"id": "mm-099c9ea0", "content": "In gobby's detection_helpers.py, when handling close_task in the AFTER_TOOL hook (lines 67-81), the function should NOT clear task_claimed if tool_output is empty, since it cannot verify whether the close actually succeeded. The MCP proxy's close_task handles clearing task_claimed for genuine successes.", "type": "pattern", "importance": 0.85, "tags": ["detection_helpers", "close_task", "task_claimed", "fix-strategy"], "created_at": "2026-01-25T17:14:28.200002+00:00", "updated_at": "2026-01-25T17:14:28.200002+00:00", "source": "session", "source_id": "b08118fe-cfa2-4c04-b92a-d381c05e7eda"}
{"id": "mm-7b530aea", "content": "The gobby MCP proxy's close_task function has validation checks (validate_commit_requirements) that return errors BEFORE the code that clears task_claimed state (lines 192-207). So the proxy itself doesn't clear task_claimed on validation failures - only on actual successful closes.", "type": "fact", "importance": 0.85, "tags": ["_lifecycle.py", "close_task", "state-management", "validation-flow"], "created_at": "2026-01-25T17:14:28.199456+00:00", "updated_at": "2026-01-25T17:14:28.199456+00:00", "source": "session", "source_id": "b08118fe-cfa2-4c04-b92a-d381c05e7eda"}
{"id": "mm-c6599f32", "content": "Workflow engine has two evaluators: ConditionEvaluator (eval-based, used by transitions/step rules/action when clauses) and SafeExpressionEvaluator (AST-based, used only by block_tools enforcement). Plan at docs/plans/workflow-engine-rules.md proposes unifying on the AST evaluator, adding named rule definitions with DB-backed three-tier inheritance, tool_rules shorthand, hybrid observer registry (YAML for simple, Python behaviors for complex like detect_task_claim), and simplified exit conditions.", "type": "architecture", "importance": 0.8, "tags": ["workflow-engine", "architecture", "evaluator", "rules"], "created_at": "2026-02-11T17:35:50.357886+00:00", "updated_at": "2026-02-11T17:35:50.357886+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-bc9ffa4e", "content": "Git timestamp timezone gotcha: When using git --since/--until with timestamps parsed from the database (which stores UTC with +00:00 offset), you MUST include the timezone offset in the formatted string (use %z). Without it, git interprets bare timestamps as local time, causing incorrect filtering. Also, session.jsonl_path parent (~/.claude/projects/...) is NOT a git repo — use project.repo_path from the projects table instead.", "type": "insight", "importance": 0.8, "tags": ["git", "timezone", "sessions", "gotcha"], "created_at": "2026-02-11T17:20:12.592588+00:00", "updated_at": "2026-02-11T17:20:12.592588+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-9577f734", "content": "InternalToolRegistry._get_json_schema_type() collapses union types (str|int|float|bool|None) to just the first non-None type (\"string\"). This means MCP tool params declared as union types get a string-only schema, and _coerce_args skips coercion for string-declared params. The set_variable MCP tool now has explicit coercion for string booleans/nulls/numbers in _artifacts.py to work around this.", "type": "pattern", "importance": 0.8, "tags": ["mcp", "workflow", "schema", "gotcha"], "created_at": "2026-02-11T15:29:07.579161+00:00", "updated_at": "2026-02-11T15:29:07.579161+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-830c4c3a", "content": "The gobby mcp-server stdio process (started by Claude Code) is long-running and caches Python modules from startup. When changing config validation (like MemoryConfig.validate_backend), the daemon restarts with new code but the stale mcp-server process still runs old validation. Workaround: use config values valid in BOTH old and new code, or add backwards-compat aliases in validators. Fixed by adding 'sqlite' -> 'local' alias in validate_backend. YAML bare 'null' is parsed as None - use quoted '\"null\"' for the string value.", "type": "fact", "importance": 0.8, "tags": ["debugging", "mcp-server", "config", "gotcha"], "created_at": "2026-02-10T14:25:18.003615+00:00", "updated_at": "2026-02-10T14:25:18.003615+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-749df05c", "content": "Bandit nosec annotations require space-separated codes, not comma-separated. Use `# nosec B603 B607` not `# nosec B603,B607`. Comma-separated format only suppresses the first code.", "type": "fact", "importance": 0.8, "tags": ["bandit", "python", "linting"], "created_at": "2026-02-10T04:42:58.399207+00:00", "updated_at": "2026-02-10T04:42:58.399207+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-bf5a66c2", "content": "CodeMirror + Vite duplicate module crash: The web file editor's CodeMirror component crashes with 'Unrecognized extension value in extension set... multiple instances of @codemirror/state are loaded, breaking instanceof checks.' even though npm ls shows all @codemirror/state properly deduped to one version. The fix is adding resolve.dedupe to vite.config.ts: resolve: { dedupe: ['@codemirror/state', '@codemirror/view', '@codemirror/language'] }. This is a well-known Vite dev server issue where dependency pre-bundling creates separate module copies.", "type": "debugging", "importance": 0.8, "tags": ["web-ui", "codemirror", "vite", "debugging"], "created_at": "2026-02-10T02:47:10.252217+00:00", "updated_at": "2026-02-10T02:47:10.252217+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-eed85876", "content": "Migration 77 has a UNIQUE constraint issue on seq_num that requires clearing values to NULL before reassigning to avoid violations. This is a known gotcha when modifying sequence numbers in migrations.", "type": "context", "importance": 0.8, "tags": ["migration", "database", "constraints", "gobby"], "created_at": "2026-01-27T01:29:58.428788+00:00", "updated_at": "2026-01-27T01:29:58.428788+00:00", "source": "session", "source_id": "2bc8895b-b292-4b81-acfc-180c276ca5cd"}
{"id": "mm-04676fa3", "content": "The _LazyBool class in task_enforcement_actions.py lacks __eq__ and __ne__ operators, causing expressions like 'session_has_dirty_files == False' to skip thunk evaluation. Add __eq__(self, other) and __ne__(self, other) methods that coerce self to bool via bool(self) before comparison to ensure lazy evaluation is triggered and comparisons return correct True/False semantics.", "type": "pattern", "importance": 0.8, "tags": ["lazy-evaluation", "task-enforcement", "operator-overloading", "python-semantics"], "created_at": "2026-01-25T16:54:00.257505+00:00", "updated_at": "2026-01-25T16:54:00.257505+00:00", "source": "session", "source_id": "389037ea-8953-4e4f-bcb4-29c5dc468357"}
{"id": "mm-0dc68d2a", "content": "The _normalize_timestamp() function in sync/tasks.py should treat empty string as None (return None if ts == ''), and use regex pattern matching (e.g., r'Z|[+-]\\d{2}:\\d{2}$') to detect RFC3339 timezone suffixes instead of brittle slice checks. Only append 'Z' when the pattern does not match the timestamp suffix.", "type": "pattern", "importance": 0.8, "tags": ["timestamp-handling", "iso8601", "sync", "task-export", "regex-validation"], "created_at": "2026-01-25T04:38:01.653774+00:00", "updated_at": "2026-01-25T04:38:01.653774+00:00", "source": "session", "source_id": "389037ea-8953-4e4f-bcb4-29c5dc468357"}
{"id": "mm-41a61c2a", "content": "Memory ID generation in gobby uses '||' delimiter between content and project_id to prevent collisions (e.g., 'abc'+'def' vs 'abcd'+'ef'). This is implemented in src/gobby/storage/memories.py.", "type": "fact", "importance": 0.8, "tags": ["gobby", "memory-system", "id-generation", "collision-prevention"], "created_at": "2026-01-25T04:17:24.123650+00:00", "updated_at": "2026-01-25T04:17:24.123650+00:00", "source": "session", "source_id": "c9787d92-bd8e-4fcc-a158-05af9147f470"}
{"id": "mm-28d8d578", "content": "Test fixtures in gobby: protect_production_resources fixture patches load_config in already-imported modules (e.g., gobby.runner, gobby.mcp_proxy.stdio) to use safe_load_config with test DB paths. Must be added to test signature to ensure safe DB is used when instantiating GobbyRunner.", "type": "fact", "importance": 0.8, "tags": ["testing", "fixtures", "safety"], "created_at": "2026-01-25T04:04:50.334561+00:00", "updated_at": "2026-01-25T04:04:50.334561+00:00", "source": "session", "source_id": "90eefa0c-bedd-4489-bcd4-df7bf8a3cc6b"}
{"id": "mm-3f91e1c8", "content": "The _is_plan_file() function in task_enforcement_actions.py should explicitly check `if source != \"claude\"` rather than `if source and source != \"claude\"` to enforce that a source value must be present and not 'claude'. This prevents plan files from being processed without explicit source attribution.", "type": "pattern", "importance": 0.8, "tags": ["validation", "task-enforcement", "source-attribution"], "created_at": "2026-01-25T04:02:56.263283+00:00", "updated_at": "2026-01-25T04:02:56.263283+00:00", "source": "session", "source_id": "1a867b59-ad3d-4075-9020-6293616fbeb2"}
{"id": "mm-a028f56e", "content": "Gobby has migrated to database schema v75 as baseline minimum. Legacy migrations (versions 0-75) are from migrations_legacy.py, while new migrations v76+ go in MIGRATIONS list. run_migrations rejects versions below v75, and docstrings should reference v75+ not v60+.", "type": "fact", "importance": 0.78, "tags": ["database", "migrations", "schema-version"], "created_at": "2026-01-28T03:41:22.372041+00:00", "updated_at": "2026-01-28T03:41:22.372041+00:00", "source": "session", "source_id": "740c4be1-cfcc-4aa0-ab30-7a088d85d22d"}
{"id": "mm-2e8d0b10", "content": "Workflow activation on a session is persistent and requires explicit deactivation/ending via hook_dispatcher.py before the session can cleanly stop - accidental workflow activation can block session exit.", "type": "pattern", "importance": 0.75, "tags": ["workflow-lifecycle", "session-management", "debugging"], "created_at": "2026-01-28T20:38:12.091482+00:00", "updated_at": "2026-01-28T20:38:12.091482+00:00", "source": "session", "source_id": "8cc46e99-2e03-41f8-ba7e-7ad372450e56"}
{"id": "mm-f3c42990", "content": "When debugging gobby agent spawns, check: (1) session transcripts via gobby-sessions tools—empty transcript means agent never ran, (2) agent run records via agent runs queries, (3) gobby.log for 'Invalid JSON at line 0' warnings in transcript parsing. Silent failures can occur where spawn claims success but no Ghostty launches and no agent registers.", "type": "pattern", "importance": 0.75, "tags": ["gobby", "debugging", "troubleshooting", "spawn_agent", "validation"], "created_at": "2026-01-28T20:27:23.836631+00:00", "updated_at": "2026-01-28T20:27:23.836631+00:00", "source": "session", "source_id": "d347d68e-869d-4a6e-a8d5-8fe855bba25e"}
{"id": "mm-f4d2816d", "content": "Memory exports in gobby should sanitize user home paths by replacing absolute paths with '~' using _sanitize_content() method (src/gobby/sync/memories.py) to avoid exposing user-specific paths.", "type": "pattern", "importance": 0.75, "tags": ["gobby", "memory-export", "path-sanitization", "privacy"], "created_at": "2026-01-25T04:17:24.127397+00:00", "updated_at": "2026-01-25T04:17:24.127397+00:00", "source": "session", "source_id": "c9787d92-bd8e-4fcc-a158-05af9147f470"}
{"id": "mm-0b35820d", "content": "Project resolution mock targets: When testing CLI commands that resolve project IDs, patch gobby.cli.utils.get_project_context (not gobby.cli.tasks.crud.get_project_context), because resolve_project_ref() in cli/utils.py does the actual import. The _resolve_project_id in hook_manager.py now falls back to PERSONAL_PROJECT_ID instead of calling initialize_project.", "type": "pattern", "importance": 0.7, "tags": ["testing", "mocking", "project-resolution"], "created_at": "2026-02-10T20:21:43.208477+00:00", "updated_at": "2026-02-10T20:21:43.208477+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-822e34ff", "content": "Playwright tests for the gobby web UI: The Files page (useFiles.ts hook) now uses relative URLs through the Vite proxy (getBaseUrl returns ''). Use page.route('**/api/files/*') to intercept and mock API calls in tests. Navigation requires opening the sidebar first via .hamburger-button click, then clicking the .sidebar-item. The terminal-colors.spec.ts test is broken because it skips this step. Run Playwright tests from web/ directory: cd web && npx playwright test.", "type": "pattern", "importance": 0.7, "tags": ["web-ui", "playwright", "testing"], "created_at": "2026-02-10T02:47:17.713217+00:00", "updated_at": "2026-02-10T02:58:26.595438+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-2095597f", "content": "After changing ~/.gobby/config.yaml (e.g., switching memory backend), the gobby daemon must be restarted with 'uv run gobby restart' to pick up the new configuration. Config changes are not hot-reloaded.", "type": "fact", "importance": 0.7, "tags": "daemon,config,restart", "created_at": "2026-02-10T02:42:48.459768+00:00", "updated_at": "2026-02-10T02:42:48.459768+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-a4dd55df", "content": "GobbyTask (list interface) and GobbyTaskDetail (detail interface) are separate TypeScript interfaces in useTasks.ts. GobbyTask is the lighter version used in task lists — it does NOT include project_id, description, labels, etc. Only GobbyTaskDetail extends GobbyTask with those fields. When filtering tasks by project_id client-side, project_id must be added to the base GobbyTask interface.", "type": "pattern", "importance": 0.6, "tags": ["frontend", "typescript", "tasks", "gotcha"], "created_at": "2026-02-11T17:33:42.755231+00:00", "updated_at": "2026-02-11T17:33:42.755231+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-46d0f151", "content": "memu-py SDK was removed from gobby due to critical upstream bug: create_memory_item() missing resource_id parameter. Replaced with sqlite backend.", "type": "fact", "importance": 0.6, "tags": "memory,memu,removal", "created_at": "2026-02-10T02:41:44.504868+00:00", "updated_at": "2026-02-10T02:41:44.504868+00:00", "source": "mcp_tool", "source_id": null}
{"id": "mm-d79a184f", "content": "The gobby project uses a standard workflow: edit files → run tf8c78", "type": "fact", "importance": 0.5, "tags": [], "created_at": "2026-02-01T01:42:53.816206+00:00", "updated_at": "2026-02-01T01:42:53.816206+00:00", "source": "import", "source_id": null}
