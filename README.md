# Gobby

A local daemon that unifies Claude Code, Gemini CLI, and Codex through a hook interface for session tracking, with an MCP proxy featuring progressive tool discovery for efficient access to downstream servers.

## Features

- **Multi-CLI Unification** - Single daemon handles hooks from Claude Code, Gemini CLI, and Codex
- **Session Tracking** - Captures AI coding sessions across CLIs for context continuity
- **MCP Proxy** - Progressive tool discovery (list → schema → execute) to reduce token usage
- **Local-First** - All data stored in SQLite with no cloud dependency
- **Smart Context** - Auto-detects parent sessions for seamless context handoff

## Quick Start

```bash
# Install
git clone https://github.com/GobbyAI/gobby.git
cd gobby
uv sync

# Start daemon
uv run gobby start

# Initialize project (in your project directory)
uv run gobby init

# Install hooks for your AI CLIs
uv run gobby install

# Optional: Install globally to use 'gobby' without 'uv run'
uv pip install -e .
```

## Requirements

- Python 3.11+
- [uv](https://github.com/astral-sh/uv) package manager
- At least one supported AI CLI:
  - [Claude Code](https://claude.ai/code) - `npm install -g @anthropic-ai/claude-code`
  - [Gemini CLI](https://github.com/google-gemini/gemini-cli) - `npm install -g @google/gemini-cli`
  - [Codex CLI](https://github.com/openai/codex) - `npm install -g @openai/codex`

## MCP Server Configuration

After starting the daemon, configure your AI CLI to connect to Gobby's MCP server:

### Claude Code

Add to `.claude/settings.json` (project) or `~/.claude/settings.json` (global):

```json
{
  "mcpServers": {
    "gobby": {
      "url": "http://localhost:8765/mcp",
      "transport": "http"
    }
  }
}
```

### Gemini CLI

Add to `.gemini/settings.json` (project) or `~/.gemini/settings.json` (global):

```json
{
  "mcpServers": {
    "gobby": {
      "uri": "http://localhost:8765/mcp"
    }
  }
}
```

### Codex CLI

Add to `~/.codex/config.toml`:

```toml
[mcp_servers.gobby]
url = "http://localhost:8765/mcp"
```

## CLI Commands

| Command | Description |
|---------|-------------|
| `gobby start [--verbose]` | Start the daemon |
| `gobby stop` | Stop the daemon |
| `gobby status` | Show daemon status |
| `gobby restart` | Restart the daemon |
| `gobby init` | Initialize a Gobby project in current directory |
| `gobby install` | Install hooks for detected AI CLIs |
| `gobby uninstall` | Remove hooks from AI CLIs |
| `gobby mcp-server` | Run stdio MCP server for any MCP client |

## MCP Tools

The daemon exposes tools via MCP that can be used by Claude Code and other MCP clients:

### Daemon Management

- `start()`, `stop()`, `restart()`, `status()` - Lifecycle control
- `init_project()` - Initialize a new project

### MCP Server Management

- `list_mcp_servers()` - List connected downstream servers
- `add_mcp_server()` - Dynamically add an MCP server
- `remove_mcp_server()` - Remove an MCP server
- `import_mcp_server()` - Import servers from projects, GitHub, or web search

### Tool Proxy (Progressive Disclosure)

- `list_tools(server?)` - Get lightweight tool metadata
- `get_tool_schema(server, tool)` - Get full inputSchema for a tool
- `call_tool(server, tool, arguments?)` - Execute a tool on a downstream server

### Code Execution

- `execute_code(code)` - Run Python in Claude's sandbox
- `process_large_dataset(data, operation)` - Token-optimized data processing

### AI-Powered

- `recommend_tools(task_description)` - Get intelligent tool recommendations

## Configuration

Configuration is stored at `~/.gobby/config.yaml`:

```yaml
# Auto-generated machine identifier
machine_id: <auto-generated-uuid>

# Server settings
daemon_port: 8765
daemon_health_check_interval: 60.0

# WebSocket server
websocket:
  enabled: true
  port: 8766
  ping_interval: 30
  ping_timeout: 10

# Logging (separate log files per component)
logging:
  level: warning  # debug, info, warning, error
  format: text    # text or json
  client: ~/.gobby/logs/gobby-client.log
  client_error: ~/.gobby/logs/gobby-client-error.log
  hook_manager: ~/.gobby/logs/hook-manager.log
  mcp_server: ~/.gobby/logs/mcp-server.log
  mcp_client: ~/.gobby/logs/mcp-client.log
  max_size_mb: 10
  backup_count: 5

# MCP client proxy for downstream servers
mcp_client_proxy:
  enabled: true
  proxy_timeout: 30
  tool_timeout: 30

# LLM providers configuration
llm_providers:
  claude:
    models: claude-haiku-4-5,claude-sonnet-4-5,claude-opus-4-5
    auth_mode: subscription  # subscription, api_key, or adc
  codex:
    models: gpt-4o-mini,gpt-5-mini,gpt-5,gpt-5-high
    auth_mode: subscription
  gemini:
    models: gemini-3
    auth_mode: subscription
  litellm:
    models: gpt-4o-mini,gpt-5-mini
    auth_mode: api_key  # litellm always uses api_key
  api_keys:
    OPENAI_API_KEY: sk-...
    MISTRAL_API_KEY: ...

# Session summaries (LLM-powered)
session_summary:
  enabled: true
  provider: claude
  model: claude-haiku-4-5
  summary_file_path: ~/.gobby/session_summaries/
  prompt: |
    # Custom prompt template (optional)
    # Uses {transcript_summary}, {last_messages}, {git_status}, {file_changes}

# Title synthesis for sessions
title_synthesis:
  enabled: true
  provider: claude
  model: claude-haiku-4-5
  prompt: |
    # Custom prompt template (optional)
    # Uses {user_prompt}

# Code execution (sandbox via Claude)
code_execution:
  enabled: true
  provider: claude
  model: claude-sonnet-4-5
  max_turns: 5
  default_timeout: 30
  max_dataset_preview: 3
  prompt: |
    # Custom prompt template (optional)
    # Uses {context}, {language}, {code}

# Tool recommendations
recommend_tools:
  enabled: true
  provider: claude
  model: claude-sonnet-4-5
  prompt: |
    # Custom prompt template (optional)
```

## File Locations

| Path | Description |
|------|-------------|
| `~/.gobby/config.yaml` | Daemon configuration |
| `~/.gobby/gobby.db` | SQLite database |
| `~/.gobby/logs/` | Log files |
| `~/.gobby/session_summaries/` | Generated session summaries |
| `.gobby/project.json` | Project-level configuration |

## Architecture

```text
AI CLI (Claude/Gemini/Codex)
        │ hook fires
        ▼
Hook Dispatcher Script
        │ HTTP POST
        ▼
Gobby HTTP Server (:8765)
        │
        ▼
┌───────────────────────────────────┐
│  FastAPI + FastMCP Server         │
│  ┌─────────────┬────────────────┐ │
│  │ HookManager │ MCPClientManager│ │
│  └──────┬──────┴───────┬────────┘ │
│         │              │          │
│    ┌────▼────┐   ┌─────▼─────┐   │
│    │ SQLite  │   │ Downstream │   │
│    │ Storage │   │ MCP Servers│   │
│    └─────────┘   └───────────┘   │
└───────────────────────────────────┘
```

### Key Components

- **Hook System** - Unified interface capturing 14 event types across Claude Code, Gemini CLI, and Codex CLI
- **Session Manager** - Tracks sessions with metadata, status, parent relationships, and handoff context
- **MCP Proxy** - Connects to downstream servers (Supabase, Context7, etc.) with progressive tool discovery
- **Summary Generator** - LLM-powered session summaries for automatic context handoff between sessions

## Development

```bash
# Install dependencies
uv sync

# Run daemon in development
uv run gobby start --verbose

# Run tests
uv run pytest

# Linting
uv run ruff check src/
uv run ruff format src/

# Type checking
uv run mypy src/
```

## Hook Types

Gobby captures 14 hook event types across Claude Code, Gemini CLI, and Codex CLI. Events are normalized to a unified internal model.

### Unified Event Types

| Event | Claude Code | Gemini CLI | Codex CLI | Description |
|-------|-------------|------------|-----------|-------------|
| `SESSION_START` | `session-start` | `SessionStart` | `thread/started` | Session begins |
| `SESSION_END` | `session-end` | `SessionEnd` | `thread/archive` | Session ends |
| `BEFORE_AGENT` | `user-prompt-submit` | `BeforeAgent` | `turn/started` | Before processing prompt |
| `AFTER_AGENT` | `stop` | `AfterAgent` | `turn/completed` | Agent stops |
| `BEFORE_TOOL` | `pre-tool-use` | `BeforeTool` | `requestApproval` | Before tool execution |
| `AFTER_TOOL` | `post-tool-use` | `AfterTool` | `item/completed` | After tool execution |
| `BEFORE_TOOL_SELECTION` | - | `BeforeToolSelection` | - | Before tool selection (Gemini) |
| `BEFORE_MODEL` | - | `BeforeModel` | - | Before LLM call (Gemini) |
| `AFTER_MODEL` | - | `AfterModel` | - | After LLM call (Gemini) |
| `PRE_COMPACT` | `pre-compact` | `PreCompress` | - | Before context compaction |
| `SUBAGENT_START` | `subagent-start` | - | - | Subagent spawned (Claude) |
| `SUBAGENT_STOP` | `subagent-stop` | - | - | Subagent finished (Claude) |
| `PERMISSION_REQUEST` | `permission-request` | - | - | Permission requested (Claude) |
| `NOTIFICATION` | `notification` | `Notification` | - | System notification |

See [docs/hooks/CLAUDE_HOOKS_SCHEMA.md](docs/hooks/CLAUDE_HOOKS_SCHEMA.md) for detailed payload schemas.

## Roadmap

- **Workflow Engine** - Deterministic workflows with hook-enforced phases and tool restrictions. See [docs/plans/WORKFLOWS.md](docs/plans/WORKFLOWS.md).

## License

MIT
